<!DOCTYPE HTML>
<html lang="en">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="ES6, Sunny">
    <meta name="description" content="1.概述
ECMAScript、JavaScript、NodeJs，它们的区别是什么？ECMAScript：简称 ES，是一个语言标准（循环、判断、变量、数组等数据类型）JavaScript：运行在浏览器端的语言，该语言使用 ES 标准。 ">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="referrer" content="no-referrer-when-downgrade">
    <!-- Global site tag (gtag.js) - Google Analytics -->


    <title>ES6 | Sunny</title>
    <link rel="icon" type="image/png" href="/favicon.png">

    <link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.css">
    <link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/css/matery.css">
    <link rel="stylesheet" type="text/css" href="/css/my.css">

    <script src="/libs/jquery/jquery.min.js"></script>

<meta name="generator" content="Hexo 5.4.0"></head>




<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">Sunny</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>首页</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>标签</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>分类</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>归档</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>关于</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/contact" class="waves-effect waves-light">
      
      <i class="fas fa-comments" style="zoom: 0.6;"></i>
      
      <span>留言板</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/friends" class="waves-effect waves-light">
      
      <i class="fas fa-address-book" style="zoom: 0.6;"></i>
      
      <span>友情链接</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="Search" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">Sunny</div>
        <div class="logo-desc">
            
            Never really desperate, only the lost of the soul.
            
        </div>
    </div>

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			首页
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			标签
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			分类
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			归档
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			关于
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/contact" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-comments"></i>
			
			留言板
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/friends" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-address-book"></i>
			
			友情链接
		</a>
          
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/blinkfox/hexo-theme-matery" class="waves-effect waves-light" target="_blank">
                <i class="fab fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>
</div>


        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/blinkfox/hexo-theme-matery" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    



<div class="bg-cover pd-header post-cover" style="background-image: url('/medias/featureimages/8.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">ES6</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        width: 345px;
        padding-left: 20px;
    }

    .toc-widget .toc-title {
        padding: 35px 0 15px 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content {
        padding-bottom: 30px;
        overflow: auto;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;

        position: absolute;
        right: 23.5vw;
        display: block;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #floating-toc-btn {
        position: fixed;
        right: 15px;
        bottom: 76px;
        padding-top: 15px;
        margin-bottom: 0;
        z-index: 998;
    }

    #floating-toc-btn .btn-floating {
        width: 48px;
        height: 48px;
    }

    #floating-toc-btn .btn-floating i {
        line-height: 48px;
        font-size: 1.4rem;
    }
</style>
<div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/Front-end-article/">
                                <span class="chip bg-color">Front end article</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>Publish Date:&nbsp;&nbsp;
                    2020-04-01
                </div>
                

                

                

                

                
            </div>
        </div>
        <hr class="clearfix">

        

        

        <div class="card-content article-card-content">
            <div id="articleContent">
                <h1 id="1-概述"><a href="#1-概述" class="headerlink" title="1.概述"></a>1.概述</h1><ol>
<li>ECMAScript、JavaScript、NodeJs，它们的区别是什么？<br>ECMAScript：简称 ES，是一个语言标准（循环、判断、变量、数组等数据类型）<br>JavaScript：运行在浏览器端的语言，该语言使用 ES 标准。 ES + web api = JavaScript<br>NodeJs：运行在服务器端的语言，该语言使用 ES 标准。 ES + node api = JavaScript<br>无论 JavaScript，还是 NodeJs，它们都是 ES 的超集（super set 即包含但是还有自己的东西）</li>
<li>ECMAScript 有哪些关键的版本？<br>ES3.0： 1999<br>ES5.0: 2009<br>ES6.0: 2015, 从该版本开始，不再使用数字作为编号，而使用年份<br>ES7.0: 2016</li>
<li>为什么 ES6 如此重要？<br>ES6 解决 JS 无法开发大型应用的语言层面的问题。</li>
<li>如何应对兼容性问题？</li>
</ol>
<h1 id="2-块级绑定"><a href="#2-块级绑定" class="headerlink" title="2.块级绑定"></a>2.块级绑定</h1><h2 id="2-1-声明变量的问题"><a href="#2-1-声明变量的问题" class="headerlink" title="2-1 声明变量的问题"></a>2-1 声明变量的问题</h2><p>使用 var 声明变量</p>
<ol>
<li>允许重复的变量声明：导致数据被覆盖</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="number">1</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">print</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(a);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//假设这里有一千行代码</span></span><br><span class="line"><span class="keyword">var</span> a = <span class="number">2</span>;</span><br><span class="line">print();</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>变量提升：怪异的数据访问、闭包问题<br>怪异数据访问</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="built_in">Math</span>.random() &lt; <span class="number">0.5</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> a = <span class="string">&quot;abc&quot;</span>;</span><br><span class="line">  <span class="built_in">console</span>.log(a);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(a);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(a);</span><br></pre></td></tr></table></figure>

<p>闭包</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> div = <span class="built_in">document</span>.getElementById(<span class="string">&quot;divButtons&quot;</span>);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">1</span>; i &lt;= <span class="number">10</span>; i++) &#123;</span><br><span class="line">  <span class="keyword">var</span> btn = <span class="built_in">document</span>.createElement(<span class="string">&quot;button&quot;</span>);</span><br><span class="line">  btn.innerHTML = <span class="string">&quot;按钮&quot;</span> + i;</span><br><span class="line">  div.appendChild(btn);</span><br><span class="line">  btn.onclick = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(i); <span class="comment">//输出11</span></span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 循环结束后，i：11</span></span><br></pre></td></tr></table></figure>

<p>解决</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> div = <span class="built_in">document</span>.getElementById(<span class="string">&quot;divButtons&quot;</span>);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">1</span>; i &lt;= <span class="number">10</span>; i++) &#123;</span><br><span class="line">  <span class="keyword">var</span> btn = <span class="built_in">document</span>.createElement(<span class="string">&quot;button&quot;</span>);</span><br><span class="line">  btn.innerHTML = <span class="string">&quot;按钮&quot;</span> + i;</span><br><span class="line">  div.appendChild(btn);</span><br><span class="line">  (<span class="function"><span class="keyword">function</span> (<span class="params">i</span>) </span>&#123;</span><br><span class="line">    btn.onclick = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(i); <span class="comment">//输出11</span></span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;)(i);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>全局变量挂载到全局对象：全局对象成员污染问题，即容易覆盖 window 已有成员</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> abc = <span class="string">&quot;123&quot;</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">window</span>.abc);</span><br><span class="line"><span class="comment">// var console = &quot;abc&quot;;</span></span><br><span class="line"><span class="comment">// console.log(console)</span></span><br><span class="line"><span class="comment">// var name = &quot;abc&quot;;</span></span><br></pre></td></tr></table></figure>

<h2 id="2-2-使用-let-声明变量"><a href="#2-2-使用-let-声明变量" class="headerlink" title="2-2 使用 let 声明变量"></a>2-2 使用 let 声明变量</h2><p>ES6 不仅引入 let 关键字用于解决变量声明的问题，同时引入了块级作用域的概念<br>块级作用域：代码执行时遇到花括号，会创建一个块级作用域，花括号结束，销毁块级作用域<br>声明变量的问题</p>
<ol>
<li>全局变量挂载到全局对象：全局对象成员污染问题<br>let 声明的变量不会挂载到全局对象</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = <span class="number">123</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">window</span>.a);</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>允许重复的变量声明：导致数据被覆盖<br>let 声明的变量，不允许当前作用域范围内重复声明</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = <span class="number">123</span>;</span><br><span class="line"><span class="keyword">let</span> a = <span class="number">345</span>;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>允许在不同作用域使用</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = <span class="number">123</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> a = <span class="number">46</span>;</span><br><span class="line">  <span class="built_in">console</span>.log(a);</span><br><span class="line">&#125;</span><br><span class="line">test();</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>变量提升：怪异的数据访问、闭包问题<br>使用 let 不会有变量提升，因此，不能在定义 let 变量之前使用它</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(a);</span><br><span class="line"><span class="keyword">let</span> a = <span class="number">123</span>;</span><br></pre></td></tr></table></figure>

<p>底层实现上，let 声明的变量实际上也会有提升，但是，提升后会将其放入到“暂时性死区”，如果访问的变量位于暂时性死区，则会报错：“Cannot access ‘a’ before initialization”。当代码运行到该变量的声明语句时，会将其从暂时性死区中移除。<br>在循环中，用 let 声明的循环变量，会特殊处理，每次进入循环体，都会开启一个新的作用域，并且将循环变量绑定到该作用域（每次循环，使用的是一个全新的循环变量）<br>在循环中使用 let 声明的循环变量，在循环结束后会销毁</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> div = <span class="built_in">document</span>.getElementById(<span class="string">&quot;divButtons&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">1</span>; i &lt;= <span class="number">10</span>; i++) &#123;</span><br><span class="line">  <span class="keyword">let</span> button = <span class="built_in">document</span>.createElement(<span class="string">&quot;button&quot;</span>);</span><br><span class="line">  button.innerHTML = <span class="string">&quot;按钮&quot;</span> + i;</span><br><span class="line">  button.onclick = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(i); <span class="comment">//使用的是当前作用域中的i</span></span><br><span class="line">  &#125;;</span><br><span class="line">  div.appendChild(button);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>块级作用域演示</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = <span class="number">123</span>; <span class="comment">//全局作用域定义a</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">let</span> a = <span class="number">456</span>; <span class="comment">//块级作用域定义a</span></span><br><span class="line">  <span class="built_in">console</span>.log(a); <span class="comment">//使用的是块级作用域中的a</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(a);</span><br><span class="line"><span class="comment">//在块级作用域中用let定义的变量，在作用域外不能访问。(里面能用外面,外面不能用里面)</span></span><br></pre></td></tr></table></figure>

<p>演示</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="built_in">Math</span>.random() &lt; <span class="number">0.5</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> a = <span class="number">123</span>; <span class="comment">//定义在当前块级作用域</span></span><br><span class="line">  <span class="built_in">console</span>.log(a); <span class="comment">//当前块级作用域中的a</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="comment">//这是另外一个块级作用域，该作用域中找不到a</span></span><br><span class="line">  <span class="built_in">console</span>.log(a);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(a); <span class="comment">//外面不能访问里面</span></span><br></pre></td></tr></table></figure>

<h2 id="2-3-使用-const-声明变量"><a href="#2-3-使用-const-声明变量" class="headerlink" title="2-3 使用 const 声明变量"></a>2-3 使用 const 声明变量</h2><p>const 和 let 完全相同，仅在于用 const 声明的变量，必须在声明时赋值，而且不可以重新赋值(赋相同的值也不行),即常量。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> a = <span class="number">1</span>;</span><br><span class="line">a = <span class="number">1</span>;</span><br><span class="line"><span class="built_in">console</span>.log(a);</span><br></pre></td></tr></table></figure>

<p>实际上，在开发中，应该尽量使用 const 来声明变量，以保证变量的值不会随意篡改，原因如下：</p>
<ol>
<li>根据经验，开发中的很多变量，都是不会更改，也不应该更改的。</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> div = <span class="built_in">document</span>.getElementById(<span class="string">&quot;game&quot;</span>);</span><br><span class="line"><span class="comment">//一般来说，div 变量是不会更改的</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>后续的很多框架或者是第三方 JS 库，都要求数据不可变，使用常量可以一定程度上保证这一点。</li>
</ol>
<p>注意的细节：</p>
<ol>
<li>常量不可变，是指声明的常量的内存空间不可变，并不保证内存空间中的地址指向的其他空间不可变。</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> a = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;kevin&quot;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="number">123</span>,</span><br><span class="line">&#125;;</span><br><span class="line">a.name = <span class="string">&quot;abc&quot;</span>;</span><br><span class="line"><span class="built_in">console</span>.log(a);</span><br><span class="line"><span class="comment">//a 不能变，a 里面能变</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>常量的命名 1.特殊的常量：该常量从字面意义上，一定是不可变的，比如圆周率、月地距地或其他一些绝不可能变化的配置。通常，该常量的名称<strong>全部使用大写</strong>，多个单词之间用下划线分割</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> PI = <span class="number">3.14</span>;</span><br><span class="line"><span class="keyword">const</span> MOON_EARTH_DISTANCE = <span class="number">3245563424</span>; <span class="comment">//月地距离</span></span><br></pre></td></tr></table></figure>

<ol>
<li>普通的常量：使用和之前一样的命名即可</li>
<li>在 for 循环中，循环变量不可以使用常量,for in 循环可以用常量</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;fzq&quot;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="number">18</span>,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> prop <span class="keyword">in</span> obj) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(prop);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="3-字符串和正则表达式"><a href="#3-字符串和正则表达式" class="headerlink" title="3.字符串和正则表达式"></a>3.字符串和正则表达式</h1><h2 id="3-1-更好的-Unicode-支持"><a href="#3-1-更好的-Unicode-支持" class="headerlink" title="3-1 更好的 Unicode 支持"></a>3-1 更好的 Unicode 支持</h2><p>早期，由于存储空间宝贵，Unicode 使用 16 位二进制来存储文字。我们将一个 16 位的二进制编码叫做一个码元（Code Unit）。<br>后来，由于技术的发展，Unicode 对文字编码进行了扩展，将某些文字扩展到了 32 位（占用两个码元），并且，将某个文字对应的二进制数字叫做码点（Code Point）。<br>ES6 为了解决这个困扰，为字符串提供了方法：codePointAt，根据字符串码元的位置得到其码点。<br>同时，ES6 为正则表达式添加了一个 flag: u，如果添加了该配置，则匹配时，使用码点匹配</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> text = <span class="string">&quot;𠮷&quot;</span>; <span class="comment">//占用了2个码元（32位）</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;字符串长度：&quot;</span>, text.length); <span class="comment">//2</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;使用正则测试：&quot;</span>, <span class="regexp">/^.$/</span>.test(text)); <span class="comment">//false正则不能匹配</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;使用正则测试：&quot;</span>, <span class="regexp">/^.$/u</span>.test(text)); <span class="comment">//true匹配码点</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;得到第一个码元：&quot;</span>, text.charCodeAt(<span class="number">0</span>));</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;得到第二个码元：&quot;</span>, text.charCodeAt(<span class="number">1</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">//𠮷：\ud842\udfb7</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;得到第一个码点：&quot;</span>, text.codePointAt(<span class="number">0</span>));</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;得到第二个码点：&quot;</span>, text.codePointAt(<span class="number">1</span>));</span><br></pre></td></tr></table></figure>

<p>判断字符串 char，是 32 位，还是 16 位</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">is32bit</span>(<span class="params">char, i</span>) </span>&#123;</span><br><span class="line">  <span class="comment">//如果码点大于了16位二进制的最大值，则其是32位的</span></span><br><span class="line">  <span class="keyword">return</span> char.codePointAt(i) &gt; <span class="number">0xffff</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>得到一个字符串码点的真实长度</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getLengthOfCodePoint</span>(<span class="params">str</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> len = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; str.length; i++) &#123;</span><br><span class="line">    <span class="comment">//i在索引码元</span></span><br><span class="line">    <span class="keyword">if</span> (is32bit(str, i)) &#123;</span><br><span class="line">      <span class="comment">//当前字符串，在i这个位置，占用了两个码元</span></span><br><span class="line">      i++;</span><br><span class="line">    &#125;</span><br><span class="line">    len++;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> len;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;𠮷是否是32位的：&quot;</span>, is32bit(<span class="string">&quot;𠮷&quot;</span>, <span class="number">0</span>));</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;ab𠮷ab的码点长度：&quot;</span>, getLengthOfCodePoint(<span class="string">&quot;ab𠮷ab&quot;</span>));</span><br></pre></td></tr></table></figure>

<h2 id="3-2-更多的字符串-API"><a href="#3-2-更多的字符串-API" class="headerlink" title="3-2 更多的字符串 API"></a>3-2 更多的字符串 API</h2><p>以下均为字符串的实例（原型）方法<br>includes 判断字符串中是否包含指定的子字符串<br>startsWith 判断字符串中是否以指定的字符串开始<br>endsWith 判断字符串中是否以指定的字符串结尾<br>repeat 将字符串重复指定的次数，然后返回一个新字符串。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> text = <span class="string">&quot;成哥是狠人&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;是否包含“狠”：&quot;</span>, text.includes(<span class="string">&quot;狠&quot;</span>));</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;是否包含“狠”：&quot;</span>, text.includes(<span class="string">&quot;狠&quot;</span>, <span class="number">3</span>)); <span class="comment">//下标3开始查找</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;是否以“成哥”开头：&quot;</span>, text.startsWith(<span class="string">&quot;成哥&quot;</span>));</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;是否以“狠人”结尾：&quot;</span>, text.endsWith(<span class="string">&quot;狠人&quot;</span>));</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;重复4次：&quot;</span>, text.repeat(<span class="number">4</span>));</span><br></pre></td></tr></table></figure>

<h2 id="3-3【拓展】-正则中的粘连标记"><a href="#3-3【拓展】-正则中的粘连标记" class="headerlink" title="3-3【拓展】 正则中的粘连标记"></a>3-3【拓展】 正则中的粘连标记</h2><p>标记名：y<br>含义：匹配时，完全按照正则对象中的 lastIndex 位置开始匹配，并且匹配的位置必须在 lastIndex 位置。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> text = <span class="string">&quot;Hello World!!!&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> reg = <span class="regexp">/W\w+/y</span>; <span class="comment">//W开头，任意单词字符一次或多次</span></span><br><span class="line">reg.lastIndex = <span class="number">3</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;reg.lastIndex:&quot;</span>, reg.lastIndex);</span><br><span class="line"><span class="built_in">console</span>.log(reg.test(text));</span><br></pre></td></tr></table></figure>

<h2 id="3-4-模板字符串"><a href="#3-4-模板字符串" class="headerlink" title="3-4 模板字符串"></a>3-4 模板字符串</h2><p>ES6 之前处理字符串繁琐的两个方面：</p>
<ol>
<li>多行字符串</li>
</ol>
<p>写法一</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> test =</span><br><span class="line">  <span class="string">&quot;邓哥喜欢秋葵\</span></span><br><span class="line"><span class="string">邓哥也喜欢韭菜&quot;</span>;</span><br></pre></td></tr></table></figure>

<p>写法二</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> test = [<span class="string">&quot;邓哥喜欢秋葵&quot;</span>, <span class="string">&quot;邓哥也喜欢韭菜&quot;</span>].join(<span class="string">&quot;\n&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>以上，多行字符串的处理比较繁琐</p>
<ol start="2">
<li>字符串拼接</li>
</ol>
<p>在 ES6 中，提供了<strong>模板字符串</strong>的书写，可以非常方便的换行和拼接，要做的，仅仅是将字符串的开始或结尾改为 `符号</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> test = <span class="string">`邓哥喜欢秋葵</span></span><br><span class="line"><span class="string">邓哥喜欢韭菜`</span>;</span><br></pre></td></tr></table></figure>

<p>如果要在字符串中拼接 js 表达式，只需要在模板字符串中使用`${JS 表达式}</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> love1 = <span class="string">&quot;秋葵&quot;</span>;</span><br><span class="line"><span class="keyword">var</span> love2 = <span class="string">&quot;香菜&quot;</span>;</span><br><span class="line"><span class="keyword">var</span> text = <span class="string">`邓哥喜欢<span class="subst">$&#123;love1&#125;</span></span></span><br><span class="line"><span class="string">邓哥也喜欢<span class="subst">$&#123;love2&#125;</span></span></span><br><span class="line"><span class="string">表达式可以是任何有意义的数据<span class="subst">$&#123;<span class="number">1</span> + (<span class="number">3</span> * <span class="number">2</span>) / <span class="number">0.5</span>&#125;</span></span></span><br><span class="line"><span class="string">表达式是可以嵌套的：<span class="subst">$&#123;<span class="string">`表达式中的模板字符串<span class="subst">$&#123;love1 + love2&#125;</span>`</span>&#125;</span></span></span><br><span class="line"><span class="string">\n\n</span></span><br><span class="line"><span class="string">奥布瓦的发顺丰</span></span><br><span class="line"><span class="string">在模板字符串中使用\$&#123; JS表达式 &#125; 可以进行插值</span></span><br><span class="line"><span class="string">`</span>;</span><br><span class="line"><span class="built_in">console</span>.log(text);</span><br></pre></td></tr></table></figure>

<h2 id="3-5【拓展】模板字符串标记"><a href="#3-5【拓展】模板字符串标记" class="headerlink" title="3-5【拓展】模板字符串标记"></a>3-5【拓展】模板字符串标记</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> love1 = <span class="string">&quot;秋葵&quot;</span>;</span><br><span class="line"><span class="keyword">var</span> love2 = <span class="string">&quot;香菜&quot;</span>;</span><br><span class="line"><span class="keyword">var</span> text = myTag<span class="string">`邓哥喜欢<span class="subst">$&#123;love1&#125;</span>，邓哥也喜欢<span class="subst">$&#123;love2&#125;</span>。`</span>;</span><br></pre></td></tr></table></figure>

<p>相当于</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">text = myTag([<span class="string">&quot;邓哥喜欢&quot;</span>, <span class="string">&quot;，邓哥也喜欢&quot;</span>, <span class="string">&quot;。&quot;</span>], <span class="string">&quot;秋葵&quot;</span>, <span class="string">&quot;香菜&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>模拟模板字符串功能</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">function myTag(parts) &#123;</span><br><span class="line">    const values = Array.prototype.slice.apply(arguments).slice(1);</span><br><span class="line">    // parts.length = value.length + 1</span><br><span class="line">    let str = &quot;&quot;;</span><br><span class="line">    for (let i = 0; i &lt; values.length; i++) &#123;</span><br><span class="line">        str += `$&#123;parts[i]&#125;：$&#123;values[i]&#125;`;</span><br><span class="line">        if (i === values.length - 1) &#123;</span><br><span class="line">            str += parts[i + 1];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    return str;</span><br><span class="line">&#125;</span><br><span class="line">console.log(text);</span><br></pre></td></tr></table></figure>

<p>String.raw</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">var text = String.raw`abc\t\nbcd`;//告诉他没有特殊字符，完全打印</span><br><span class="line">console.log(text);</span><br></pre></td></tr></table></figure>

<p>演示</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;ie=edge&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">textarea</span> <span class="attr">id</span>=<span class="string">&quot;txt&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">textarea</span>&gt;</span>多行文本框</span><br><span class="line">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">&quot;btn&quot;</span>&gt;</span>设置div的内容<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;container&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">      <span class="keyword">const</span> container = <span class="built_in">document</span>.getElementById(<span class="string">&quot;container&quot;</span>);</span></span><br><span class="line"><span class="javascript">      <span class="keyword">const</span> txt = <span class="built_in">document</span>.getElementById(<span class="string">&quot;txt&quot;</span>);</span></span><br><span class="line"><span class="javascript">      <span class="keyword">const</span> btn = <span class="built_in">document</span>.getElementById(<span class="string">&quot;btn&quot;</span>);</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">      btn.onclick = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        container.innerHTML = safe<span class="string">`&lt;p&gt;</span></span></span><br><span class="line"><span class="string"><span class="javascript"><span class="subst">$&#123;txt.value&#125;</span></span></span></span><br><span class="line"><span class="string"><span class="javascript">&lt;!--这里的safe是为了防止用户传入恶意的代码--&gt;</span></span></span><br><span class="line"><span class="string"><span class="javascript">            &lt;/p&gt;</span></span></span><br><span class="line"><span class="string"><span class="javascript">&lt;h1&gt;</span></span></span><br><span class="line"><span class="string"><span class="javascript"><span class="subst">$&#123;txt.value&#125;</span></span></span></span><br><span class="line"><span class="string"><span class="javascript">            &lt;/h1&gt;</span></span></span><br><span class="line"><span class="string"><span class="javascript">`</span>;</span></span><br><span class="line"><span class="javascript">      &#125;;</span></span><br><span class="line"><span class="javascript">      <span class="function"><span class="keyword">function</span> <span class="title">safe</span>(<span class="params">parts</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">const</span> values = <span class="built_in">Array</span>.prototype.slice.apply(<span class="built_in">arguments</span>).slice(<span class="number">1</span>);</span></span><br><span class="line"><span class="javascript">        <span class="keyword">let</span> str = <span class="string">&quot;&quot;</span>;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; values.length; i++) &#123;</span></span><br><span class="line"><span class="javascript">          <span class="keyword">const</span> v = values[i].replace(<span class="regexp">/&lt;/g</span>, <span class="string">&quot;&amp;lt;&quot;</span>).replace(<span class="regexp">/&gt;/g</span>, <span class="string">&quot;&amp;gt;&quot;</span>);</span></span><br><span class="line"><span class="javascript">          str += parts[i] + v;</span></span><br><span class="line"><span class="javascript">          <span class="keyword">if</span> (i === values.length - <span class="number">1</span>) &#123;</span></span><br><span class="line"><span class="javascript">            str += parts[i + <span class="number">1</span>];</span></span><br><span class="line"><span class="javascript">          &#125;</span></span><br><span class="line"><span class="javascript">        &#125;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">return</span> str;</span></span><br><span class="line"><span class="javascript">      &#125;</span></span><br><span class="line"><span class="javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>总结</p>
<p>在模板字符串书写之前，可以加上标记:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">标记名`模板字符串`;</span><br></pre></td></tr></table></figure>

<p>标记是一个函数，函数参数如下：</p>
<ol>
<li>参数 1：被插值分割的字符串数组</li>
<li>后续参数：所有的插值</li>
</ol>
<h1 id="4-函数"><a href="#4-函数" class="headerlink" title="4.函数"></a>4.函数</h1><h2 id="4-1-参数默认值"><a href="#4-1-参数默认值" class="headerlink" title="4-1 参数默认值"></a>4-1 参数默认值</h2><p>使用<br>原来的写法</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">function sum()&#123;</span><br><span class="line">    b = b === undefined &amp;&amp; 1;</span><br><span class="line">    c = c === undefined &amp;&amp; 2;</span><br><span class="line">    return a+b+c;</span><br><span class="line">&#125;</span><br><span class="line">console.log(sum(10));</span><br></pre></td></tr></table></figure>

<p>在书写形参时，直接给形参赋值，附的值即为默认值</p>
<p>这样一来，当调用函数时，如果没有给对应的参数赋值（给它的值是 undefined），则会自动使用默认值。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">function sum(a,b=1,c=2)&#123;</span><br><span class="line">    return a+b+c;</span><br><span class="line">&#125;</span><br><span class="line">console.log(sum(10));//相当于console.log(sum(10,undefined,undefined))</span><br><span class="line">console.log(sum(11,null,undefined));//就不对了，null为0</span><br><span class="line">console.log(sum(1,undefined,5))//1+1+5=7</span><br></pre></td></tr></table></figure>

<p>演示</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">// 面试题</span><br><span class="line">function getContainer() &#123;</span><br><span class="line">    console.log(&quot;abc&quot;);//问abc运行几次-------------------2次，因为两次都用了默认值</span><br><span class="line">    return document.getElementById(&quot;container&quot;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 创建一个元素</span><br><span class="line"> * @param &#123;*&#125; name 元素的名称</span><br><span class="line"> * @param &#123;*&#125; container 元素的父元素</span><br><span class="line"> * @param &#123;*&#125; content 元素的内容</span><br><span class="line"> */</span><br><span class="line">function createElement(name = &quot;div&quot;, container = getContainer(), content = &quot;&quot;) &#123;</span><br><span class="line">    const ele = document.createElement(name)</span><br><span class="line">    if (content) &#123;</span><br><span class="line">        ele.innerHTML = content;</span><br><span class="line">    &#125;</span><br><span class="line">    container.appendChild(ele);</span><br><span class="line">&#125;</span><br><span class="line">createElement(undefined, undefined, &quot;手动阀手动阀十分&quot;)//调用一次</span><br><span class="line">createElement(undefined, undefined, &quot;234242342424&quot;)//调用一次</span><br><span class="line">createElement(undefined, document.getElementById(&quot;container&quot;), &quot;234242342424&quot;)//传值了，不调用了</span><br></pre></td></tr></table></figure>

<p>[扩展]对 arguments 的影响<br>只要给函数加上参数默认值，该函数会自动变量<strong>严格模式下的规则：arguments 和形参脱离</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">function test(a, b) &#123;</span><br><span class="line">console.log(&quot;arugments&quot;, arguments[0], arguments[1]);//两个形参 	1 2</span><br><span class="line">console.log(&quot;a:&quot;, a, &quot;b:&quot;, b);//1 2</span><br><span class="line">a = 3;</span><br><span class="line">console.log(&quot;arugments&quot;, arguments[0], arguments[1]);// 3 2</span><br><span class="line">console.log(&quot;a:&quot;, a, &quot;b:&quot;, b);// 3 2</span><br><span class="line">&#125;</span><br><span class="line">test(1, 2);</span><br><span class="line">// 当加上参数默认值</span><br><span class="line">function test(a, b=1) &#123;</span><br><span class="line">console.log(&quot;arugments&quot;, arguments[0], arguments[1]);//两个形参 	1 2</span><br><span class="line">console.log(&quot;a:&quot;, a, &quot;b:&quot;, b);//1 2</span><br><span class="line">a = 3;</span><br><span class="line">console.log(&quot;arugments&quot;, arguments[0], arguments[1]);// 3 2</span><br><span class="line">console.log(&quot;a:&quot;, a, &quot;b:&quot;, b);// 3 2</span><br><span class="line">&#125;</span><br><span class="line">test(1, 2);</span><br></pre></td></tr></table></figure>

<p>[扩展]留意暂时性死区</p>
<p>形参和 ES6 中的 let 或 const 声明一样，具有作用域，并且根据参数的声明顺序，存在暂时性死区。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">function test(a, b=a) &#123;</span><br><span class="line">    console.log(a, b);//都有值，不会用参数默认值，1,2</span><br><span class="line">&#125;</span><br><span class="line">test(1, 2);</span><br><span class="line"></span><br><span class="line">function test(a, b=a) &#123;</span><br><span class="line">    console.log(a, b);//参数默认值：1,1</span><br><span class="line">&#125;</span><br><span class="line">test(1);</span><br><span class="line"></span><br><span class="line">function test(a = b, b) &#123;</span><br><span class="line">    console.log(a, b);/没有使用参数默认值：1,2</span><br><span class="line">&#125;</span><br><span class="line">test(1, 2);</span><br><span class="line"></span><br><span class="line">function test(a = b, b) &#123;</span><br><span class="line">    console.log(a, b);//Cannot access &#x27;b&#x27; before initialization</span><br><span class="line">&#125;</span><br><span class="line">test(undefined, 2);</span><br></pre></td></tr></table></figure>

<h2 id="4-2-剩余参数"><a href="#4-2-剩余参数" class="headerlink" title="4-2 剩余参数"></a>4-2 剩余参数</h2><p>旧方法</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">function sum(args)&#123;</span><br><span class="line">    let sum = 0;</span><br><span class="line">    for(let i = 0; i &lt; args.length; i++)&#123;</span><br><span class="line">        sum += args[i];</span><br><span class="line">    &#125;</span><br><span class="line">    return sum;</span><br><span class="line">&#125;</span><br><span class="line">console.log(sum([1]));//必须传数组</span><br></pre></td></tr></table></figure>

<p>升级</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sum</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> sum = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="built_in">arguments</span>.length; i++) &#123;</span><br><span class="line">    sum += <span class="built_in">arguments</span>[i];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> sum;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(sum(<span class="number">1</span>)); <span class="comment">//必须传数组</span></span><br></pre></td></tr></table></figure>

<p>arguments 的缺陷：</p>
<ol>
<li>如果和形参配合使用，容易导致混乱</li>
<li>从语义上，使用 arguments 获取参数，由于形参缺失，无法从函数定义上理解函数的真实意图</li>
</ol>
<p>ES6 的剩余参数专门用于收集末尾的所有参数，将其放置到一个形参数组中。</p>
<p>语法:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> (<span class="params">...形参名</span>)</span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>细节</strong></p>
<ol>
<li>一个函数，仅能出现一个剩余参数</li>
<li>一个函数，如果有剩余参数，剩余参数必须是最后一个参数</li>
</ol>
<p>演示 1</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sum</span>(<span class="params">...args</span>) </span>&#123;</span><br><span class="line">  <span class="comment">//args收集了所有的参数，形成的一个数组</span></span><br><span class="line">  <span class="keyword">let</span> sum = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; args.length; i++) &#123;</span><br><span class="line">    sum += args[i];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> sum;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(sum());</span><br><span class="line"><span class="built_in">console</span>.log(sum(<span class="number">1</span>));</span><br><span class="line"><span class="built_in">console</span>.log(sum(<span class="number">1</span>, <span class="number">2</span>));</span><br><span class="line"><span class="built_in">console</span>.log(sum(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>));</span><br></pre></td></tr></table></figure>

<p>演示 2</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params">...args1, ...args2</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(args1)</span><br><span class="line">    <span class="built_in">console</span>.log(args2)</span><br><span class="line">&#125;</span><br><span class="line">test(<span class="number">1</span>, <span class="number">32</span>, <span class="number">46</span>, <span class="number">7</span>, <span class="number">34</span>);</span><br></pre></td></tr></table></figure>

<p>演示 3</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params">a, b, ...args</span>) </span>&#123;&#125;</span><br><span class="line">test(<span class="number">1</span>, <span class="number">32</span>, <span class="number">46</span>, <span class="number">7</span>, <span class="number">34</span>);</span><br></pre></td></tr></table></figure>

<h2 id="4-3-展开运算符"><a href="#4-3-展开运算符" class="headerlink" title="4-3 展开运算符"></a>4-3 展开运算符</h2><p>使用方式：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">...要展开的东西</span><br></pre></td></tr></table></figure>

<p>对所有数字求和</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sum</span>(<span class="params">...args</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> sum = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; args.length; i++) &#123;</span><br><span class="line">    sum += args[i];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> sum;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>获取一个指定长度的随机数组成的数组</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getRandomNumbers</span>(<span class="params">length</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> arr = [];</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; length; i++) &#123;</span><br><span class="line">    arr.push(<span class="built_in">Math</span>.random());</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> arr;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> numbers = getRandomNumbers(<span class="number">10</span>);</span><br><span class="line"><span class="comment">//希望将数组的每一项展开，依次作为参数传递，而不是把整个数组作为一个参数传递</span></span><br><span class="line"><span class="comment">// 这就要用到展开运算符</span></span><br><span class="line"><span class="comment">// sum(numbers) 这是传了一个参数</span></span><br><span class="line"><span class="built_in">console</span>.log(sum(...numbers)); <span class="comment">//相当于传递了10个参数</span></span><br><span class="line"><span class="built_in">console</span>.log(sum(<span class="number">1</span>, <span class="number">3</span>, ...numbers, <span class="number">3</span>, <span class="number">5</span>));</span><br></pre></td></tr></table></figure>

<p>展开数组：克隆</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> arr1 = [<span class="number">3</span>, <span class="number">67</span>, <span class="number">8</span>, <span class="number">5</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">//克隆arr1数组到arr2</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// const arr2 = [0, ...arr1, 1];相加别的数</span></span><br><span class="line"><span class="keyword">const</span> arr2 = [...arr1];</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(arr2, arr1 === arr2); <span class="comment">//false</span></span><br></pre></td></tr></table></figure>

<p>展开对象：浅克隆</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj1 = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;成哥&quot;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="number">18</span>,</span><br><span class="line">  <span class="attr">love</span>: <span class="string">&quot;邓嫂&quot;</span>,</span><br><span class="line">  <span class="attr">address</span>: &#123;</span><br><span class="line">    <span class="attr">country</span>: <span class="string">&quot;中国&quot;</span>,</span><br><span class="line">    <span class="attr">province</span>: <span class="string">&quot;黑龙江&quot;</span>,</span><br><span class="line">    <span class="attr">city</span>: <span class="string">&quot;哈尔滨&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// 浅克隆到obj2</span></span><br><span class="line"><span class="keyword">const</span> obj2 = &#123;</span><br><span class="line">  ...obj1,</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;邓哥&quot;</span>, <span class="comment">//邓哥可以覆盖</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">console</span>.log(obj2);</span><br><span class="line"><span class="built_in">console</span>.log(obj1.address === obj2.address); <span class="comment">//true</span></span><br></pre></td></tr></table></figure>

<p>深克隆</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj1 = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;成哥&quot;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="number">18</span>,</span><br><span class="line">  <span class="attr">loves</span>: [<span class="string">&quot;邓嫂&quot;</span>, <span class="string">&quot;成嫂1&quot;</span>, <span class="string">&quot;成嫂2&quot;</span>],</span><br><span class="line">  <span class="attr">address</span>: &#123;</span><br><span class="line">    <span class="attr">country</span>: <span class="string">&quot;中国&quot;</span>,</span><br><span class="line">    <span class="attr">province</span>: <span class="string">&quot;黑龙江&quot;</span>,</span><br><span class="line">    <span class="attr">city</span>: <span class="string">&quot;哈尔滨&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// 深克隆到obj2</span></span><br><span class="line"><span class="keyword">const</span> obj2 = &#123;</span><br><span class="line">  ...obj1,</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;邓哥&quot;</span>,</span><br><span class="line">  <span class="attr">address</span>: &#123;</span><br><span class="line">    <span class="comment">//address深克隆</span></span><br><span class="line">    ...obj1.address,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">loves</span>: [...obj1.loves, <span class="string">&quot;成嫂3&quot;</span>], <span class="comment">//浅克隆</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">console</span>.log(obj2);</span><br><span class="line"><span class="built_in">console</span>.log(obj1.loves === obj2.loves);</span><br><span class="line"><span class="built_in">console</span>.log(obj1.address === obj2.address);</span><br></pre></td></tr></table></figure>

<h2 id="4-4-剩余参数和展开运算符练习"><a href="#4-4-剩余参数和展开运算符练习" class="headerlink" title="4-4 剩余参数和展开运算符练习"></a>4-4 剩余参数和展开运算符练习</h2><p>maxmin</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;ie=edge&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;number&quot;</span> <span class="attr">name</span>=<span class="string">&quot;&quot;</span> <span class="attr">id</span>=<span class="string">&quot;&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;number&quot;</span> <span class="attr">name</span>=<span class="string">&quot;&quot;</span> <span class="attr">id</span>=<span class="string">&quot;&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;number&quot;</span> <span class="attr">name</span>=<span class="string">&quot;&quot;</span> <span class="attr">id</span>=<span class="string">&quot;&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;number&quot;</span> <span class="attr">name</span>=<span class="string">&quot;&quot;</span> <span class="attr">id</span>=<span class="string">&quot;&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;number&quot;</span> <span class="attr">name</span>=<span class="string">&quot;&quot;</span> <span class="attr">id</span>=<span class="string">&quot;&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;number&quot;</span> <span class="attr">name</span>=<span class="string">&quot;&quot;</span> <span class="attr">id</span>=<span class="string">&quot;&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;number&quot;</span> <span class="attr">name</span>=<span class="string">&quot;&quot;</span> <span class="attr">id</span>=<span class="string">&quot;&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;number&quot;</span> <span class="attr">name</span>=<span class="string">&quot;&quot;</span> <span class="attr">id</span>=<span class="string">&quot;&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;number&quot;</span> <span class="attr">name</span>=<span class="string">&quot;&quot;</span> <span class="attr">id</span>=<span class="string">&quot;&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;number&quot;</span> <span class="attr">name</span>=<span class="string">&quot;&quot;</span> <span class="attr">id</span>=<span class="string">&quot;&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">button</span>&gt;</span>计算<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h2</span>&gt;</span>最大值：<span class="tag">&lt;<span class="name">span</span> <span class="attr">id</span>=<span class="string">&quot;spanmax&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h2</span>&gt;</span>最小值：<span class="tag">&lt;<span class="name">span</span> <span class="attr">id</span>=<span class="string">&quot;spanmin&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">        <span class="function"><span class="keyword">function</span> <span class="title">getValues</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">const</span> numbers = [];</span></span><br><span class="line"><span class="javascript">            <span class="keyword">const</span> inps = <span class="built_in">document</span>.querySelectorAll(<span class="string">&quot;input&quot;</span>)</span></span><br><span class="line"><span class="javascript">            <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; inps.length; i++) &#123;</span></span><br><span class="line"><span class="javascript">                numbers.push(+inps[i].value)<span class="comment">//+表示转换成数字</span></span></span><br><span class="line"><span class="javascript">            &#125;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">return</span> numbers;</span></span><br><span class="line"><span class="javascript">        &#125;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        <span class="keyword">const</span> btn = <span class="built_in">document</span>.querySelector(<span class="string">&quot;button&quot;</span>)</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        btn.onclick = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">const</span> numbers = getValues(); <span class="comment">//得到文本框中的所有数字形成的数组</span></span></span><br><span class="line"><span class="javascript">            spanmax.innerText = <span class="built_in">Math</span>.max(...numbers)</span></span><br><span class="line"><span class="javascript">            spanmin.innerText = <span class="built_in">Math</span>.min(...numbers)</span></span><br><span class="line"><span class="javascript">            <span class="comment">//老方法spanmax.innerText =Math.max.apply(null,numbers);this绑定null</span></span></span><br><span class="line"><span class="javascript">        &#125;</span></span><br><span class="line"><span class="javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>curry</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;ie=edge&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">      <span class="function"><span class="keyword">function</span> <span class="title">cal</span>(<span class="params">a, b, c, d</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">return</span> a + b * c - d;</span></span><br><span class="line"><span class="javascript">      &#125;</span></span><br><span class="line"><span class="javascript">      <span class="comment">//curry：柯里化，用户固定某个函数的前面的参数，得到一个新的函数，新的函数调用时，接收剩余的参数</span></span></span><br><span class="line"><span class="javascript">      <span class="function"><span class="keyword">function</span> <span class="title">curry</span>(<span class="params">func, ...args</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="comment">//后面不管几个</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">...subArgs</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">          <span class="comment">//新的函数也不知道几个</span></span></span><br><span class="line"><span class="javascript">          <span class="keyword">const</span> allArgs = [...args, ...subArgs];</span></span><br><span class="line"><span class="javascript">          <span class="keyword">if</span> (allArgs.length &gt;= func.length) &#123;</span></span><br><span class="line"><span class="javascript">            <span class="comment">//参数够了</span></span></span><br><span class="line"><span class="javascript">            <span class="keyword">return</span> func(...allArgs);</span></span><br><span class="line"><span class="javascript">          &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="javascript">            <span class="comment">//参数不够，继续固定</span></span></span><br><span class="line"><span class="javascript">            <span class="keyword">return</span> curry(func, ...allArgs);</span></span><br><span class="line"><span class="javascript">          &#125;</span></span><br><span class="line"><span class="javascript">        &#125;;</span></span><br><span class="line"><span class="javascript">      &#125;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">      <span class="keyword">const</span> newCal = curry(cal, <span class="number">1</span>, <span class="number">2</span>);</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(newCal(<span class="number">3</span>, <span class="number">4</span>)); <span class="comment">// 1+2*3-4</span></span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(newCal(<span class="number">4</span>, <span class="number">5</span>)); <span class="comment">// 1+2*4-5</span></span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(newCal(<span class="number">5</span>, <span class="number">6</span>)); <span class="comment">// 1+2*5-6</span></span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(newCal(<span class="number">6</span>, <span class="number">7</span>)); <span class="comment">// 1+2*6-7</span></span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">      <span class="keyword">const</span> newCal2 = newCal(<span class="number">8</span>);</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(newCal2(<span class="number">9</span>)); <span class="comment">// 1+2*8-9</span></span></span><br><span class="line"><span class="javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>demo</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params">a, b, c</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(a, b, c);</span><br><span class="line">&#125;</span><br><span class="line">test(<span class="number">2</span>, <span class="number">6</span>, <span class="number">7</span>);</span><br><span class="line"><span class="keyword">const</span> arr = [<span class="string">&quot;asf&quot;</span>, <span class="string">&quot;Gfh&quot;</span>, <span class="string">&quot;111&quot;</span>];</span><br><span class="line"><span class="comment">//以前apply</span></span><br><span class="line">test(...arr);</span><br></pre></td></tr></table></figure>

<h2 id="4-5-明确函数的双重用途"><a href="#4-5-明确函数的双重用途" class="headerlink" title="4-5 明确函数的双重用途"></a>4-5 明确函数的双重用途</h2><p>ES6 提供了一个特殊的 API，可以使用该 API 在函数内部，判断该函数是否使用了 new 来调用</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span>.target</span><br><span class="line"><span class="comment">//该表达式，得到的是：如果没有使用new来调用函数，则返回undefined</span></span><br><span class="line"><span class="comment">//如果使用new调用函数，则得到的是new关键字后面的函数本身</span></span><br></pre></td></tr></table></figure>

<p>普通函数与构造函数的使用</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params">firstName, lastName</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 判断是否是使用new的方式来调用的函数</span></span><br><span class="line">  <span class="comment">// 过去的判断方式</span></span><br><span class="line">  <span class="comment">// if (!(this instanceof Person)) &#123;</span></span><br><span class="line">  <span class="comment">//     throw new Error(&quot;该函数没有使用new来调用&quot;)</span></span><br><span class="line">  <span class="comment">// &#125;</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">new</span>.target === <span class="literal">undefined</span>) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&quot;该函数没有使用new来调用&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">this</span>.firstName = firstName;</span><br><span class="line">  <span class="built_in">this</span>.lastName = lastName;</span><br><span class="line">  <span class="built_in">this</span>.fullName = <span class="string">`<span class="subst">$&#123;firstName&#125;</span> <span class="subst">$&#123;lastName&#125;</span>`</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> p1 = <span class="keyword">new</span> Person(<span class="string">&quot;袁&quot;</span>, <span class="string">&quot;进&quot;</span>); <span class="comment">//构造函数 有效</span></span><br><span class="line"><span class="built_in">console</span>.log(p1);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> p2 = Person(<span class="string">&quot;袁&quot;</span>, <span class="string">&quot;进&quot;</span>); <span class="comment">//直接调用 无效</span></span><br><span class="line"><span class="built_in">console</span>.log(p2);</span><br><span class="line"><span class="comment">// 强行绑定this会绕开过去的判断方式</span></span><br><span class="line"><span class="keyword">const</span> p3 = Person.call(p1, <span class="string">&quot;袁&quot;</span>, <span class="string">&quot;进&quot;</span>);</span><br><span class="line"><span class="built_in">console</span>.log(p3);</span><br></pre></td></tr></table></figure>

<h2 id="4-6-箭头函数"><a href="#4-6-箭头函数" class="headerlink" title="4-6 箭头函数"></a>4-6 箭头函数</h2><p>回顾：this 指向</p>
<ol>
<li>通过对象调用函数，this 指向对象</li>
<li>直接调用函数，this 指向全局对象</li>
<li>如果通过 new 调用函数，this 指向新创建的对象</li>
<li>如果通过 apply、call、bind 调用函数，this 指向指定的数据</li>
<li>如果是 DOM 事件函数，this 指向事件源</li>
</ol>
<p>常见问题</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">    <span class="keyword">const</span> obj = &#123;</span></span><br><span class="line"><span class="javascript">      <span class="attr">count</span>: <span class="number">0</span>,</span></span><br><span class="line"><span class="javascript">      <span class="attr">start</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="comment">// obj调用的，所以this-&gt;obj</span></span></span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log(<span class="built_in">this</span>)<span class="comment">// obj对象，这里this没问题</span></span></span><br><span class="line"><span class="javascript">        <span class="built_in">setInterval</span>(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">          <span class="built_in">console</span>.log(<span class="built_in">this</span>);<span class="comment">//这里的this出了问题，JS引擎内部调用，直接调用的，this全局window</span></span></span><br><span class="line"><span class="javascript">          <span class="comment">// this.count++;undefined++==NAN</span></span></span><br><span class="line"><span class="javascript">          <span class="comment">// console.log(this.count);</span></span></span><br><span class="line"><span class="javascript">        &#125;,<span class="number">1000</span>)</span></span><br><span class="line"><span class="javascript">      &#125;,</span></span><br><span class="line"><span class="javascript">      <span class="attr">regEvent</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">window</span>.onclick = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">          <span class="built_in">console</span>.log(<span class="built_in">this</span>.count);<span class="comment">//事件，this指向事件源window</span></span></span><br><span class="line"><span class="javascript">        &#125;</span></span><br><span class="line"><span class="javascript">      &#125;</span></span><br><span class="line"><span class="javascript">    &#125;</span></span><br><span class="line"><span class="javascript">    obj.start();</span></span><br><span class="line"><span class="javascript">    obj.regEvent();</span></span><br><span class="line"><span class="javascript">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>解决方案：闭包</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">        <span class="keyword">const</span> obj = &#123;</span></span><br><span class="line"><span class="javascript">            <span class="attr">count</span>: <span class="number">0</span>,</span></span><br><span class="line"><span class="javascript">            <span class="attr">start</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">                <span class="comment">// this-&gt;obj</span></span></span><br><span class="line"><span class="javascript">                <span class="keyword">var</span> _this = <span class="built_in">this</span>;</span></span><br><span class="line"><span class="javascript">                <span class="built_in">setInterval</span>(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">                    <span class="built_in">console</span>.log(<span class="built_in">this</span>);</span></span><br><span class="line"><span class="javascript">                    _this.count++;</span></span><br><span class="line"><span class="javascript">                    <span class="built_in">console</span>.log(_this.count);</span></span><br><span class="line"><span class="javascript">                &#125;,<span class="number">1000</span>)</span></span><br><span class="line"><span class="javascript">            &#125;,</span></span><br><span class="line"><span class="javascript">            <span class="attr">regEvent</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">                <span class="keyword">var</span> _this = <span class="built_in">this</span>;</span></span><br><span class="line"><span class="javascript">                <span class="built_in">window</span>.onclick = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">                    <span class="built_in">console</span>.log(_this.count);</span></span><br><span class="line"><span class="javascript">                &#125;</span></span><br><span class="line"><span class="javascript">            &#125;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        &#125;</span></span><br><span class="line"><span class="javascript">        obj.start();</span></span><br><span class="line"><span class="javascript">        obj.regEvent();</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>使用语法</p>
<p>箭头函数是一个<strong>函数表达式</strong>，理论上，任何使用函数表达式的场景都可以使用箭头函数</p>
<p>完整语法：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">(参数<span class="number">1</span>, 参数<span class="number">2</span>, ...)=&gt;&#123;</span><br><span class="line">    <span class="comment">//函数体</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上述代码简化成</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">  <span class="attr">count</span>: <span class="number">0</span>,</span><br><span class="line">  <span class="attr">start</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">this</span>.count++;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="built_in">this</span>.count);</span><br><span class="line">    &#125;, <span class="number">1000</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">regEvent</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">window</span>.onclick = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="built_in">this</span>.count);</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">print</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="built_in">this</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="built_in">this</span>.count);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// obj.start();</span></span><br><span class="line"><span class="comment">// obj.regEvent();</span></span><br><span class="line">obj.print();</span><br><span class="line"><span class="comment">//不过，问题也随之解决了</span></span><br><span class="line"><span class="comment">//原因：箭头函数的函数体中的 this，取决于箭头函数定义的位置的 this 指向，而与如何调用无关</span></span><br></pre></td></tr></table></figure>

<p>如果参数只有一个，可以省略小括号</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(参数) =&gt; &#123;&#125;;</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> print = <span class="function">(<span class="params">num</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;给我的数字是：&quot;</span>, num);</span><br><span class="line">&#125;;</span><br><span class="line">print(<span class="number">2</span>);</span><br></pre></td></tr></table></figure>

<p>如果箭头函数只有一条返回语句，可以省略大括号，和 return 关键字</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(参数) =&gt; 返回值;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>判断一个数是不是奇数</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> isOdd = <span class="function"><span class="keyword">function</span> (<span class="params">num</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> num % <span class="number">2</span> !== <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>优化</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> isOdd = <span class="function">(<span class="params">num</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> num % <span class="number">2</span> !== <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>优化</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> isOdd = <span class="function">(<span class="params">num</span>) =&gt;</span> num % <span class="number">2</span> !== <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(isOdd(<span class="number">3</span>));</span><br><span class="line"><span class="built_in">console</span>.log(isOdd(<span class="number">4</span>));</span><br></pre></td></tr></table></figure>

<p>注意细节</p>
<p>-箭头函数的函数体中的 this，<strong>取决于箭头函数定义的位置的 this 指向</strong>，而与如何调用无关</p>
<ul>
<li>箭头函数中，不存在 this、arguments、new.target，如果使用了，则使用的是函数外层的对应的 this、arguments、new.target</li>
</ul>
<p>箭头函数没有原型，所以箭头函数不能作用构造函数使用</p>
<p>应用场景</p>
<ol>
<li>临时性使用的函数，并不会刻意调用它，比如：<ol>
<li>事件处理函数</li>
<li>异步处理函数(定时器函数)</li>
<li>其他临时性的函数</li>
</ol>
</li>
<li>为了绑定外层 this 的函数</li>
<li>在不影响其他代码的情况下，保持代码的简洁，最常见的，数组方法中的回调函数</li>
</ol>
<p>小现象</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">  <span class="attr">count</span>: <span class="number">0</span>,</span><br><span class="line">  <span class="attr">print</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="built_in">this</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="built_in">this</span>.count);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 相当于</span></span><br><span class="line">  <span class="comment">// print : this,</span></span><br><span class="line">  <span class="comment">// this没有在函数里面，就是window;</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> print = obj.print;</span><br><span class="line">print(); <span class="comment">//window undefined</span></span><br></pre></td></tr></table></figure>

<p>箭头函数能解决吗</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">  <span class="attr">count</span>: <span class="number">0</span>,</span><br><span class="line">  <span class="attr">print</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="built_in">this</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="built_in">this</span>.count);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> print = obj.print;</span><br><span class="line"><span class="comment">// console.log(print());//还是undefined</span></span><br></pre></td></tr></table></figure>

<p>这种问题通常不解决，开发中都是遇到函数里面套函数出现 this 指向问题，没有这种问题</p>
<p><strong>对象的属性不用箭头函数</strong></p>
<p>演示</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> sum = <span class="function">(<span class="params">a, b</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">a</span>: a,</span><br><span class="line">    <span class="attr">b</span>: b,</span><br><span class="line">    <span class="attr">sum</span>: a + b,</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">console</span>.log(sum(<span class="number">3</span>, <span class="number">5</span>));</span><br></pre></td></tr></table></figure>

<p>优化</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> sum = <span class="function">(<span class="params">a, b</span>) =&gt;</span> (&#123;</span><br><span class="line">  <span class="attr">a</span>: a,</span><br><span class="line">  <span class="attr">b</span>: b,</span><br><span class="line">  <span class="attr">sum</span>: a + b,</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">console</span>.log(sum(<span class="number">3</span>, <span class="number">5</span>));</span><br></pre></td></tr></table></figure>

<p>演示</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> func = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="built_in">this</span>); <span class="comment">//window</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>演示</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> func = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="built_in">this</span>); <span class="comment">//自己没有this,只能从外面找，是window</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="built_in">arguments</span>); <span class="comment">//也没有arguments</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">  <span class="attr">method</span>: func,</span><br><span class="line">&#125;;</span><br><span class="line">obj.method(<span class="number">234</span>);</span><br></pre></td></tr></table></figure>

<p>演示：面试题</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> func = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="built_in">this</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">  <span class="attr">method</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> func = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="built_in">this</span>); <span class="comment">//箭头函数没有this，往外看，function的this，this由obj调用，就是obj</span></span><br><span class="line">      <span class="built_in">console</span>.log(<span class="built_in">arguments</span>); <span class="comment">//箭头函数没有arguments,往外看，传的是234</span></span><br><span class="line">    &#125;;</span><br><span class="line">    func();</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line">obj.method(<span class="number">234</span>);</span><br></pre></td></tr></table></figure>

<p>演示   在不影响其他代码的情况下，保持代码的简洁，最常见的，数组方法中的回调函数</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> numbers = [<span class="number">3</span>, <span class="number">7</span>, <span class="number">78</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">345</span>];</span><br><span class="line"><span class="comment">//以前的方法const result = numbers.map(function(num)&#123;return num*2&#125;)</span></span><br><span class="line"><span class="keyword">const</span> result = numbers</span><br><span class="line">  .filter(<span class="function">(<span class="params">num</span>) =&gt;</span> num % <span class="number">2</span> !== <span class="number">0</span>)</span><br><span class="line">  .map(<span class="function">(<span class="params">num</span>) =&gt;</span> num * <span class="number">2</span>)</span><br><span class="line">  .reduce(<span class="function">(<span class="params">a, b</span>) =&gt;</span> a + b);</span><br><span class="line"><span class="built_in">console</span>.log(result);</span><br></pre></td></tr></table></figure>

<h1 id="5-对象"><a href="#5-对象" class="headerlink" title="5.对象"></a>5.对象</h1><h2 id="5-1-新增的对象字面量语法"><a href="#5-1-新增的对象字面量语法" class="headerlink" title="5-1 新增的对象字面量语法"></a>5-1 新增的对象字面量语法</h2><ol>
<li>成员速写<br>如果对象字面量初始化时，成员的名称来自于一个变量，并且和变量的名称相同，则可以进行简写</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createUser</span>(<span class="params">loginId, loginPwd, nickName</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">loginId</span>: loginId,</span><br><span class="line">    <span class="attr">loginPwd</span>: loginPwd,</span><br><span class="line">    <span class="attr">nickName</span>: nickName,</span><br><span class="line">    <span class="attr">id</span>: <span class="built_in">Math</span>.random(),</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(createUser(<span class="string">&quot;abc&quot;</span>), <span class="string">&quot;13&quot;</span>, <span class="string">&quot;aaa&quot;</span>);</span><br></pre></td></tr></table></figure>

<ol>
<li>成员速写</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">function createUser(loginId, loginPwd, nickName)&#123; return &#123; loginId, loginPwd,</span><br><span class="line">nickName, id : Math.random() &#125; &#125; console.log(createUser(&quot;abc&quot;),&quot;13&quot;,&quot;aaa&quot;)</span><br></pre></td></tr></table></figure>

<p>演示</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createUser</span>(<span class="params">loginId, loginPwd, nickName</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> sayHello = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">//这里不能用箭头函数，没有this，就调用外面的window了</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;loginId&quot;</span>, <span class="built_in">this</span>.loginId, <span class="string">&quot;nickname&quot;</span>, <span class="built_in">this</span>.nickName);</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    loginId,</span><br><span class="line">    loginPwd,</span><br><span class="line">    nickName,</span><br><span class="line">    sayHello,</span><br><span class="line">    <span class="attr">id</span>: <span class="built_in">Math</span>.random(),</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> u = createUser(<span class="string">&quot;abc&quot;</span>, <span class="string">&quot;123&quot;</span>, <span class="string">&quot;aaa&quot;</span>);</span><br><span class="line">u.sayHello();</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>方法速写<br>对象字面初始化时，方法可以省略冒号和 function 关键字</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> user = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;姬成&quot;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="number">100</span>,</span><br><span class="line">  <span class="attr">sayHello</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="built_in">this</span>.name, <span class="built_in">this</span>.age);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line">user.sayHello();</span><br></pre></td></tr></table></figure>

<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">const user = &#123; name: &quot;姬成&quot;, age: 100, sayHello()&#123; console.log(this.name,</span><br><span class="line">this.age) &#125; &#125; user.sayHello();</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>计算属性名<br>有的时候，初始化对象时，某些属性名可能来自于某个表达式的值，在 ES6，可以使用中括号来表示该属性名是通过计算得到的。</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> prop1 = <span class="string">&quot;name2&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> prop2 = <span class="string">&quot;age2&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> prop3 = <span class="string">&quot;sayHello2&quot;</span>;</span><br><span class="line"><span class="comment">// 以前必须user[prop1] = &#x27;姬成&#x27;</span></span><br><span class="line"><span class="keyword">const</span> user = &#123;</span><br><span class="line">  [prop1]: <span class="string">&quot;姬成&quot;</span>,</span><br><span class="line">  [prop2]: <span class="number">100</span>,</span><br><span class="line">  [prop3]() &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="built_in">this</span>[prop1], <span class="built_in">this</span>[prop2]);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line">user[prop3]();</span><br></pre></td></tr></table></figure>

<h2 id="5-2Object-的新增-API"><a href="#5-2Object-的新增-API" class="headerlink" title="5-2Object 的新增 API"></a>5-2Object 的新增 API</h2><blockquote>
<p>Object 是函数（构造函数）</p>
</blockquote>
<ol>
<li><p>Object.is<br>用于判断两个数据是否相等，基本上跟严格相等（===）是一致的，除了以下两点：</p>
<p>(1)NaN 和 NaN 相等<br>(2)+0 和-0 不相等</p>
</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">console.log(NaN === NaN); // false console.log(+0 === -0); // true</span><br><span class="line">console.log(Object.is(NaN, NaN))// true console.log(Object.is(+0, -0))// false</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>Object.assign 后面覆盖前面<br>用于混合对象</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">const obj1 = &#123; a: 123, b: 456, c: &quot;abc&quot; &#125; const obj2 = &#123; a: 789, d: &quot;kkk&quot; &#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">想这样</span></span><br><span class="line"><span class="comment">&#123;</span></span><br><span class="line"><span class="comment">    a: 789,</span></span><br><span class="line"><span class="comment">    b: 456,</span></span><br><span class="line"><span class="comment">    c: &quot;abc&quot;,</span></span><br><span class="line"><span class="comment">    d: &quot;kkk&quot;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p>ES7 做法：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">const obj = &#123; ...obj1, ...obj2 //后面覆盖前面 &#125; console.log(obj);</span><br></pre></td></tr></table></figure>

<p>Object.assign 做法：</p>
<p>将 obj2 的数据，覆盖到 obj1，并且会对 obj1 产生改动，然后返回 obj1。对 obj1 改动了</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">const obj = Object.assign(obj1, obj2);</span><br></pre></td></tr></table></figure>

<p>防止产生影响</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">const obj = Object.assign(&#123;&#125;, obj1, obj2);// 只改动了&#123;&#125;，没有改动obj1,obj2</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>Object.getOwnPropertyNames 的枚举顺序<br>Object.getOwnPropertyNames 方法之前就存在，只不过，官方没有明确要求，对属性的顺序如何排序，如何排序，完全由浏览器厂商决定。</li>
</ol>
<p>ES6 规定了该方法返回的数组的排序方式如下：<br>先排数字，并按照升序排序<br>再排其他，按照书写顺序排序</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">const obj = &#123; d: 1, b: 2, a: 3, 0: 6, 5: 2, 4: 1 &#125; const props =</span><br><span class="line">Object.getOwnPropertyNames(obj)//返回字符串数组 console.log(props)</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>Object.setPrototypeOf</li>
</ol>
<p>该函数用于设置某个对象的隐式原型<br>比如： Object.setPrototypeOf(obj1, obj2)，<br>相当于： <code>obj1.__proto__ = obj2</code><br>演示</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj1 = &#123;</span><br><span class="line">  <span class="attr">a</span>: <span class="number">1</span>,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> obj2 = &#123;</span><br><span class="line">  <span class="attr">b</span>: <span class="number">2</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// obj1.__proto__ = obj2</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">Object</span>.setPrototypeOf(obj1, obj2);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(obj1);</span><br></pre></td></tr></table></figure>

<h2 id="5-3-面向对象简介"><a href="#5-3-面向对象简介" class="headerlink" title="5-3 面向对象简介"></a>5-3 面向对象简介</h2><p>面向对象：一种编程思想，跟具体的语言<br>对比面向过程：</p>
<ul>
<li>面向过程：思考的切入点是功能的步骤</li>
<li>面向对象：思考的切入点是对象的划分<br>【大象装冰箱】<br>面向过程（小工程）</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">//1. 冰箱门打开 function openFrige()&#123; &#125; openFrige(); //2. 大象装进去 function</span><br><span class="line">elephantIn()&#123; &#125; elephantIn(); //3. 冰箱门关上 function closeFrige()&#123; &#125;</span><br><span class="line">closeFrige();</span><br></pre></td></tr></table></figure>

<p>面向对象（大型工程）</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">/** * 大象 */ function Elephant() &#123; &#125; /** * 冰箱 */ function Frige() &#123; &#125;</span><br><span class="line">Frige.prototype.openDoor = function () &#123; &#125; Frige.prototype.closeDoor = function</span><br><span class="line">() &#123; &#125; Frige.prototype.join = function(something)&#123; this.openDoor(); //装东西</span><br><span class="line">this.closeDoor(); &#125; //1. 冰箱门打开 // var frig = new Frige(); //</span><br><span class="line">frig.openDoor(); // //2. 大象装进去 // var ele = new Elephant(); //</span><br><span class="line">frig.join(ele); // //3. 冰箱门关上 // frig.closeDoor(); var frig = new Frige();</span><br><span class="line">frig.join(new Elephant());</span><br></pre></td></tr></table></figure>

<h2 id="5-4-类：构造函数的语法糖"><a href="#5-4-类：构造函数的语法糖" class="headerlink" title="5-4 类：构造函数的语法糖"></a>5-4 类：构造函数的语法糖</h2><p><strong>传统的构造函数的问题</strong></p>
<ol>
<li>属性和原型方法定义分离，降低了可读性</li>
<li>原型成员可以被枚举，但是不希望枚举</li>
<li>默认情况下，构造函数仍然可以被当作普通函数使用</li>
</ol>
<p>面向对象中，将下面对一个对象的所有成员的定义，统称为类</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//构造函数  构造器</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Animal</span>(<span class="params">type, name, age, sex</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">this</span>.type = type;</span><br><span class="line">  <span class="built_in">this</span>.name = name;</span><br><span class="line">  <span class="built_in">this</span>.age = age;</span><br><span class="line">  <span class="built_in">this</span>.sex = sex;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 中间存在1万行代码</span></span><br><span class="line"><span class="comment">//定义实例方法（原型方法）</span></span><br><span class="line">Animal.prototype.print = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`【种类】：<span class="subst">$&#123;<span class="built_in">this</span>.type&#125;</span>`</span>);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`【名字】：<span class="subst">$&#123;<span class="built_in">this</span>.name&#125;</span>`</span>);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`【年龄】：<span class="subst">$&#123;<span class="built_in">this</span>.age&#125;</span>`</span>);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`【性别】：<span class="subst">$&#123;<span class="built_in">this</span>.sex&#125;</span>`</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> a = <span class="keyword">new</span> Animal(<span class="string">&quot;狗&quot;</span>, <span class="string">&quot;旺财&quot;</span>, <span class="number">3</span>, <span class="string">&quot;男&quot;</span>);</span><br><span class="line">a.print();</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> prop <span class="keyword">in</span> a) &#123;</span><br><span class="line">  <span class="comment">//枚举</span></span><br><span class="line">  <span class="built_in">console</span>.log(prop); <span class="comment">// 也把print（原型上的东西也遍历出来了，这是不希望的）</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>类的特点</strong></p>
<ol>
<li>类声明不会被提升，与 let 和 const 一样，存在暂时性死区</li>
<li>类中的所有代码均在严格模式下执行</li>
<li>类的所有方法都是不可枚举的</li>
<li>类的所有方法都无法被当作构造函数使用</li>
<li>类的构造器必须使用 new 来调用</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Animal</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">type, name, age, sex</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.type = type;</span><br><span class="line">    <span class="built_in">this</span>.name = name;</span><br><span class="line">    <span class="built_in">this</span>.age = age;</span><br><span class="line">    <span class="built_in">this</span>.sex = sex;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="title">print</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`【种类】：<span class="subst">$&#123;<span class="built_in">this</span>.type&#125;</span>`</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`【名字】：<span class="subst">$&#123;<span class="built_in">this</span>.name&#125;</span>`</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`【年龄】：<span class="subst">$&#123;<span class="built_in">this</span>.age&#125;</span>`</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`【性别】：<span class="subst">$&#123;<span class="built_in">this</span>.sex&#125;</span>`</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> a = <span class="keyword">new</span> Animal(<span class="string">&quot;狗&quot;</span>, <span class="string">&quot;旺财&quot;</span>, <span class="number">3</span>, <span class="string">&quot;男&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> a = Animal(<span class="string">&quot;狗&quot;</span>, <span class="string">&quot;旺财&quot;</span>, <span class="number">3</span>, <span class="string">&quot;男&quot;</span>); <span class="comment">//error不能当普通函数调用</span></span><br><span class="line"><span class="keyword">const</span> p = <span class="keyword">new</span> a.print(); <span class="comment">//error   类的所有方法都无法被当作构造函数使用</span></span><br><span class="line">a.print();</span><br><span class="line"><span class="built_in">console</span>.log(a);</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> prop <span class="keyword">in</span> a) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(prop); <span class="comment">//不会遍历原形了</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="5-5-类的其他书写方式"><a href="#5-5-类的其他书写方式" class="headerlink" title="5-5 类的其他书写方式"></a>5-5 类的其他书写方式</h2><ol>
<li>可计算的成员名</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> printName = <span class="string">&quot;print&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Animal</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">type, name, age, sex</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.type = type;</span><br><span class="line">    <span class="built_in">this</span>.name = name;</span><br><span class="line">    <span class="built_in">this</span>.age = age;</span><br><span class="line">    <span class="built_in">this</span>.sex = sex;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  [printName]() &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`【种类】：<span class="subst">$&#123;<span class="built_in">this</span>.type&#125;</span>`</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`【名字】：<span class="subst">$&#123;<span class="built_in">this</span>.name&#125;</span>`</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`【年龄】：<span class="subst">$&#123;<span class="built_in">this</span>.age&#125;</span>`</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`【性别】：<span class="subst">$&#123;<span class="built_in">this</span>.sex&#125;</span>`</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> a = <span class="keyword">new</span> Animal(<span class="string">&quot;狗&quot;</span>, <span class="string">&quot;旺财&quot;</span>, <span class="number">3</span>, <span class="string">&quot;男&quot;</span>);</span><br><span class="line">a[printName]();</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>getter 和 setter<br>Object.defineProperty 可定义某个对象成员属性的读取和设置<br>使用 getter 和 setter 控制的属性，不在原型上</li>
</ol>
<p>对年龄限制：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> printName = <span class="string">&quot;print&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Animal</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">age</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.setAge(age);</span><br><span class="line">    <span class="built_in">this</span>.sex = sex;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="title">getAge</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>._age + <span class="string">&quot;岁&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="title">setAge</span>(<span class="params">age</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (age &lt; <span class="number">0</span>) &#123;</span><br><span class="line">      age = <span class="number">0</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (age &gt; <span class="number">1000</span>) &#123;</span><br><span class="line">      age = <span class="number">1000</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">this</span>._age = age;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  [printName]() &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`【年龄】：<span class="subst">$&#123;<span class="built_in">this</span>.age&#125;</span>`</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> a = <span class="keyword">new</span> Animal(<span class="string">&quot;狗&quot;</span>, <span class="string">&quot;旺财&quot;</span>, <span class="number">3</span>, <span class="string">&quot;男&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>升级</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> printName = <span class="string">&quot;print&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Animal</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">type, name, age, sex</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.type = type;</span><br><span class="line">    <span class="built_in">this</span>.name = name;</span><br><span class="line">    <span class="built_in">this</span>.age = age;</span><br><span class="line">    <span class="built_in">this</span>.sex = sex;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//创建一个age属性，并给它加上getter，读取该属性时，会运行该函数</span></span><br><span class="line">  <span class="keyword">get</span> <span class="title">age</span>() &#123;</span><br><span class="line">    <span class="comment">// 不能给参数</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>._age + <span class="string">&quot;岁&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//创建一个age属性，并给它加上setter，给该属性赋值时，会运行该函数</span></span><br><span class="line">  <span class="keyword">set</span> <span class="title">age</span>(<span class="params">age</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> age !== <span class="string">&quot;number&quot;</span>) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">TypeError</span>(<span class="string">&quot;age property must be a number&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (age &lt; <span class="number">0</span>) &#123;</span><br><span class="line">      age = <span class="number">0</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (age &gt; <span class="number">1000</span>) &#123;</span><br><span class="line">      age = <span class="number">1000</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">this</span>._age = age;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  [printName]() &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`【种类】：<span class="subst">$&#123;<span class="built_in">this</span>.type&#125;</span>`</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`【名字】：<span class="subst">$&#123;<span class="built_in">this</span>.name&#125;</span>`</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`【年龄】：<span class="subst">$&#123;<span class="built_in">this</span>.age&#125;</span>`</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`【性别】：<span class="subst">$&#123;<span class="built_in">this</span>.sex&#125;</span>`</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> a = <span class="keyword">new</span> Animal(<span class="string">&quot;狗&quot;</span>, <span class="string">&quot;旺财&quot;</span>, <span class="number">3</span>, <span class="string">&quot;男&quot;</span>);</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>静态成员<br>构造函数本身的成员。Animal.abc<br>使用 static 关键字定义的成员即静态成员</li>
</ol>
<p>象棋 demo：不需要创建旗子也知道宽高。宽高不应该作为实例属性</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Chess</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">name</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.name = name;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">static</span> width = <span class="number">50</span>;</span><br><span class="line">  <span class="keyword">static</span> height = <span class="number">50</span>;</span><br><span class="line">  <span class="keyword">static</span> <span class="function"><span class="title">method</span>(<span class="params"></span>)</span> &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(Chess.width);</span><br><span class="line"><span class="built_in">console</span>.log(Chess.height);</span><br><span class="line">Chess.method();</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>字段初始化器（ES7）</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">  <span class="keyword">static</span> a = <span class="number">1</span>; <span class="comment">// a在Test.a里面</span></span><br><span class="line">  <span class="comment">// a = 1;</span></span><br><span class="line">  b = <span class="number">2</span>; <span class="comment">//实例成员</span></span><br><span class="line">  c = <span class="number">3</span>;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="comment">// 相当于</span></span><br><span class="line">    <span class="comment">// b = 2;</span></span><br><span class="line">    <span class="comment">// c = 3;</span></span><br><span class="line">    <span class="built_in">this</span>.d = <span class="built_in">this</span>.b + <span class="built_in">this</span>.c;</span><br><span class="line">    <span class="comment">// d=5</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> t = <span class="keyword">new</span> Test();</span><br><span class="line"><span class="built_in">console</span>.log(t);</span><br></pre></td></tr></table></figure>

<p>注意：<br><strong>1). 使用 static 的字段初始化器，添加的是静态成员</strong><br>** 2). 没有使用 static 的字段初始化器，添加的成员位于对象上**<br><strong>3). 箭头函数在字段初始化器位置上，指向当前对象</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">  <span class="comment">// 这里相当于a = 123;</span></span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.a = <span class="number">123</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="title">print</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="built_in">this</span>.a);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> t = <span class="keyword">new</span> Test();</span><br><span class="line">t.print(); <span class="comment">//123</span></span><br></pre></td></tr></table></figure>

<p>为了绑定方法里面的 this，让 this 始终指向当前对象，防止有人这样做</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.a = <span class="number">123</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="title">print</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="built_in">this</span>.a); <span class="comment">// 严格模式this-&gt;undefined</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> t = <span class="keyword">new</span> Test();</span><br><span class="line"><span class="keyword">const</span> p = t.print();</span><br><span class="line">p(); <span class="comment">// this--&gt; undefiend</span></span><br></pre></td></tr></table></figure>

<p>利用字段初始化器，print 赋值为一个箭头函数。<strong>箭头函数在字段初始化器位置上，指向当前对象</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.a = <span class="number">123</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  print = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="built_in">this</span>.a); <span class="comment">// this指向当前对象。因为字段初始化器相当于在构造函数前写上this.print=()=&gt;&#123;console.log(this.a)&#125;</span></span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> t = <span class="keyword">new</span> Test();</span><br><span class="line"><span class="keyword">const</span> p = t.print;</span><br><span class="line">p(); <span class="comment">//123</span></span><br></pre></td></tr></table></figure>

<p>现在的 print 不在原形上了，现在在对象上</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.a = <span class="number">123</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  print = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="built_in">this</span>.a);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> t1 = <span class="keyword">new</span> Test();</span><br><span class="line"><span class="keyword">const</span> t2 = <span class="keyword">new</span> Test();</span><br><span class="line"><span class="built_in">console</span>.log(t1.print === t2.print); <span class="comment">// false 每一个对象有一个自己的print</span></span><br></pre></td></tr></table></figure>

<ol start="5">
<li>类表达式</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> A = <span class="class"><span class="keyword">class</span> </span>&#123;</span><br><span class="line">  <span class="comment">//匿名类，类表达式</span></span><br><span class="line">  a = <span class="number">1</span>;</span><br><span class="line">  b = <span class="number">2</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> a = <span class="keyword">new</span> A();</span><br><span class="line"><span class="built_in">console</span>.log(a);</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>[扩展]装饰器（ES7）(Decorator)</li>
</ol>
<p>还没成为正式标准，浏览器不支持<br>横切关注点<br>装饰器的本质是一个函数</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">  @Obsolete <span class="comment">// 标记已过期</span></span><br><span class="line">  <span class="function"><span class="title">print</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;print方法&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Obsolete</span>(<span class="params">target, methodName, descriptor</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 装饰器的本质是一个函数</span></span><br><span class="line">  <span class="comment">// 分别会输出：</span></span><br><span class="line">  <span class="comment">// function Test</span></span><br><span class="line">  <span class="comment">// print</span></span><br><span class="line">  <span class="comment">// &#123; value: function print()&#123;&#125;, ... &#125;</span></span><br><span class="line">  <span class="comment">// console.log(target, methodName, descriptor);</span></span><br><span class="line">  <span class="keyword">const</span> oldFunc = descriptor.value;</span><br><span class="line">  descriptor.value = <span class="function"><span class="keyword">function</span> (<span class="params">...args</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.warn(<span class="string">`<span class="subst">$&#123;methodName&#125;</span>方法已过时`</span>);</span><br><span class="line">    oldFunc.apply(<span class="built_in">this</span>, args);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="5-6-类的继承"><a href="#5-6-类的继承" class="headerlink" title="5-6 类的继承"></a>5-6 类的继承</h2><p>如果两个类 A 和 B，如果可以描述为：B 是 A，则，A 和 B 形成继承关系<br>如果 B 是 A，则：</p>
<ol>
<li>B 继承自 A</li>
<li>A 派生 B</li>
<li>B 是 A 的子类</li>
<li>A 是 B 的父类</li>
</ol>
<p><strong>如果 A 是 B 的父类，则 B 会自动拥有 A 中的所有实例成员。</strong></p>
<p>这样狗里面没有 print，要实现继承，必须 Dog_prototype—&gt;Animal prototype<br>老方法：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Animal</span>(<span class="params">type, name, age, sex</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">this</span>.type = type;</span><br><span class="line">  <span class="built_in">this</span>.name = name;</span><br><span class="line">  <span class="built_in">this</span>.age = age;</span><br><span class="line">  <span class="built_in">this</span>.sex = sex;</span><br><span class="line">&#125;</span><br><span class="line">Animal.prototype.print = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`【种类】：<span class="subst">$&#123;<span class="built_in">this</span>.type&#125;</span>`</span>);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`【名字】：<span class="subst">$&#123;<span class="built_in">this</span>.name&#125;</span>`</span>);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`【年龄】：<span class="subst">$&#123;<span class="built_in">this</span>.age&#125;</span>`</span>);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`【性别】：<span class="subst">$&#123;<span class="built_in">this</span>.sex&#125;</span>`</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 以前</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Dog</span>(<span class="params">name, age, sex</span>) </span>&#123;</span><br><span class="line">  <span class="comment">//借用父类的构造函数</span></span><br><span class="line">  Animal.call(<span class="built_in">this</span>, <span class="string">&quot;犬类&quot;</span>, name, age, sex);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">Object</span>.setPrototypeOf(Dog.prototype, Animal.prototype);</span><br><span class="line"><span class="comment">// 把Dog.prototype的隐式原形设置成Animal.prototype的</span></span><br><span class="line"><span class="keyword">const</span> d = <span class="keyword">new</span> Dog(<span class="string">&quot;旺财&quot;</span>, <span class="number">3</span>, <span class="string">&quot;公&quot;</span>);</span><br><span class="line">d.print();</span><br><span class="line"><span class="built_in">console</span>.log(d);</span><br></pre></td></tr></table></figure>

<p>新的关键字：</p>
<ul>
<li>extends：继承，用于类的定义</li>
<li>super</li>
<li>直接当作函数调用，表示父类构造函数</li>
<li>如果当作对象使用，则表示父类的原型<br>注意：ES6 要求，如果定义了 constructor，并且该类是子类，则必须在 constructor 的第一行手动调用父类的构造函数<br>如果子类不写 constructor，则会有默认的构造器，该构造器需要的参数和父类一致，并且自动调用父类构造器</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Animal</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">type, name, age, sex</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.type = type;</span><br><span class="line">    <span class="built_in">this</span>.name = name;</span><br><span class="line">    <span class="built_in">this</span>.age = age;</span><br><span class="line">    <span class="built_in">this</span>.sex = sex;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="title">print</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`【种类】：<span class="subst">$&#123;<span class="built_in">this</span>.type&#125;</span>`</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`【名字】：<span class="subst">$&#123;<span class="built_in">this</span>.name&#125;</span>`</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`【年龄】：<span class="subst">$&#123;<span class="built_in">this</span>.age&#125;</span>`</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`【性别】：<span class="subst">$&#123;<span class="built_in">this</span>.sex&#125;</span>`</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="title">jiao</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&quot;动物怎么叫的？&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Dog</span> <span class="keyword">extends</span> <span class="title">Animal</span> </span>&#123;</span><br><span class="line">  <span class="comment">//翻译:狗继承自animal</span></span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">name, age, sex</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>(<span class="string">&quot;犬类&quot;</span>, name, age, sex); <span class="comment">// Animal，就不用Animal.call了</span></span><br><span class="line">    <span class="built_in">this</span>.loves = <span class="string">&quot;吃骨头&quot;</span>; <span class="comment">// 子类特有的属性，父类不知道</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="title">print</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>.print(); <span class="comment">//其他模块想调用父类的print</span></span><br><span class="line">    <span class="comment">//自己特有的代码</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`【爱好】：<span class="subst">$&#123;<span class="built_in">this</span>.loves&#125;</span>`</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="title">jiao</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="comment">//同名方法，会覆盖父类</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;旺旺！&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> d = <span class="keyword">new</span> Dog(<span class="string">&quot;旺财&quot;</span>, <span class="number">3</span>, <span class="string">&quot;公&quot;</span>);</span><br><span class="line">d.print();</span><br><span class="line"><span class="built_in">console</span>.log(d); <span class="comment">// 原形</span></span><br><span class="line">d.jiao();</span><br></pre></td></tr></table></figure>

<p>【冷知识】</p>
<ul>
<li>用 JS 制作抽象类</li>
<li>抽象类：一般是父类，不能通过该类创建对象</li>
<li>正常情况下，this 的指向，this 始终指向具体的类的对象</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Animal</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">type, name, age, sex</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">new</span>.target === Animal) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">TypeError</span>(<span class="string">&quot;你不能直接创建Animal的对象，应该通过子类创建&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">this</span>.type = type;</span><br><span class="line">    <span class="built_in">this</span>.name = name;</span><br><span class="line">    <span class="built_in">this</span>.age = age;</span><br><span class="line">    <span class="built_in">this</span>.sex = sex;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="title">print</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`【种类】：<span class="subst">$&#123;<span class="built_in">this</span>.type&#125;</span>`</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`【名字】：<span class="subst">$&#123;<span class="built_in">this</span>.name&#125;</span>`</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`【年龄】：<span class="subst">$&#123;<span class="built_in">this</span>.age&#125;</span>`</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`【性别】：<span class="subst">$&#123;<span class="built_in">this</span>.sex&#125;</span>`</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="title">jiao</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&quot;动物怎么叫的？&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Dog</span> <span class="keyword">extends</span> <span class="title">Animal</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">name, age, sex</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>(<span class="string">&quot;犬类&quot;</span>, name, age, sex);</span><br><span class="line">    <span class="comment">// 子类特有的属性</span></span><br><span class="line">    <span class="built_in">this</span>.loves = <span class="string">&quot;吃骨头&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="title">print</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="comment">//调用父类的print</span></span><br><span class="line">    <span class="built_in">super</span>.print();</span><br><span class="line">    <span class="comment">//自己特有的代码</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`【爱好】：<span class="subst">$&#123;<span class="built_in">this</span>.loves&#125;</span>`</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//同名方法，会覆盖父类</span></span><br><span class="line">  <span class="function"><span class="title">jiao</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;旺旺！&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//下面的代码逻辑有误</span></span><br><span class="line"><span class="keyword">const</span> a = <span class="keyword">new</span> Dog(<span class="string">&quot;旺财&quot;</span>, <span class="number">3</span>, <span class="string">&quot;公&quot;</span>);</span><br><span class="line">a.print();</span><br></pre></td></tr></table></figure>

<p>es5 和 es6 继承方式的区别<br>ES5 的继承实质上是先创建子类的实例对象，然后再将父类的方法添加<br>到 this.上(Parent.apply(this)) .<br>ES6 的继承机制完全不同，实质上是先创建父类的实例对象 this (所以必<br>须先调用父类的 super()方法)，然后再用子类的构造函数修改 this。<br>ES5 的继承时通过原型或构造函数机制来实现。<br>ES6 通过 class 关键字定义类，里面有构造方法，类之间通过 extends 关<br>键字实现继承。<br>子类必须在 constructor 方法中调用 super 方法，否则新建实例报错。因<br>为子类没有自己的 this 对象，而是继承了父类的 this 对象,然后对其进行加工。<br>如果不调用 supe<br>per<br>方法，子类得不到 this 对象。<br>注意 super<br>关键字指代父类的实例，即父类的 this 对象。<br>注意:在子类构造函数中，调用 super 后，才可使用 this 关键字，否则<br>报错。</p>
<h1 id="6-解构"><a href="#6-解构" class="headerlink" title="6.解构"></a>6.解构</h1><h2 id="6-1-对象解构"><a href="#6-1-对象解构" class="headerlink" title="6-1 对象解构"></a>6-1 对象解构</h2><p><strong>什么是解构</strong><br>使用 ES6 的一种语法规则，将一个对象或数组的某个属性提取到某个变量中<br>解构不会对被解构的目标造成任何影响</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> user = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;kevin&quot;</span>,</span><br><span class="line">    <span class="attr">age</span>: <span class="number">11</span>,</span><br><span class="line">    <span class="attr">sex</span>: <span class="string">&quot;男&quot;</span>,</span><br><span class="line">    <span class="attr">address</span>: &#123;</span><br><span class="line">        <span class="attr">province</span>: <span class="string">&quot;四川&quot;</span>,</span><br><span class="line">        <span class="attr">city</span>: <span class="string">&quot;成都&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 以前</span></span><br><span class="line"><span class="comment">// let name, age, sex, address;</span></span><br><span class="line"><span class="comment">// name = user.name;</span></span><br><span class="line"><span class="comment">// age = user.age;</span></span><br><span class="line"><span class="comment">// sex = user.sex;</span></span><br><span class="line"><span class="comment">// address = user.address;</span></span><br><span class="line"><span class="comment">// 有了解构</span></span><br><span class="line">写法<span class="number">1</span>：</span><br><span class="line"><span class="keyword">let</span> name, age, sex, address, abc;</span><br><span class="line">(&#123; name, age, sex, address &#125; = user);</span><br><span class="line">写法<span class="number">2</span>：</span><br><span class="line"><span class="keyword">let</span> &#123;name,age,sex,address&#125; = user;</span><br></pre></td></tr></table></figure>

<p><strong>在解构中使用默认值</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  同名变量 = 默认值; <span class="comment">//赋值</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>demo</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 先定义5个变量，然后从对象中读取同名属性，放到变量中</span></span><br><span class="line"><span class="keyword">let</span> &#123; name, age, sex, address, abc = <span class="number">123</span> &#125; = user;</span><br><span class="line"><span class="built_in">console</span>.log(name, age, sex, address, abc); <span class="comment">// 如果abc不赋值，就是undefined</span></span><br></pre></td></tr></table></figure>

<p><strong>非同名属性解构</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  属性名: 变量名;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>demo</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> user = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;kevin&quot;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="number">11</span>,</span><br><span class="line">  <span class="attr">sex</span>: <span class="string">&quot;男&quot;</span>,</span><br><span class="line">  <span class="attr">address</span>: &#123;</span><br><span class="line">    <span class="attr">province</span>: <span class="string">&quot;四川&quot;</span>,</span><br><span class="line">    <span class="attr">city</span>: <span class="string">&quot;成都&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// 先定义4个变量：name、age、gender、address</span></span><br><span class="line"><span class="comment">// 再从对象user中读取同名属性赋值（其中gender读取的是sex属性）</span></span><br><span class="line"><span class="keyword">let</span> &#123; name, age, <span class="attr">sex</span>: gender = <span class="number">123</span>, address &#125; = user;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(name, age, gender, address);</span><br></pre></td></tr></table></figure>

<p>深入解构</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> user = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;kevin&quot;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="number">11</span>,</span><br><span class="line">  <span class="attr">sex</span>: <span class="string">&quot;男&quot;</span>,</span><br><span class="line">  <span class="attr">address</span>: &#123;</span><br><span class="line">    <span class="attr">province</span>: <span class="string">&quot;四川&quot;</span>,</span><br><span class="line">    <span class="attr">city</span>: <span class="string">&quot;成都&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//解构出user中的name、province</span></span><br><span class="line"><span class="comment">//定义两个变量name、province</span></span><br><span class="line"><span class="comment">//再解构</span></span><br><span class="line"><span class="keyword">const</span> &#123;</span><br><span class="line">  name,</span><br><span class="line">  <span class="attr">address</span>: &#123; province &#125;,</span><br><span class="line">&#125; = user;</span><br><span class="line"><span class="built_in">console</span>.log(name, address, province); <span class="comment">// address is not defined。对address进一步解构，不会当变量</span></span><br></pre></td></tr></table></figure>

<h2 id="6-2-数组解构"><a href="#6-2-数组解构" class="headerlink" title="6-2 数组解构"></a>6-2 数组解构</h2><p><strong>数组本质是对象</strong><br>对象大括号解构，数组中括号<br>演示 1</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> numbers = [<span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>, <span class="string">&quot;c&quot;</span>, <span class="string">&quot;d&quot;</span>];</span><br><span class="line"><span class="keyword">const</span> &#123; <span class="number">0</span>: n1, <span class="number">1</span>: n2 &#125; = numbers;</span><br><span class="line"><span class="built_in">console</span>.log(n1, n2);</span><br></pre></td></tr></table></figure>

<p>继续简化</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> n1, n2;</span><br><span class="line">[n1, n2] = numbers;</span><br></pre></td></tr></table></figure>

<p>等价于</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> [n1, n2] = numbers;</span><br></pre></td></tr></table></figure>

<p>按需取值</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> numbers = [<span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>, <span class="string">&quot;c&quot;</span>, <span class="string">&quot;d&quot;</span>];</span><br><span class="line"><span class="keyword">const</span> [n1, , , n4, n5 = <span class="number">123</span>] = numbers;</span><br><span class="line"><span class="built_in">console</span>.log(n1, n4, n5);</span><br></pre></td></tr></table></figure>

<p>带有嵌套:得到 numbers 下标为 4 的数组中的下标为 2 的数据，放到变量 n 中</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> numbers = [<span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>, <span class="string">&quot;c&quot;</span>, <span class="string">&quot;d&quot;</span>, [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]];</span><br><span class="line"><span class="keyword">const</span> [, , , , [, , n]] = numbers;</span><br><span class="line"><span class="built_in">console</span>.log(n);</span><br></pre></td></tr></table></figure>

<p>得到 numbers 下标为 4 的数组的属性 a，赋值给变量 A</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> numbers = [</span><br><span class="line">  <span class="string">&quot;a&quot;</span>,</span><br><span class="line">  <span class="string">&quot;b&quot;</span>,</span><br><span class="line">  <span class="string">&quot;c&quot;</span>,</span><br><span class="line">  <span class="string">&quot;d&quot;</span>,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">a</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="attr">b</span>: <span class="number">2</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">];</span><br><span class="line"><span class="comment">// const [,,,,&#123;a&#125;] = numbers;</span></span><br><span class="line"><span class="comment">// const [, , , , &#123; a: A &#125;] = numbers;</span></span><br><span class="line"><span class="keyword">const</span> &#123; <span class="attr">a</span>: A &#125; = numbers[<span class="number">4</span>]; <span class="comment">//把对象单独拿出来</span></span><br><span class="line"><span class="built_in">console</span>.log(A);</span><br></pre></td></tr></table></figure>

<p>解构出 name，然后，剩余的所有属性，放到一个新的对象中，变量名为 obj</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> user = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;kevin&quot;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="number">11</span>,</span><br><span class="line">  <span class="attr">sex</span>: <span class="string">&quot;男&quot;</span>,</span><br><span class="line">  <span class="attr">address</span>: &#123;</span><br><span class="line">    <span class="attr">province</span>: <span class="string">&quot;四川&quot;</span>,</span><br><span class="line">    <span class="attr">city</span>: <span class="string">&quot;成都&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// name: kevin</span></span><br><span class="line"><span class="comment">// obj : &#123;age:11, sex:&quot;男&quot;, address:&#123;...&#125;&#125;</span></span><br><span class="line"><span class="keyword">const</span> &#123; name, ...obj &#125; = user;</span><br><span class="line"><span class="built_in">console</span>.log(name, obj);</span><br></pre></td></tr></table></figure>

<p>得到数组前两项，分别放到变量 a 和 b 中，然后剩余的所有数据放到数组 nums</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> numbers = [<span class="number">324</span>, <span class="number">7</span>, <span class="number">23</span>, <span class="number">5</span>, <span class="number">3243</span>];</span><br><span class="line"><span class="keyword">const</span> [a, b, ...nums] = numbers;</span><br><span class="line"><span class="comment">// 以前：const a = numbers[0], b = numbers[1], nums = numbers.slice(2);</span></span><br><span class="line"><span class="built_in">console</span>.log(a, b, nums);</span><br></pre></td></tr></table></figure>

<p>交换两个变量</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = <span class="number">1</span>,</span><br><span class="line">  b = <span class="number">2</span>;</span><br><span class="line">[b, a] = [a, b]; <span class="comment">//右边数组，赋值，[1,2]; 左边解构</span></span><br><span class="line"><span class="built_in">console</span>.log(a, b);</span><br></pre></td></tr></table></figure>

<p>试题</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> article = &#123;</span><br><span class="line">  <span class="attr">title</span>: <span class="string">&quot;文章标题&quot;</span>,</span><br><span class="line">  <span class="attr">content</span>: <span class="string">&quot;文章内容&quot;</span>,</span><br><span class="line">  <span class="attr">comments</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">content</span>: <span class="string">&quot;评论1&quot;</span>,</span><br><span class="line">      <span class="attr">user</span>: &#123;</span><br><span class="line">        <span class="attr">id</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&quot;用户名1&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">content</span>: <span class="string">&quot;评论2&quot;</span>,</span><br><span class="line">      <span class="attr">user</span>: &#123;</span><br><span class="line">        <span class="attr">id</span>: <span class="number">2</span>,</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&quot;用户名2&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  ],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>解构出第二条评论的用户名和评论内容</p>
<p>name:”用户名 2” content:”评论 2”</p>
<p>写法 1</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123;</span><br><span class="line">  <span class="attr">comments</span>: [</span><br><span class="line">    ,</span><br><span class="line">    &#123;</span><br><span class="line">      content,</span><br><span class="line">      <span class="attr">user</span>: &#123; name &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  ],</span><br><span class="line">&#125; = article;</span><br><span class="line"><span class="built_in">console</span>.log(content, name);</span><br></pre></td></tr></table></figure>

<p>写法 2</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> [</span><br><span class="line">  ,</span><br><span class="line">  &#123;</span><br><span class="line">    content,</span><br><span class="line">    <span class="attr">user</span>: &#123; name &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">] = article.comments; <span class="comment">//先把数组项取出来</span></span><br><span class="line"><span class="built_in">console</span>.log(content, name);</span><br></pre></td></tr></table></figure>

<p>写法 3</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123;</span><br><span class="line">  content,</span><br><span class="line">  <span class="attr">user</span>: &#123; name &#125;,</span><br><span class="line">&#125; = article.comments[<span class="number">1</span>];</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(content, name);</span><br></pre></td></tr></table></figure>

<h2 id="6-3-参数解构"><a href="#6-3-参数解构" class="headerlink" title="6-3 参数解构"></a>6-3 参数解构</h2><p>目前的问题：要写无数的 user . 太麻烦</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">print</span>(<span class="params">user</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`姓名：<span class="subst">$&#123;user.name&#125;</span>`</span>);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`年龄：<span class="subst">$&#123;user.age&#125;</span>`</span>);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`性别：<span class="subst">$&#123;user.sex&#125;</span>`</span>);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`身份：<span class="subst">$&#123;user.address.province&#125;</span>`</span>);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`城市：<span class="subst">$&#123;user.address.city&#125;</span>`</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> user = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;kevin&quot;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="number">11</span>,</span><br><span class="line">  <span class="attr">sex</span>: <span class="string">&quot;男&quot;</span>,</span><br><span class="line">  <span class="attr">address</span>: &#123;</span><br><span class="line">    <span class="attr">province</span>: <span class="string">&quot;四川&quot;</span>,</span><br><span class="line">    <span class="attr">city</span>: <span class="string">&quot;成都&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line">print(user);</span><br></pre></td></tr></table></figure>

<p>直接解构</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">print</span>(<span class="params">&#123; name, age, sex, address: &#123; province, city &#125; &#125;</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`姓名：<span class="subst">$&#123;name&#125;</span>`</span>);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`年龄：<span class="subst">$&#123;age&#125;</span>`</span>);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`性别：<span class="subst">$&#123;sex&#125;</span>`</span>);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`身份：<span class="subst">$&#123;province&#125;</span>`</span>);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`城市：<span class="subst">$&#123;city&#125;</span>`</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> user = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;kevin&quot;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="number">11</span>,</span><br><span class="line">  <span class="attr">sex</span>: <span class="string">&quot;男&quot;</span>,</span><br><span class="line">  <span class="attr">address</span>: &#123;</span><br><span class="line">    <span class="attr">province</span>: <span class="string">&quot;四川&quot;</span>,</span><br><span class="line">    <span class="attr">city</span>: <span class="string">&quot;成都&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line">print(user);</span><br></pre></td></tr></table></figure>

<p>ajax 默认值配置</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ajax</span>(<span class="params">options</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> defaultOptions = &#123;</span><br><span class="line">    <span class="comment">//默认配置</span></span><br><span class="line">    <span class="attr">method</span>: <span class="string">&quot;get&quot;</span>, <span class="comment">//默认值</span></span><br><span class="line">    <span class="attr">url</span>: <span class="string">&quot;/&quot;</span>,</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">const</span> opt = &#123;</span><br><span class="line">    ...defaultOptions,</span><br><span class="line">    ...options,</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="built_in">console</span>.log(opt);</span><br><span class="line">&#125;</span><br><span class="line">ajax(&#123;</span><br><span class="line">  <span class="attr">url</span>: <span class="string">&quot;/abc&quot;</span>,</span><br><span class="line">  <span class="attr">method</span>: <span class="string">&quot;post&quot;</span>, <span class="comment">//不传的话默认get</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>解构简化</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ajax</span>(<span class="params">&#123; method = <span class="string">&quot;get&quot;</span>, url = <span class="string">&quot;/&quot;</span> &#125; = &#123;&#125;</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 需要加上=&#123;&#125;，参数默认值</span></span><br><span class="line">  <span class="built_in">console</span>.log(method, url);</span><br><span class="line">&#125;</span><br><span class="line">ajax(); <span class="comment">//不传递则undefined无法解构，so需要加上=&#123;&#125;，参数默认值</span></span><br><span class="line">ajax(&#123;</span><br><span class="line">  <span class="attr">url</span>: <span class="string">&quot;/abc&quot;</span>,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h1 id="7-符号"><a href="#7-符号" class="headerlink" title="7.符号"></a>7.符号</h1><h2 id="7-1-普通符号"><a href="#7-1-普通符号" class="headerlink" title="7-1 普通符号"></a>7-1 普通符号</h2><p>符号是 ES6 新增的一个数据类型，它通过使用函数 <code>Symbol(符号描述)</code> 来创建</p>
<blockquote>
<p>全新的数据类型</p>
</blockquote>
<p>创建一个符号</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> syb1 = <span class="built_in">Symbol</span>();</span><br><span class="line"><span class="keyword">const</span> syb2 = <span class="built_in">Symbol</span>(<span class="string">&quot;abc&quot;</span>); <span class="comment">//描述信息</span></span><br><span class="line"><span class="built_in">console</span>.log(syb1, syb2);</span><br></pre></td></tr></table></figure>

<p>英雄攻击实例：里面的随机数没必要展示在外面：大道至简</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> hero = &#123;</span><br><span class="line">  <span class="attr">attack</span>: <span class="number">30</span>,</span><br><span class="line">  <span class="attr">hp</span>: <span class="number">300</span>,</span><br><span class="line">  <span class="attr">defence</span>: <span class="number">10</span>,</span><br><span class="line">  <span class="function"><span class="title">gongji</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="comment">//攻击</span></span><br><span class="line">    <span class="comment">//伤害：攻击力*随机数（0.8~1.1)</span></span><br><span class="line">    <span class="keyword">const</span> dmg = <span class="built_in">this</span>.attack * <span class="built_in">this</span>.getRandom(<span class="number">0.8</span>, <span class="number">1.1</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(dmg);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function"><span class="title">getRandom</span>(<span class="params">min, max</span>)</span> &#123;</span><br><span class="line">    <span class="comment">//根据最小值和最大值产生一个随机数,这个方法没必要展示</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Math</span>.random() * (max - min) + min;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>优化</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Hero</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">attack, hp, defence</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.attack = attack;</span><br><span class="line">    <span class="built_in">this</span>.hp = hp;</span><br><span class="line">    <span class="built_in">this</span>.defence = defence;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">gongji</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="comment">//伤害：攻击力*随机数（0.8~1.1)</span></span><br><span class="line">    <span class="keyword">const</span> dmg = <span class="built_in">this</span>.attack * <span class="built_in">this</span>.getRandom(<span class="number">0.8</span>, <span class="number">1.1</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(dmg);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">getRandom</span>(<span class="params">min, max</span>)</span> &#123;</span><br><span class="line">    <span class="comment">//根据最小值和最大值产生一个随机数</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Math</span>.random() * (max - min) + min;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>符号设计的初衷，是为了给对象设置<strong>私有</strong>属性<br>私有属性：只能在对象内部使用，外面无法使用<br>符号具有以下特点：</p>
<ul>
<li>没有字面量:（字面量是直接书写出来）</li>
<li>使用 typeof 得到的类型是 symbol</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//创建一个符号</span></span><br><span class="line"><span class="keyword">const</span> syb1 = <span class="built_in">Symbol</span>();</span><br><span class="line"><span class="keyword">const</span> syb2 = <span class="built_in">Symbol</span>(<span class="string">&quot;abc&quot;</span>);</span><br><span class="line"><span class="built_in">console</span>.log(syb1, syb2);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">typeof</span> syb1 === <span class="string">&quot;symbol&quot;</span>, <span class="keyword">typeof</span> syb2 === <span class="string">&quot;symbol&quot;</span>);</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>每次调用 Symbol 函数得到的符号永远不相等，无论符号名是否相同</strong></li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//创建一个符号</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> syb1 = <span class="built_in">Symbol</span>(<span class="string">&quot;这是随便写的一个符号&quot;</span>); <span class="comment">//描述信息</span></span><br><span class="line"><span class="keyword">const</span> syb2 = <span class="built_in">Symbol</span>(<span class="string">&quot;这是随便写的一个符号&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(syb1, syb2);</span><br><span class="line"><span class="built_in">console</span>.log(syb1 === syb2); <span class="comment">//false</span></span><br></pre></td></tr></table></figure>

<ul>
<li>在符号之前，所有的属性名一定是字符串。符号可以作为对象的属性名存在，这种属性称之为符号属性</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> syb1 = <span class="built_in">Symbol</span>(<span class="string">&quot;这是用于对象的一个属性&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">  <span class="attr">a</span>: <span class="number">1</span>,</span><br><span class="line">  <span class="attr">b</span>: <span class="number">2</span>,</span><br><span class="line">  [syb1]: <span class="number">3</span>, <span class="comment">//符号属性</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(obj);</span><br></pre></td></tr></table></figure>

<ol>
<li>开发者可以通过精心的设计，让这些属性无法通过常规方式被外界访问</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> hero = (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> getRandom = <span class="built_in">Symbol</span>();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">attack</span>: <span class="number">30</span>,</span><br><span class="line">    <span class="attr">hp</span>: <span class="number">300</span>,</span><br><span class="line">    <span class="attr">defence</span>: <span class="number">10</span>,</span><br><span class="line">    <span class="function"><span class="title">gongji</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">      <span class="comment">//攻击</span></span><br><span class="line">      <span class="comment">//伤害：攻击力*随机数（0.8~1.1)</span></span><br><span class="line">      <span class="keyword">const</span> dmg = <span class="built_in">this</span>.attack * <span class="built_in">this</span>[getRandom](<span class="number">0.8</span>, <span class="number">1.1</span>);</span><br><span class="line">      <span class="built_in">console</span>.log(dmg);</span><br><span class="line">    &#125;,</span><br><span class="line">    [getRandom](min, max) &#123;</span><br><span class="line">      <span class="comment">//根据最小值和最大值产生一个随机数</span></span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">Math</span>.random() * (max - min) + min;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;)();</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(hero);</span><br></pre></td></tr></table></figure>

<p>类的写法</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Hero = (<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> getRandom = <span class="built_in">Symbol</span>();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="class"><span class="keyword">class</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="title">constructor</span>(<span class="params">attack, hp, defence</span>)</span> &#123;</span><br><span class="line">      <span class="built_in">this</span>.attack = attack;</span><br><span class="line">      <span class="built_in">this</span>.hp = hp;</span><br><span class="line">      <span class="built_in">this</span>.defence = defence;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="title">gongji</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">      <span class="comment">//伤害：攻击力*随机数（0.8~1.1)</span></span><br><span class="line">      <span class="keyword">const</span> dmg = <span class="built_in">this</span>.attack * <span class="built_in">this</span>[getRandom](<span class="number">0.8</span>, <span class="number">1.1</span>);</span><br><span class="line">      <span class="built_in">console</span>.log(dmg);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    [getRandom](min, max) &#123;</span><br><span class="line">      <span class="comment">//根据最小值和最大值产生一个随机数</span></span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">Math</span>.random() * (max - min) + min;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;)();</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> h = <span class="keyword">new</span> Hero(<span class="number">3</span>, <span class="number">6</span>, <span class="number">3</span>);</span><br><span class="line"><span class="built_in">console</span>.log(h);</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>符号属性是不能枚举的，因此在 for-in 循环中无法读取到符号属性，Object.keys 方法也无法读取到符号属性</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> syb = <span class="built_in">Symbol</span>();</span><br><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">  [syb]: <span class="number">1</span>,</span><br><span class="line">  <span class="attr">a</span>: <span class="number">2</span>,</span><br><span class="line">  <span class="attr">b</span>: <span class="number">3</span>,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> prop <span class="keyword">in</span> obj) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(prop); <span class="comment">//只能输出a,b</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Object</span>.keys(obj));</span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Object</span>.getOwnPropertyNames(obj));</span><br><span class="line"><span class="comment">//得到的是一个符号属性的数组</span></span><br><span class="line"><span class="keyword">const</span> sybs = <span class="built_in">Object</span>.getOwnPropertySymbols(obj);</span><br><span class="line"><span class="built_in">console</span>.log(sybs, sybs[<span class="number">0</span>] === syb);</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>Object.getOwnPropertyNames 尽管可以得到所有无法枚举的属性，但是仍然无法读取到符号属性</li>
<li>ES6 新增 Object.getOwnPropertySymbols 方法，可以读取符号</li>
</ol>
<p>非常规方式读取符号</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Hero = (<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> getRandom = <span class="built_in">Symbol</span>();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="class"><span class="keyword">class</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="title">constructor</span>(<span class="params">attack, hp, defence</span>)</span> &#123;</span><br><span class="line">      <span class="built_in">this</span>.attack = attack;</span><br><span class="line">      <span class="built_in">this</span>.hp = hp;</span><br><span class="line">      <span class="built_in">this</span>.defence = defence;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="title">gongji</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">      <span class="comment">//伤害：攻击力*随机数（0.8~1.1)</span></span><br><span class="line">      <span class="keyword">const</span> dmg = <span class="built_in">this</span>.attack * <span class="built_in">this</span>[getRandom](<span class="number">0.8</span>, <span class="number">1.1</span>);</span><br><span class="line">      <span class="built_in">console</span>.log(dmg);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    [getRandom](min, max) &#123;</span><br><span class="line">      <span class="comment">//根据最小值和最大值产生一个随机数</span></span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">Math</span>.random() * (max - min) + min;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;)();</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> h = <span class="keyword">new</span> Hero(<span class="number">3</span>, <span class="number">6</span>, <span class="number">3</span>);</span><br><span class="line"><span class="keyword">const</span> sybs = <span class="built_in">Object</span>.getOwnPropertySymbols(Hero.prototype);</span><br><span class="line"><span class="keyword">const</span> prop = sybs[<span class="number">0</span>];</span><br><span class="line"><span class="built_in">console</span>.log(h[prop](<span class="number">3</span>, <span class="number">5</span>));</span><br></pre></td></tr></table></figure>

<ul>
<li>符号无法被隐式转换，因此不能被用于数学运算、字符串拼接或其他隐式转换的场景，但符号可以显式的转换为字符串，通过 String 构造函数进行转换即可，console.log 之所以可以输出符号，是它在内部进行了显式转换</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> syb = <span class="built_in">Symbol</span>();</span><br><span class="line"><span class="built_in">console</span>.log(syb * <span class="number">2</span>);</span><br><span class="line"><span class="built_in">console</span>.log(syb + <span class="string">&quot;2&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>显示转换</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> syb = <span class="built_in">Symbol</span>();</span><br><span class="line"><span class="keyword">const</span> str = <span class="built_in">String</span>(syb);</span><br><span class="line"><span class="built_in">console</span>.log(str);</span><br></pre></td></tr></table></figure>

<h2 id="7-2-共享符号"><a href="#7-2-共享符号" class="headerlink" title="7-2 共享符号"></a>7-2 共享符号</h2><p>根据某个符号名称（符号描述）能够得到同一个符号</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Symbol</span>.for(<span class="string">&quot;符号名/符号描述&quot;</span>); <span class="comment">//获取共享符号</span></span><br></pre></td></tr></table></figure>

<p>应用</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> syb1 = <span class="built_in">Symbol</span>.for(<span class="string">&quot;abc&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> syb2 = <span class="built_in">Symbol</span>.for(<span class="string">&quot;abc&quot;</span>);</span><br><span class="line">都不填符号或都填一样的都是<span class="literal">true</span>;</span><br><span class="line"><span class="built_in">console</span>.log(syb1 === syb2);</span><br><span class="line"><span class="keyword">const</span> obj1 = &#123;</span><br><span class="line">  <span class="attr">a</span>: <span class="number">1</span>,</span><br><span class="line">  <span class="attr">b</span>: <span class="number">2</span>,</span><br><span class="line">  [syb1]: <span class="number">3</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> obj2 = &#123;</span><br><span class="line">  <span class="attr">a</span>: <span class="string">&quot;a&quot;</span>,</span><br><span class="line">  <span class="attr">b</span>: <span class="string">&quot;b&quot;</span>,</span><br><span class="line">  [syb2]: <span class="string">&quot;c&quot;</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(obj1, obj2);</span><br></pre></td></tr></table></figure>

<p>应用</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">  <span class="attr">a</span>: <span class="number">1</span>,</span><br><span class="line">  <span class="attr">b</span>: <span class="number">2</span>,</span><br><span class="line">  [<span class="built_in">Symbol</span>.for(<span class="string">&quot;c&quot;</span>)]: <span class="number">3</span>,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">console</span>.log(obj[<span class="built_in">Symbol</span>.for(<span class="string">&quot;c&quot;</span>)]);</span><br></pre></td></tr></table></figure>

<p>实现共享符号底层原理</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> SymbolFor = (<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> <span class="built_in">global</span> = &#123;&#125;; <span class="comment">//用于记录有哪些共享符号</span></span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">name</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="built_in">global</span>);</span><br><span class="line">    <span class="keyword">if</span> (!<span class="built_in">global</span>[name]) &#123;</span><br><span class="line">      <span class="built_in">global</span>[name] = <span class="built_in">Symbol</span>(name);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="built_in">global</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">global</span>[name];</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;)();</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> syb1 = SymbolFor(<span class="string">&quot;abc&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> syb2 = SymbolFor(<span class="string">&quot;abc&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(syb1 === syb2);</span><br></pre></td></tr></table></figure>

<h2 id="7-3-知名（公共、具名）符号"><a href="#7-3-知名（公共、具名）符号" class="headerlink" title="7-3 知名（公共、具名）符号"></a>7-3 知名<strong>（公共、具名）</strong>符号</h2><p>知名符号是一些具有特殊含义的共享符号，通过 Symbol 的静态属性得到</p>
<p>ES6 延续了 ES5 的思想：减少魔法，暴露内部实现！</p>
<p>因此，ES6 用知名符号暴露了某些场景的内部实现</p>
<ol>
<li>Symbol.hasInstance</li>
</ol>
<p>该符号用于定义构造函数的静态成员，它将影响 instanceof 的判定</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">obj <span class="keyword">instanceof</span> A;</span><br><span class="line"><span class="comment">//等效于</span></span><br><span class="line">A[<span class="built_in">Symbol</span>.hasInstance](obj); <span class="comment">// Function.prototype[Symbol.hasInstance]</span></span><br></pre></td></tr></table></figure>

<p>演示参与改动</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">A</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line"><span class="built_in">Object</span>.defineProperty(A, <span class="built_in">Symbol</span>.hasInstance, &#123;</span><br><span class="line">  <span class="comment">//更改A的Symbol.hasInstance属性</span></span><br><span class="line">  <span class="attr">value</span>: <span class="function"><span class="keyword">function</span> (<span class="params">obj</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">const</span> obj = <span class="keyword">new</span> A();</span><br><span class="line"><span class="built_in">console</span>.log(obj <span class="keyword">instanceof</span> A);</span><br><span class="line"><span class="comment">//内部实现 console.log(A[Symbol.hasInstance](obj));</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>[扩展] Symbol.isConcatSpreadable</li>
</ol>
<p>该知名符号会影响数组的 concat 方法</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> arr = [<span class="number">3</span>];</span><br><span class="line"><span class="keyword">const</span> result = arr.concat(<span class="number">56</span>, arr2);</span><br><span class="line"><span class="comment">/*两种可能*/</span></span><br><span class="line"><span class="comment">//  [3, 56, [5,6,7,8]]</span></span><br><span class="line"><span class="comment">//  [3, 56, 5, 6, 7, 8]结果是分割处理</span></span><br><span class="line"><span class="built_in">console</span>.log(result);</span><br></pre></td></tr></table></figure>

<p>要想不分割</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> arr = [<span class="number">3</span>];</span><br><span class="line"><span class="keyword">const</span> arr2 = [<span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>];</span><br><span class="line">arr2[<span class="built_in">Symbol</span>.isConcatSpreadable] = <span class="literal">false</span>;</span><br><span class="line"><span class="keyword">const</span> result = arr.concat(<span class="number">56</span>, arr2);</span><br><span class="line"><span class="built_in">console</span>.log(result);</span><br></pre></td></tr></table></figure>

<p>以此，也可以应用到对象</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> arr = [<span class="number">1</span>];</span><br><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">  <span class="number">0</span>: <span class="number">3</span>,</span><br><span class="line">  <span class="number">1</span>: <span class="number">4</span>,</span><br><span class="line">  <span class="attr">length</span>: <span class="number">2</span>,</span><br><span class="line">  [<span class="built_in">Symbol</span>.isConcatSpreadable]: <span class="literal">true</span>,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> result = arr.concat(<span class="number">2</span>, obj);</span><br><span class="line"><span class="built_in">console</span>.log(result);</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>[扩展] Symbol.toPrimitive</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">  <span class="attr">a</span>: <span class="number">1</span>,</span><br><span class="line">  <span class="attr">b</span>: <span class="number">2</span>,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// 先调用valueOf后toString</span></span><br><span class="line"><span class="built_in">console</span>.log(obj.valueOf()); <span class="comment">//拿不到基本类型</span></span><br><span class="line"><span class="built_in">console</span>.log(obj.toString()); <span class="comment">//可以拿到基本类型</span></span><br><span class="line"><span class="built_in">console</span>.log(obj + <span class="number">1</span>);</span><br></pre></td></tr></table></figure>

<p>更改内部实现</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">  <span class="attr">a</span>: <span class="number">1</span>,</span><br><span class="line">  <span class="attr">b</span>: <span class="number">2</span>,</span><br><span class="line">&#125;;</span><br><span class="line">obj[<span class="built_in">Symbol</span>.toPrimitive] = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">console</span>.log(obj + <span class="number">1</span>);</span><br></pre></td></tr></table></figure>

<p>该知名符号会影响类型转换的结果</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Temperature</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">degree</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.degree = degree;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  [<span class="built_in">Symbol</span>.toPrimitive](type) &#123;</span><br><span class="line">    <span class="keyword">if</span> (type === <span class="string">&quot;default&quot;</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">this</span>.degree + <span class="string">&quot;摄氏度&quot;</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (type === <span class="string">&quot;number&quot;</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">this</span>.degree;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (type === <span class="string">&quot;string&quot;</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">this</span>.degree + <span class="string">&quot;℃&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> t = <span class="keyword">new</span> Temperature(<span class="number">30</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(t + <span class="string">&quot;!&quot;</span>);</span><br><span class="line"><span class="built_in">console</span>.log(t / <span class="number">2</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">String</span>(t));</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>[扩展] Symbol.toStringTag</li>
</ol>
<p>该知名符号会影响 Object.prototype.toString 的返回值</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">  [<span class="built_in">Symbol</span>.toStringTag] = <span class="string">&quot;Person&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> p = <span class="keyword">new</span> Person();</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> arr = [<span class="number">32424</span>, <span class="number">45654</span>, <span class="number">32</span>];</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Object</span>.prototype.toString.apply(p));</span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Object</span>.prototype.toString.apply(arr));</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>其他知名符号</li>
</ol>
<h1 id="8-异步处理"><a href="#8-异步处理" class="headerlink" title="8.异步处理"></a>8.异步处理</h1><h2 id="8-0【回顾】事件循环-eventLoop"><a href="#8-0【回顾】事件循环-eventLoop" class="headerlink" title="8.0【回顾】事件循环 eventLoop"></a>8.0【回顾】事件循环 eventLoop</h2><p>案例 1</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;a&quot;</span>);</span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;b&quot;</span>);</span><br><span class="line">&#125;, <span class="number">0</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;c&quot;</span>);</span><br><span class="line"><span class="comment">//a   c    b</span></span><br><span class="line"><span class="comment">//53min有讲解</span></span><br></pre></td></tr></table></figure>

<p>案例 2</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;a&quot;</span>);</span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;b&quot;</span>);</span><br><span class="line">&#125;, <span class="number">0</span>);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">1000</span>; i++) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;c&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// a</span></span><br><span class="line"><span class="comment">// 1000个c</span></span><br><span class="line"><span class="comment">// b</span></span><br></pre></td></tr></table></figure>

<p><strong>事件循环</strong><br>JS 运行的环境称之为宿主环境。<br>JS 语言不只运行在浏览器<br>执行栈：call stack，一个数据结构，用于存放各种函数的执行环境，每一个函数执行之前，它的相关信息会加入到执行栈。函数调用之前，创建执行环境，然后加入到执行栈；函数调用之后，销毁执行环境。<br>JS 引擎永远执行的是执行栈的最顶部。<br>演示 1</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">  <span class="function"><span class="keyword">function</span> <span class="title">a</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">    <span class="built_in">console</span>.log(<span class="string">&quot;a&quot;</span>);</span></span><br><span class="line"><span class="javascript">    b();</span></span><br><span class="line"><span class="javascript">  &#125;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">  <span class="function"><span class="keyword">function</span> <span class="title">b</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">    <span class="built_in">console</span>.log(<span class="string">&quot;b&quot;</span>);</span></span><br><span class="line"><span class="javascript">    c();</span></span><br><span class="line"><span class="javascript">  &#125;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">  <span class="function"><span class="keyword">function</span> <span class="title">c</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">    <span class="built_in">console</span>.log(<span class="string">&quot;c&quot;</span>);</span></span><br><span class="line"><span class="javascript">  &#125;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">  <span class="built_in">console</span>.log(<span class="string">&quot;global&quot;</span>);</span></span><br><span class="line"><span class="javascript">  a();</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>异步函数：某些函数不会立即执行，需要等到某个时机到达后才会执行，这样的函数称之为异步函数。比如事件处理函数。异步函数的执行时机，会被宿主环境控制。<br>浏览器宿主环境中包含 5 个线程：</p>
<ol>
<li>JS 引擎：负责执行执行栈的最顶部代码</li>
<li>GUI 线程：负责渲染页面</li>
<li>事件监听线程：负责监听各种事件</li>
<li>计时线程：负责计时</li>
<li>网络线程：负责网络通信<br>当上面的线程发生了某些事请，如果该线程发现，这件事情有处理程序，它会将该处理程序加入一个叫做事件队列的内存。当 JS 引擎发现，执行栈中已经没有了任何内容后，会将事件队列中的第一个函数加入到执行栈中执行。<br>JS 引擎对事件队列的取出执行方式，以及与宿主环境的配合，称之为事件循环。</li>
</ol>
<p>举例：异步处理演示 3</p>
<p>事件队列在不同的宿主环境中有所差异，大部分宿主环境会将事件队列进行细分。在浏览器中，事件队列分为两种：</p>
<ul>
<li>宏任务（队列）：macroTask，计时器结束的回调、事件回调、http 回调等等绝大部分异步函数进入宏队列</li>
<li>微任务（队列）：MutationObserver，Promise 产生的回调进入微队列——vip</li>
</ul>
<blockquote>
<p>MutationObserver 用于监听某个 DOM 对象的变化<br>当执行栈清空时，JS 引擎首先会将微任务中的所有任务依次执行结束，如果没有微任务，则执行宏任务。</p>
</blockquote>
<p>演示 2</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">  <span class="comment">// 1  1  2  3  5  8  13</span></span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">  <span class="comment">//求斐波拉契数列第n位的值</span></span></span><br><span class="line"><span class="javascript">  <span class="function"><span class="keyword">function</span> <span class="title">getFeibo</span>(<span class="params">n</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">if</span> (n === <span class="number">1</span> || n === <span class="number">2</span>) &#123;</span></span><br><span class="line"><span class="javascript">      <span class="comment">//避免无限递归</span></span></span><br><span class="line"><span class="javascript">      <span class="keyword">return</span> <span class="number">1</span>;</span></span><br><span class="line"><span class="javascript">    &#125;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">return</span> getFeibo(n - <span class="number">1</span>) + getFeibo(n - <span class="number">2</span>);</span></span><br><span class="line"><span class="javascript">  &#125;</span></span><br><span class="line"><span class="javascript">  <span class="built_in">console</span>.log(getFeibo(<span class="number">4</span>));</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>异步处理演示 3</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">&quot;btn&quot;</span>&gt;</span>点击<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">  <span class="built_in">document</span>.getElementById(<span class="string">&quot;btn&quot;</span>).onclick = <span class="function"><span class="keyword">function</span> <span class="title">A</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">    <span class="built_in">console</span>.log(<span class="string">&quot;按钮被点击了&quot;</span>);</span></span><br><span class="line"><span class="javascript">  &#125;;</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>为什么先执行宏队列了：点击按钮的额时候还没有往 ul 里面加 li，所以微队列也不执行</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">  <span class="keyword">let</span> count = <span class="number">1</span>;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">const</span> ul = <span class="built_in">document</span>.getElementById(<span class="string">&quot;container&quot;</span>);</span></span><br><span class="line"><span class="javascript">  <span class="built_in">document</span>.getElementById(<span class="string">&quot;btn&quot;</span>).onclick = <span class="function"><span class="keyword">function</span> <span class="title">A</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> li = <span class="built_in">document</span>.createElement(<span class="string">&quot;li&quot;</span>);</span></span><br><span class="line"><span class="javascript">    li.innerText = count++;</span></span><br><span class="line"><span class="javascript">    ul.appendChild(li);</span></span><br><span class="line"><span class="javascript">    <span class="built_in">console</span>.log(<span class="string">&quot;添加了一个li&quot;</span>);</span></span><br><span class="line"><span class="javascript">  &#125;;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">  <span class="comment">//监听ul</span></span></span><br><span class="line"><span class="javascript">  <span class="keyword">const</span> observer = <span class="keyword">new</span> MutationObserver(<span class="function"><span class="keyword">function</span> <span class="title">B</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">    <span class="comment">//当监听的dom元素发生变化时运行的回调函数</span></span></span><br><span class="line"><span class="javascript">    <span class="built_in">console</span>.log(<span class="string">&quot;ul元素发生了变化&quot;</span>);</span></span><br><span class="line"><span class="javascript">  &#125;);</span></span><br><span class="line"><span class="javascript">  <span class="comment">//监听ul</span></span></span><br><span class="line"><span class="javascript">  observer.observe(ul, &#123;</span></span><br><span class="line"><span class="javascript">    <span class="attr">attributes</span>: <span class="literal">true</span>, <span class="comment">//监听属性的变化</span></span></span><br><span class="line"><span class="javascript">    <span class="attr">childList</span>: <span class="literal">true</span>, <span class="comment">//监听子元素的变化</span></span></span><br><span class="line"><span class="javascript">    <span class="attr">subtree</span>: <span class="literal">true</span>, <span class="comment">//监听子树的变化</span></span></span><br><span class="line"><span class="javascript">  &#125;);</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>宏队列演示</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ul</span> <span class="attr">id</span>=<span class="string">&quot;container&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">&quot;btn&quot;</span>&gt;</span>点击<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">  <span class="keyword">let</span> count = <span class="number">1</span>;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">const</span> ul = <span class="built_in">document</span>.getElementById(<span class="string">&quot;container&quot;</span>);</span></span><br><span class="line"><span class="javascript">  <span class="built_in">document</span>.getElementById(<span class="string">&quot;btn&quot;</span>).onclick = <span class="function"><span class="keyword">function</span> <span class="title">A</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">    <span class="built_in">setTimeout</span>(<span class="function"><span class="keyword">function</span> <span class="title">C</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(<span class="string">&quot;添加了一个li&quot;</span>);</span></span><br><span class="line"><span class="javascript">    &#125;, <span class="number">0</span>);</span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> li = <span class="built_in">document</span>.createElement(<span class="string">&quot;li&quot;</span>);</span></span><br><span class="line"><span class="javascript">    li.innerText = count++;</span></span><br><span class="line"><span class="javascript">    ul.appendChild(li);</span></span><br><span class="line"><span class="javascript">  &#125;;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">  <span class="comment">//监听ul</span></span></span><br><span class="line"><span class="javascript">  <span class="keyword">const</span> observer = <span class="keyword">new</span> MutationObserver(<span class="function"><span class="keyword">function</span> <span class="title">B</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">    <span class="comment">//当监听的dom元素发生变化时运行的回调函数</span></span></span><br><span class="line"><span class="javascript">    <span class="built_in">console</span>.log(<span class="string">&quot;ul元素发生了变化&quot;</span>);</span></span><br><span class="line"><span class="javascript">  &#125;);</span></span><br><span class="line"><span class="javascript">  <span class="comment">//监听ul</span></span></span><br><span class="line"><span class="javascript">  observer.observe(ul, &#123;</span></span><br><span class="line"><span class="javascript">    <span class="attr">attributes</span>: <span class="literal">true</span>, <span class="comment">//监听属性的变化</span></span></span><br><span class="line"><span class="javascript">    <span class="attr">childList</span>: <span class="literal">true</span>, <span class="comment">//监听子元素的变化</span></span></span><br><span class="line"><span class="javascript">    <span class="attr">subtree</span>: <span class="literal">true</span>, <span class="comment">//监听子树的变化</span></span></span><br><span class="line"><span class="javascript">  &#125;);</span></span><br><span class="line"><span class="javascript">  <span class="comment">//取消监听</span></span></span><br><span class="line"><span class="javascript">  <span class="comment">// observer.disconnect();</span></span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="8-1-事件和回调函数缺陷"><a href="#8-1-事件和回调函数缺陷" class="headerlink" title="8.1 事件和回调函数缺陷"></a>8.1 事件和回调函数缺陷</h2><p>我们习惯于使用传统的回调或事件处理来解决异步问题<br>事件：某个对象的属性是一个函数，当发生某一件事时，运行该函数</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dom.onclick = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125;;</span><br></pre></td></tr></table></figure>

<p>回调：运行某个函数以实现某个功能的时候，传入一个函数作为参数，当发生某件事的时候，会运行该函数。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dom.addEventListener(<span class="string">&quot;click&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125;);</span><br></pre></td></tr></table></figure>

<p>本质上，事件和回调并没有本质的区别，只是把函数放置的位置不同而已。<br>一直以来，该模式都运作良好。<br>直到前端工程越来越复杂…<br>目前，该模式主要面临以下两个问题：</p>
<ol>
<li>回调地狱：某个异步操作需要等待之前的异步操作完成，无论用回调还是事件，都会陷入不断的嵌套</li>
<li>异步之间的联系：某个异步操作要等待多个异步操作的结果，对这种联系的处理，会让代码的复杂度剧增</li>
</ol>
<p>演示 demo</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">&quot;btn1&quot;</span>&gt;</span>按钮1：给按钮2注册点击事件<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">&quot;btn2&quot;</span>&gt;</span>按钮2：给按钮3注册点击事件<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">&quot;btn3&quot;</span>&gt;</span>按钮3：点击后弹出hello<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">  <span class="keyword">const</span> btn1 = <span class="built_in">document</span>.getElementById(<span class="string">&quot;btn1&quot;</span>),</span></span><br><span class="line"><span class="javascript">    btn2 = <span class="built_in">document</span>.getElementById(<span class="string">&quot;btn2&quot;</span>),</span></span><br><span class="line"><span class="javascript">    btn3 = <span class="built_in">document</span>.getElementById(<span class="string">&quot;btn3&quot;</span>);</span></span><br><span class="line"><span class="javascript">  btn1.addEventListener(<span class="string">&quot;click&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">    <span class="comment">//按钮1的其他事情</span></span></span><br><span class="line"><span class="javascript">    btn2.addEventListener(<span class="string">&quot;click&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">      <span class="comment">//按钮2的其他事情</span></span></span><br><span class="line"><span class="javascript">      btn3.addEventListener(<span class="string">&quot;click&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        alert(<span class="string">&quot;hello&quot;</span>);</span></span><br><span class="line"><span class="javascript">      &#125;);</span></span><br><span class="line"><span class="javascript">    &#125;);</span></span><br><span class="line"><span class="javascript">  &#125;);</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="8-2-异步处理的通用模型"><a href="#8-2-异步处理的通用模型" class="headerlink" title="8-2 异步处理的通用模型"></a>8-2 异步处理的通用模型</h2><p>ES 官方参考了大量的异步场景，总结出了一套异步的通用模型，该模型可以覆盖几乎所有的异步场景，甚至是同步场景。<br>值得注意的是，为了兼容旧系统，ES6 并不打算抛弃掉过去的做法，只是基于该模型推出一个全新的 API，使用该 API，会让异步处理更加的简洁优雅。<br>理解该 API，最重要的，是理解它的异步模型</p>
<ol>
<li>ES6 将某一件可能发生异步操作的事情，分为两个阶段：<strong>unsettled</strong> 和 <strong>settled</strong></li>
</ol>
<ul>
<li>unsettled： 未决阶段，表示事情还在进行前期的处理，并没有发生通向结果的那件事</li>
<li>settled：已决阶段，事情已经有了一个结果，不管这个结果是好是坏，整件事情无法逆转</li>
</ul>
<p>事情总是从 未决阶段 逐步发展到 已决阶段的。并且，未决阶段拥有控制何时通向已决阶段的能力。</p>
<ol start="2">
<li>ES6 将事情划分为三种状态： pending、resolved、rejected</li>
</ol>
<ul>
<li>pending: 挂起，处于未决阶段，则表示这件事情还在挂起（最终的结果还没出来）</li>
<li>resolved：已处理，已决阶段的一种状态，表示整件事情已经出现结果，并是一个可以按照正常逻辑进行下去的结果</li>
<li>rejected：已拒绝，已决阶段的一种状态，表示整件事情已经出现结果，并是一个无法按照正常逻辑进行下去的结果，通常用于表示有一个错误</li>
</ul>
<p>既然未决阶段有权力决定事情的走向，因此，未决阶段可以决定事情最终的状态！</p>
<p>我们将 把事情变为 resolved 状态的过程叫做：<strong>resolve</strong>，推向该状态时，可能会传递一些数据</p>
<p>我们将 把事情变为 rejected 状态的过程叫做：<strong>reject</strong>，推向该状态时，同样可能会传递一些数据，通常为错误信息</p>
<p><strong>始终记住，无论是阶段，还是状态，是不可逆的！</strong></p>
<p><img src="/img/5-1.png" alt="image.png"></p>
<ol start="3">
<li>当事情达到已决阶段后，通常需要进行后续处理，不同的已决状态，决定了不同的后续处理。</li>
</ol>
<ul>
<li>resolved 状态：这是一个正常的已决状态，后续处理表示为 thenable</li>
<li>rejected 状态：这是一个非正常的已决状态，后续处理表示为 catchable</li>
</ul>
<p>后续处理可能有多个，因此会形成作业队列，这些后续处理会按照顺序，当状态到达后依次执行</p>
<p><img src="/img/5-2.png" alt="image.png"></p>
<ol start="4">
<li>整件事称之为 Promise</li>
</ol>
<p><img src="/img/5-3.png" alt="image.png"></p>
<p><strong>理解上面的概念，对学习 Promise 至关重要！</strong></p>
<h2 id="8-3Promise-的基本使用"><a href="#8-3Promise-的基本使用" class="headerlink" title="8-3Promise 的基本使用"></a>8-3Promise 的基本使用</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> pro = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 未决阶段的处理</span></span><br><span class="line">  <span class="comment">// 通过调用resolve函数将Promise推向已决阶段的resolved状态</span></span><br><span class="line">  <span class="comment">// 通过调用reject函数将Promise推向已决阶段的rejected状态</span></span><br><span class="line">  <span class="comment">// resolve和reject均可以传递最多一个参数，表示推向状态的数据</span></span><br><span class="line">  <span class="comment">// 立即执行</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">pro.then(</span><br><span class="line">  <span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">//这是thenable函数，如果当前的Promise已经是resolved状态，该函数会立即执行</span></span><br><span class="line">    <span class="comment">//如果当前是未决阶段，则会加入到作业队列，等待到达resolved状态后执行</span></span><br><span class="line">    <span class="comment">//data为状态数据</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">//这是catchable函数，如果当前的Promise已经是rejected状态，该函数会立即执行</span></span><br><span class="line">    <span class="comment">//如果当前是未决阶段，则会加入到作业队列，等待到达rejected状态后执行</span></span><br><span class="line">    <span class="comment">//err为状态数据</span></span><br><span class="line">  &#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p><strong>细节</strong></p>
<ol>
<li>未决阶段的处理函数是同步的，会立即执行</li>
<li>thenable 和 catchable 函数是异步的，就算是立即执行，也会加入到事件队列中等待执行，并且，加入的队列是微队列</li>
<li>pro.then 可以只添加 thenable 函数，pro.catch 可以单独添加 catchable 函数</li>
<li>在未决阶段的处理函数中，如果发生未捕获的错误，会将状态推向 rejected，并会被 catchable 捕获</li>
<li>一旦状态推向了已决阶段，无法再对状态做任何更改</li>
<li>Promise 并没有消除回调，只是让回调变得可控</li>
</ol>
<p>创建 promise 演示</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> pro = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`邓哥向女神1发出来了表白短信`</span>);</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">Math</span>.random() &lt; <span class="number">0.1</span>) &#123;</span><br><span class="line">      <span class="comment">//女神同意</span></span><br><span class="line">      resolve(<span class="literal">true</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      resolve(<span class="literal">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, <span class="number">3000</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 辅助函数,把传进来的对象拼接成url的字符串</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">toData</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (obj === <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> obj;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">let</span> arr = [];</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i <span class="keyword">in</span> obj) &#123;</span><br><span class="line">    <span class="keyword">let</span> str = i + <span class="string">&quot;=&quot;</span> + obj[i];</span><br><span class="line">    arr.push(str);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> arr.join(<span class="string">&quot;&amp;&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 封装Ajax</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ajax</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">//指定提交方式的默认值</span></span><br><span class="line">    obj.type = obj.type || <span class="string">&quot;get&quot;</span>;</span><br><span class="line">    <span class="comment">//设置是否异步，默认为true(异步)</span></span><br><span class="line">    obj.async = obj.async || <span class="literal">true</span>;</span><br><span class="line">    <span class="comment">//设置数据的默认值</span></span><br><span class="line">    obj.data = obj.data || <span class="literal">null</span>;</span><br><span class="line">    <span class="comment">// 根据不同的浏览器创建XHR对象</span></span><br><span class="line">    <span class="keyword">let</span> xhr = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">window</span>.XMLHttpRequest) &#123;</span><br><span class="line">      <span class="comment">// 非IE浏览器</span></span><br><span class="line">      xhr = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// IE浏览器</span></span><br><span class="line">      xhr = <span class="keyword">new</span> ActiveXObject(<span class="string">&quot;Microsoft.XMLHTTP&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 区分get和post,发送HTTP请求</span></span><br><span class="line">    <span class="keyword">if</span> (obj.type === <span class="string">&quot;post&quot;</span>) &#123;</span><br><span class="line">      xhr.open(obj.type, obj.url, obj.async);</span><br><span class="line">      xhr.setRequestHeader(<span class="string">&quot;Content-Type&quot;</span>, <span class="string">&quot;application/x-www-form-urlencoded&quot;</span>);</span><br><span class="line">      <span class="keyword">let</span> data = toData(obj.data);</span><br><span class="line">      xhr.send(data);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">let</span> url = obj.url + <span class="string">&quot;?&quot;</span> + toData(obj.data);</span><br><span class="line">      xhr.open(obj.type, url, obj.async);</span><br><span class="line">      xhr.send();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 接收返回过来的数据</span></span><br><span class="line">    xhr.onreadystatechange = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (xhr.readyState === <span class="number">4</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> ((xhr.status &gt;= <span class="number">200</span> &amp;&amp; xhr.status &lt; <span class="number">300</span>) || xhr.status == <span class="number">304</span>) &#123;</span><br><span class="line">          resolve(<span class="built_in">JSON</span>.parse(xhr.responseText));</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          reject(xhr.status);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> pro = <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  ajax(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&quot;./data/students.json?name=李华&quot;</span>,</span><br><span class="line">    <span class="comment">// success: function(data) &#123;</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line">    <span class="comment">// 速写</span></span><br><span class="line">    <span class="function"><span class="title">success</span>(<span class="params">data</span>)</span> &#123;</span><br><span class="line">      resolve(data);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="function"><span class="title">error</span>(<span class="params">err</span>)</span> &#123;</span><br><span class="line">      reject(error);</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>如果当前的 Promise 已经是 resolved 状态，该函数会立即执行</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> pro = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;未决阶段&quot;</span>);</span><br><span class="line">  resolve(<span class="number">123</span>);</span><br><span class="line">&#125;);</span><br><span class="line">pro.then(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">//pro的状态是resloved</span></span><br><span class="line">  <span class="built_in">console</span>.log(data); <span class="comment">// 123</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>如果当前是未决阶段，则会加入到作业队列，等待到达 resolved 状态后执行</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> pro = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;未决阶段&quot;</span>);</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    resolve(<span class="number">123</span>);</span><br><span class="line">  &#125;, <span class="number">3000</span>);</span><br><span class="line">&#125;);</span><br><span class="line">pro.then(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">//pro的状态是pending</span></span><br><span class="line">  <span class="built_in">console</span>.log(data);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 可以注册多个then用来表示已决做什么</span></span><br></pre></td></tr></table></figure>

<p>catchable</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> pro = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;未决阶段&quot;</span>);</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">Math</span>.random() &lt; <span class="number">0.5</span>) &#123;</span><br><span class="line">      resolve(<span class="number">123</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      reject(<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&quot;sanjs&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, <span class="number">3000</span>);</span><br><span class="line">&#125;);</span><br><span class="line">pro.then(</span><br><span class="line">  <span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(data);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(err);</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>封装初级演示 1</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">biaobai</span>(<span class="params">god</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`邓哥向<span class="subst">$&#123;god&#125;</span>发出了表白短信`</span>);</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="built_in">Math</span>.random() &lt; <span class="number">0.1</span>) &#123;</span><br><span class="line">        <span class="comment">//女神同意拉</span></span><br><span class="line">        resolve(<span class="literal">true</span>); <span class="comment">// 一定resolve成功</span></span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">//resolve</span></span><br><span class="line">        resolve(<span class="literal">false</span>); <span class="comment">//  一定resolve成功</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;, <span class="number">3000</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//一定成功，失败指的是短信发不出去</span></span><br><span class="line"><span class="keyword">const</span> pro = biaobai(<span class="string">&quot;女神1&quot;</span>);</span><br><span class="line">pro.then(<span class="function">(<span class="params">result</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(result);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>pro 去掉简化</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">biaobai(<span class="string">&quot;女神1&quot;</span>).then(<span class="function">(<span class="params">result</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(result);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>演示 2</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 辅助函数,把传进来的对象拼接成url的字符串</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">toData</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (obj === <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> obj;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">let</span> arr = [];</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i <span class="keyword">in</span> obj) &#123;</span><br><span class="line">    <span class="keyword">let</span> str = i + <span class="string">&quot;=&quot;</span> + obj[i];</span><br><span class="line">    arr.push(str);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> arr.join(<span class="string">&quot;&amp;&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 封装Ajax</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ajax</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 改动处</span></span><br><span class="line">    <span class="comment">//指定提交方式的默认值</span></span><br><span class="line">    obj.type = obj.type || <span class="string">&quot;get&quot;</span>;</span><br><span class="line">    <span class="comment">//设置是否异步，默认为true(异步)</span></span><br><span class="line">    obj.async = obj.async || <span class="literal">true</span>;</span><br><span class="line">    <span class="comment">//设置数据的默认值</span></span><br><span class="line">    obj.data = obj.data || <span class="literal">null</span>;</span><br><span class="line">    <span class="comment">// 根据不同的浏览器创建XHR对象</span></span><br><span class="line">    <span class="keyword">let</span> xhr = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">window</span>.XMLHttpRequest) &#123;</span><br><span class="line">      <span class="comment">// 非IE浏览器</span></span><br><span class="line">      xhr = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// IE浏览器</span></span><br><span class="line">      xhr = <span class="keyword">new</span> ActiveXObject(<span class="string">&quot;Microsoft.XMLHTTP&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 区分get和post,发送HTTP请求</span></span><br><span class="line">    <span class="keyword">if</span> (obj.type === <span class="string">&quot;post&quot;</span>) &#123;</span><br><span class="line">      xhr.open(obj.type, obj.url, obj.async);</span><br><span class="line">      xhr.setRequestHeader(<span class="string">&quot;Content-Type&quot;</span>, <span class="string">&quot;application/x-www-form-urlencoded&quot;</span>);</span><br><span class="line">      <span class="keyword">let</span> data = toData(obj.data);</span><br><span class="line">      xhr.send(data);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">let</span> url = obj.url + <span class="string">&quot;?&quot;</span> + toData(obj.data);</span><br><span class="line">      xhr.open(obj.type, url, obj.async);</span><br><span class="line">      xhr.send();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 接收返回过来的数据</span></span><br><span class="line">    xhr.onreadystatechange = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (xhr.readyState === <span class="number">4</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> ((xhr.status &gt;= <span class="number">200</span> &amp;&amp; xhr.status &lt; <span class="number">300</span>) || xhr.status == <span class="number">304</span>) &#123;</span><br><span class="line">          resolve(<span class="built_in">JSON</span>.parse(xhr.responseText)); <span class="comment">// 改动处</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          reject(xhr.status); <span class="comment">// 改动处</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line">ajax(&#123; <span class="attr">url</span>: <span class="string">&quot;./data/students.json?name=李华&quot;</span> &#125;).then(</span><br><span class="line">  <span class="function">(<span class="params">resp</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(resp);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(err);</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>演示 3</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">  <span class="comment">// const pro = new Promise((resolve, reject) =&gt; &#123;</span></span></span><br><span class="line"><span class="javascript">  <span class="comment">//     console.log(&quot;未决阶段&quot;)</span></span></span><br><span class="line"><span class="javascript">  <span class="comment">//     resolve(123);</span></span></span><br><span class="line"><span class="javascript">  <span class="comment">// &#125;)</span></span></span><br><span class="line"><span class="javascript">  <span class="comment">// pro.then(data =&gt; &#123;</span></span></span><br><span class="line"><span class="javascript">  <span class="comment">//     // pro的状态是resolved</span></span></span><br><span class="line"><span class="javascript">  <span class="comment">//     console.log(data);</span></span></span><br><span class="line"><span class="javascript">  <span class="comment">// &#125;)</span></span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">  <span class="keyword">const</span> pro = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">    <span class="built_in">console</span>.log(<span class="string">&quot;未决阶段&quot;</span>);</span></span><br><span class="line"><span class="javascript">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">      resolve(<span class="number">123</span>);</span></span><br><span class="line"><span class="javascript">    &#125;, <span class="number">3000</span>);</span></span><br><span class="line"><span class="javascript">  &#125;);</span></span><br><span class="line"><span class="javascript">  pro.then(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">    <span class="comment">// pro的状态是pending</span></span></span><br><span class="line"><span class="javascript">    <span class="built_in">console</span>.log(data);</span></span><br><span class="line"><span class="javascript">  &#125;);</span></span><br><span class="line"><span class="javascript">  pro.then(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">    <span class="comment">// pro的状态是pending</span></span></span><br><span class="line"><span class="javascript">    <span class="built_in">console</span>.log(data);</span></span><br><span class="line"><span class="javascript">  &#125;);</span></span><br><span class="line"><span class="javascript">  pro.then(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">    <span class="comment">// pro的状态是pending</span></span></span><br><span class="line"><span class="javascript">    <span class="built_in">console</span>.log(data);</span></span><br><span class="line"><span class="javascript">  &#125;);</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>演示 4</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">  <span class="keyword">const</span> pro = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">    <span class="built_in">console</span>.log(<span class="string">&quot;未决阶段&quot;</span>);</span></span><br><span class="line"><span class="javascript">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">if</span> (<span class="built_in">Math</span>.random &lt; <span class="number">0.5</span>) &#123;</span></span><br><span class="line"><span class="javascript">        resolve(<span class="number">123</span>);</span></span><br><span class="line"><span class="javascript">      &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="javascript">        reject(<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&quot;asdfasdf&quot;</span>));</span></span><br><span class="line"><span class="javascript">      &#125;</span></span><br><span class="line"><span class="javascript">    &#125;, <span class="number">3000</span>);</span></span><br><span class="line"><span class="javascript">  &#125;);</span></span><br><span class="line"><span class="javascript">  pro.then(</span></span><br><span class="line"><span class="javascript">    <span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(data);</span></span><br><span class="line"><span class="javascript">    &#125;,</span></span><br><span class="line"><span class="javascript">    <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(err);</span></span><br><span class="line"><span class="javascript">    &#125;</span></span><br><span class="line"><span class="javascript">  );</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>演示 5</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">  <span class="keyword">const</span> pro = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">    <span class="built_in">console</span>.log(<span class="string">&quot;a&quot;</span>);</span></span><br><span class="line"><span class="javascript">    resolve(<span class="number">1</span>);</span></span><br><span class="line"><span class="javascript">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(<span class="string">&quot;b&quot;</span>);</span></span><br><span class="line"><span class="javascript">    &#125;, <span class="number">0</span>);</span></span><br><span class="line"><span class="javascript">  &#125;);</span></span><br><span class="line"><span class="javascript">  <span class="comment">//pro: resolved</span></span></span><br><span class="line"><span class="javascript">  pro.then(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">    <span class="built_in">console</span>.log(data);</span></span><br><span class="line"><span class="javascript">  &#125;);</span></span><br><span class="line"><span class="javascript">  pro.catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">    <span class="built_in">console</span>.log(err);</span></span><br><span class="line"><span class="javascript">  &#125;);</span></span><br><span class="line"><span class="javascript">  <span class="built_in">console</span>.log(<span class="string">&quot;c&quot;</span>);</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>在未决阶段的处理函数中，如果发生未捕获的错误，会将状态推向 rejected，并会被 catchable 捕获</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">  <span class="keyword">const</span> pro = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&quot;123&quot;</span>); <span class="comment">// 导致pro变成rejected</span></span></span><br><span class="line"><span class="javascript">  &#125;);</span></span><br><span class="line"><span class="javascript">  pro.then(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">    <span class="built_in">console</span>.log(data);</span></span><br><span class="line"><span class="javascript">  &#125;);</span></span><br><span class="line"><span class="javascript">  pro.catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">    <span class="built_in">console</span>.log(err);</span></span><br><span class="line"><span class="javascript">  &#125;);</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>一旦状态推向了已决阶段，无法再对状态做任何更改。（未捕获的错误）</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> pro = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  resolve(<span class="number">1</span>); <span class="comment">//一定是resolved</span></span><br><span class="line">  reject(<span class="number">2</span>); <span class="comment">//无效</span></span><br><span class="line">  resolve(<span class="number">3</span>); <span class="comment">//无效</span></span><br><span class="line">  reject(<span class="number">4</span>); <span class="comment">//无效</span></span><br><span class="line">&#125;);</span><br><span class="line">pro.then(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(data);</span><br><span class="line">&#125;);</span><br><span class="line">pro.catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(err);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">  <span class="keyword">const</span> pro = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&quot;abc&quot;</span>);</span></span><br><span class="line"><span class="javascript">    resolve(<span class="number">1</span>); <span class="comment">//已经有了Error,无效</span></span></span><br><span class="line"><span class="javascript">    reject(<span class="number">2</span>); <span class="comment">//无效</span></span></span><br><span class="line"><span class="javascript">    resolve(<span class="number">3</span>); <span class="comment">//无效</span></span></span><br><span class="line"><span class="javascript">    reject(<span class="number">4</span>); <span class="comment">//无效</span></span></span><br><span class="line"><span class="javascript">  &#125;);</span></span><br><span class="line"><span class="javascript">  pro.then(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">    <span class="built_in">console</span>.log(data);</span></span><br><span class="line"><span class="javascript">  &#125;);</span></span><br><span class="line"><span class="javascript">  pro.catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">    <span class="built_in">console</span>.log(err);</span></span><br><span class="line"><span class="javascript">  &#125;);</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>以上说的是未捕获的错误，如果已经捕获了</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> pro = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&quot;abc&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    resolve(<span class="number">1</span>); <span class="comment">//错误被捕获，有效了</span></span><br><span class="line">    reject(<span class="number">2</span>); <span class="comment">//无效</span></span><br><span class="line">    resolve(<span class="number">3</span>); <span class="comment">//无效</span></span><br><span class="line">    reject(<span class="number">4</span>); <span class="comment">//无效</span></span><br><span class="line">&#125;)</span><br><span class="line">pro.then(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(data)</span><br><span class="line">&#125;)</span><br><span class="line">pro.catch(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(err)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>未决阶段的处理函数是同步的，会立即执行</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> pro = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;a&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;b&quot;</span>);</span><br><span class="line"><span class="comment">//先输出a后b</span></span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> pro = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;a&quot;</span>);</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;aaa&quot;</span>);</span><br><span class="line">  &#125;, <span class="number">0</span>);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;aa&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;b&quot;</span>);</span><br><span class="line"><span class="comment">// a aa b aaa promise里面可以异步，两个模块同步</span></span><br></pre></td></tr></table></figure>

<p>thenable 和 catchable 函数是异步的，就算是立即执行，也会加入到事件队列中等待执行，并且，加入的队列是微队列</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> pro = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;a&quot;</span>);</span><br><span class="line">  resolve(<span class="number">1</span>);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;b&quot;</span>);</span><br><span class="line">  <span class="comment">// 状态推向resolved</span></span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//pro resolved</span></span><br><span class="line">pro.then(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(data);</span><br><span class="line">&#125;); <span class="comment">//then里面放的是异步函数</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;c&quot;</span>);</span><br><span class="line"><span class="comment">// a b c 1</span></span><br></pre></td></tr></table></figure>

<p>面试题:<br>知识：thenable 和 catchable 函数是异步的，就算是立即执行，也会加入到事件队列中等待执行，并且，加入的队列是微队列</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> pro = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;a&quot;</span>);</span><br><span class="line">  resolve(<span class="number">1</span>);</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;b&quot;</span>);</span><br><span class="line">  &#125;, <span class="number">0</span>);</span><br><span class="line">&#125;);</span><br><span class="line">pro.then(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(data);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;c&quot;</span>);</span><br><span class="line"><span class="comment">// 创建promise同步代码先出a,状态推向resolved,宏队列b,data立即微队列,同步代码c</span></span><br><span class="line"><span class="comment">// a c 1 b</span></span><br></pre></td></tr></table></figure>

<h2 id="8-4Promise-的串联"><a href="#8-4Promise-的串联" class="headerlink" title="8-4Promise 的串联"></a>8-4Promise 的串联</h2><p>当后续的 Promise 需要用到之前的 Promise 的处理结果时，需要 Promise 的串联<br>Promise 对象中，无论是 then 方法还是 catch 方法，它们都具有返回值，返回的是一个全新的 Promise 对象，它的状态满足下面的规则：</p>
<ol>
<li>如果当前的 Promise 是未决的，得到的新的 Promise 是挂起状态</li>
<li>如果当前的 Promise 是已决的，会运行响应的后续处理函数，并将后续处理函数的结果（返回值）作为 resolved 状态数据，应用到新的 Promise 中；如果后续处理函数发生错误，则把返回值作为 rejected 状态数据，应用到新的 Promise 中。</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> pro = ajax(&#123;</span><br><span class="line">  <span class="attr">url</span>: <span class="string">&quot;./data/students.json&quot;</span>,</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">const</span> pro2 = pro.then(<span class="function">(<span class="params">resp</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 这里面要运行完pro2才已决</span></span><br><span class="line">  <span class="comment">// throw new Error(&#x27;错误&#x27;)// reject</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; resp.length; i++) &#123;</span><br><span class="line">    <span class="keyword">if</span> (resp[i].name === <span class="string">&quot;李华&quot;</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> cid = resp[i].classId;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">console</span>.log(pro2);</span><br></pre></td></tr></table></figure>

<p>面试题：<strong>后续的 Promise 一定会等到前面的 Promise 有了后续处理结果后，才会变成已决状态</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> pro1 = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  resolve(<span class="number">1</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">console</span>.log(pro1); <span class="comment">//fulfilled</span></span><br><span class="line"><span class="keyword">const</span> pro2 = pro1.then(<span class="function">(<span class="params">result</span>) =&gt;</span> result * <span class="number">2</span>);</span><br><span class="line"><span class="comment">// pro2是一个Promise对象</span></span><br><span class="line"><span class="built_in">console</span>.log(pro2); <span class="comment">//pending</span></span><br><span class="line"><span class="comment">// 因为then是异步的，运行到打印pro2的时候函数还没调用(同步代码)</span></span><br></pre></td></tr></table></figure>

<p>面试题</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> pro1 = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  resolve(<span class="number">1</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">const</span> pro2 = pro1.then(<span class="function">(<span class="params">result</span>) =&gt;</span> result * <span class="number">2</span>); <span class="comment">//这里变成状态数据:2，pro2变成了已决</span></span><br><span class="line">pro2.then(</span><br><span class="line">  <span class="function">(<span class="params">result</span>) =&gt;</span> <span class="built_in">console</span>.log(result),</span><br><span class="line">  <span class="function">(<span class="params">err</span>) =&gt;</span> <span class="built_in">console</span>.log(err)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p><strong>面试题</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> pro1 = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">throw</span> <span class="number">1</span>;<span class="comment">// 推向rejected,导致pro2的err运行</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">const</span> pro2 = pro1.then(<span class="function"><span class="params">result</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> result * <span class="number">2</span>;</span><br><span class="line">&#125;, <span class="function"><span class="params">err</span> =&gt;</span> err * <span class="number">3</span>);<span class="comment">// 3, 此时pro2已决了</span></span><br><span class="line">pro2.then(<span class="function"><span class="params">result</span> =&gt;</span> <span class="built_in">console</span>.log(result * <span class="number">2</span>), <span class="function"><span class="params">err</span> =&gt;</span> <span class="built_in">console</span>.log(err * <span class="number">3</span>))<span class="comment">//这里主要看上述处理有没有错误，pro2没有错误，执行result</span></span><br><span class="line">结果：<span class="number">6</span></span><br></pre></td></tr></table></figure>

<p>变式</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> pro1 = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">throw</span> <span class="number">1</span>;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">const</span> pro2 = pro1.then(</span><br><span class="line">  <span class="function">(<span class="params">result</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> result * <span class="number">2</span>;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">throw</span> err;</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br><span class="line">pro2.then(</span><br><span class="line">  <span class="function">(<span class="params">result</span>) =&gt;</span> <span class="built_in">console</span>.log(result * <span class="number">2</span>),</span><br><span class="line">  <span class="function">(<span class="params">err</span>) =&gt;</span> <span class="built_in">console</span>.log(err * <span class="number">3</span>)</span><br><span class="line">); <span class="comment">//3</span></span><br></pre></td></tr></table></figure>

<p>思考：then 函数返回的 Promise 对象一开始一定是挂起状态：因为 then 的后序处理是异步的</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> pro1 = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">throw</span> <span class="number">1</span>;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">const</span> pro2 = pro1.then(</span><br><span class="line">  <span class="function">(<span class="params">result</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 这里是第一个调用then的，只看这里的处理函数</span></span><br><span class="line">    <span class="keyword">return</span> result * <span class="number">2</span>;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> err * <span class="number">3</span>; <span class="comment">//3</span></span><br><span class="line">  &#125;</span><br><span class="line">);</span><br><span class="line"><span class="keyword">const</span> pro3 = pro1.catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 这里得到的是一个新的Promise</span></span><br><span class="line">  <span class="keyword">throw</span> err * <span class="number">2</span>; <span class="comment">//1*2</span></span><br><span class="line">&#125;);</span><br><span class="line">pro2.then(</span><br><span class="line">  <span class="function">(<span class="params">result</span>) =&gt;</span> <span class="built_in">console</span>.log(result * <span class="number">2</span>),</span><br><span class="line">  <span class="function">(<span class="params">err</span>) =&gt;</span> <span class="built_in">console</span>.log(err * <span class="number">3</span>)</span><br><span class="line">); <span class="comment">// 输出6，调用的是result</span></span><br><span class="line">pro3.then(</span><br><span class="line">  <span class="function">(<span class="params">result</span>) =&gt;</span> <span class="built_in">console</span>.log(result * <span class="number">2</span>),</span><br><span class="line">  <span class="function">(<span class="params">err</span>) =&gt;</span> <span class="built_in">console</span>.log(err * <span class="number">3</span>)</span><br><span class="line">); <span class="comment">// 输出6，调用的是err</span></span><br></pre></td></tr></table></figure>

<p>如果前面的 Promise 的后续处理，返回的是一个 Promise，则返回的新的 Promise 状态和后续处理返回的 Promise 状态保持一致。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> pro1 = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  resolve(<span class="number">1</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">const</span> pro2 = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  resolve(<span class="number">2</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">const</span> pro3 = pro1</span><br><span class="line">  .then(<span class="function">(<span class="params">result</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> pro2;</span><br><span class="line">  &#125;)</span><br><span class="line">  .then(<span class="function">(<span class="params">result</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(result); <span class="comment">// 2</span></span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure>

<p>变式</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> pro1 = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  resolve(<span class="number">1</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">const</span> pro2 = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    resolve(<span class="number">2</span>);</span><br><span class="line">  &#125;, <span class="number">3000</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">const</span> pro3 = pro1</span><br><span class="line">  .then(<span class="function">(<span class="params">result</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;结果出来了，得到的是一个Promise&quot;</span>); <span class="comment">//一开始Pro1已决了，所以这个一开始就执行</span></span><br><span class="line">    <span class="keyword">return</span> pro2; <span class="comment">// Pro3要跟pro2状态保持一致，pro2还没运行出来，pro3得等着</span></span><br><span class="line">  &#125;)</span><br><span class="line">  .then(<span class="function">(<span class="params">result</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(result); <span class="comment">// 2；所以这里要等3s后才输出</span></span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure>

<p>简化为链式编程：便于阅读</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">pro1</span><br><span class="line">  .then(<span class="function">(<span class="params">result</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;结果出来了，得到的是一个Promise&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> pro2;</span><br><span class="line">  &#125;)</span><br><span class="line">  .then(<span class="function">(<span class="params">result</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(result); <span class="comment">// 这只是打印结果，对后续有影响的是函数的返回值</span></span><br><span class="line">    <span class="comment">// 不写，默认return undefined</span></span><br><span class="line">  &#125;)</span><br><span class="line">  .then(<span class="function">(<span class="params">result</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(result); <span class="comment">// undefined</span></span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure>

<p>解决实战问题</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 辅助函数,把传进来的对象拼接成url的字符串</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">toData</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (obj === <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> obj;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">let</span> arr = [];</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i <span class="keyword">in</span> obj) &#123;</span><br><span class="line">    <span class="keyword">let</span> str = i + <span class="string">&quot;=&quot;</span> + obj[i];</span><br><span class="line">    arr.push(str);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> arr.join(<span class="string">&quot;&amp;&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 封装Ajax</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ajax</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">//指定提交方式的默认值</span></span><br><span class="line">    obj.type = obj.type || <span class="string">&quot;get&quot;</span>;</span><br><span class="line">    <span class="comment">//设置是否异步，默认为true(异步)</span></span><br><span class="line">    obj.async = obj.async || <span class="literal">true</span>;</span><br><span class="line">    <span class="comment">//设置数据的默认值</span></span><br><span class="line">    obj.data = obj.data || <span class="literal">null</span>;</span><br><span class="line">    <span class="comment">// 根据不同的浏览器创建XHR对象</span></span><br><span class="line">    <span class="keyword">let</span> xhr = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">window</span>.XMLHttpRequest) &#123;</span><br><span class="line">      <span class="comment">// 非IE浏览器</span></span><br><span class="line">      xhr = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// IE浏览器</span></span><br><span class="line">      xhr = <span class="keyword">new</span> ActiveXObject(<span class="string">&quot;Microsoft.XMLHTTP&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 区分get和post,发送HTTP请求</span></span><br><span class="line">    <span class="keyword">if</span> (obj.type === <span class="string">&quot;post&quot;</span>) &#123;</span><br><span class="line">      xhr.open(obj.type, obj.url, obj.async);</span><br><span class="line">      xhr.setRequestHeader(<span class="string">&quot;Content-Type&quot;</span>, <span class="string">&quot;application/x-www-form-urlencoded&quot;</span>);</span><br><span class="line">      <span class="keyword">let</span> data = toData(obj.data);</span><br><span class="line">      xhr.send(data);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">let</span> url = obj.url + <span class="string">&quot;?&quot;</span> + toData(obj.data);</span><br><span class="line">      xhr.open(obj.type, url, obj.async);</span><br><span class="line">      xhr.send();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 接收返回过来的数据</span></span><br><span class="line">    xhr.onreadystatechange = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (xhr.readyState === <span class="number">4</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> ((xhr.status &gt;= <span class="number">200</span> &amp;&amp; xhr.status &lt; <span class="number">300</span>) || xhr.status == <span class="number">304</span>) &#123;</span><br><span class="line">          resolve(<span class="built_in">JSON</span>.parse(xhr.responseText));</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          reject(xhr.status);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//获取李华所在班级的老师的信息</span></span><br><span class="line"><span class="comment">//1. 获取李华的班级id   Promise</span></span><br><span class="line"><span class="comment">//2. 根据班级id获取李华所在班级的老师id   Promise</span></span><br><span class="line"><span class="comment">//3. 根据老师的id查询老师信息   Promise</span></span><br><span class="line"><span class="keyword">const</span> pro = ajax(&#123;</span><br><span class="line">  <span class="attr">url</span>: <span class="string">&quot;./data/students.json&quot;</span>,</span><br><span class="line">&#125;);</span><br><span class="line">pro</span><br><span class="line">  .then(<span class="function">(<span class="params">resp</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; resp.length; i++) &#123;</span><br><span class="line">      <span class="keyword">if</span> (resp[i].name === <span class="string">&quot;李华&quot;</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> resp[i].classId; <span class="comment">//班级id</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">  .then(<span class="function">(<span class="params">cid</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> ajax(&#123;</span><br><span class="line">      <span class="attr">url</span>: <span class="string">&quot;./data/classes.json?cid=&quot;</span> + cid,</span><br><span class="line">    &#125;).then(<span class="function">(<span class="params">cls</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; cls.length; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (cls[i].id === cid) &#123;</span><br><span class="line">          <span class="keyword">return</span> cls[i].teacherId;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;)</span><br><span class="line">  .then(<span class="function">(<span class="params">tid</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> ajax(&#123;</span><br><span class="line">      <span class="attr">url</span>: <span class="string">&quot;./data/teachers.json&quot;</span>,</span><br><span class="line">    &#125;).then(<span class="function">(<span class="params">ts</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; ts.length; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (ts[i].id === tid) &#123;</span><br><span class="line">          <span class="keyword">return</span> ts[i];</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;)</span><br><span class="line">  .then(<span class="function">(<span class="params">teacher</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(teacher);</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure>

<p>实战案例</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">biaobai</span>(<span class="params">god</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`邓哥向<span class="subst">$&#123;god&#125;</span>发出了表白短信`</span>);</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="built_in">Math</span>.random() &lt; <span class="number">0.3</span>) &#123;</span><br><span class="line">        resolve(<span class="literal">true</span>);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        resolve(<span class="literal">false</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;, <span class="number">500</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line">biaobai(<span class="string">&quot;女神1&quot;</span>)</span><br><span class="line">  .then(<span class="function">(<span class="params">resp</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (resp) &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&quot;女神1同意了&quot;</span>);</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> biaobai(<span class="string">&quot;女神2&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">  .then(<span class="function">(<span class="params">resp</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (resp === <span class="literal">undefined</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (resp) &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&quot;女神2同意了&quot;</span>);</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> biaobai(<span class="string">&quot;女神3&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">  .then(<span class="function">(<span class="params">resp</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (resp === <span class="literal">undefined</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (resp) &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&quot;女神3同意了&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&quot;都被拒绝了！&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line"><span class="comment">// 切记：上一个处理的结果就是下一个处理的状态数据</span></span><br></pre></td></tr></table></figure>

<p>优化：增加了初始化</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> gods = [<span class="string">&quot;女神1&quot;</span>, <span class="string">&quot;女神2&quot;</span>, <span class="string">&quot;女神3&quot;</span>, <span class="string">&quot;女神4&quot;</span>, <span class="string">&quot;女神5&quot;</span>];</span><br><span class="line"><span class="keyword">let</span> pro;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; gods.length; i++) &#123;</span><br><span class="line">  <span class="keyword">if</span> (i === <span class="number">0</span>) &#123;</span><br><span class="line">    pro = biaobai(gods[i]);</span><br><span class="line">  &#125;</span><br><span class="line">  pro = pro.then(<span class="function">(<span class="params">resp</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (resp === <span class="literal">undefined</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (resp) &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123;gods[i]&#125;</span>同意了`</span>);</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123;gods[i]&#125;</span>拒绝了`</span>);</span><br><span class="line">      <span class="keyword">if</span> (i &lt; gods.length - <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> biaobai(gods[i + <span class="number">1</span>]);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="8-5-Promise-的其他-API"><a href="#8-5-Promise-的其他-API" class="headerlink" title="8-5 Promise 的其他 API"></a>8-5 Promise 的其他 API</h2><h3 id="原型成员-实例成员"><a href="#原型成员-实例成员" class="headerlink" title="原型成员 (实例成员)"></a>原型成员 (实例成员)</h3><ul>
<li>then：注册一个后续处理函数，当 Promise 为 resolved 状态时运行该函数</li>
<li>catch：注册一个后续处理函数，当 Promise 为 rejected 状态时运行该函数</li>
<li>finally：[ES2018]注册一个后续处理函数（无参），当 Promise 为已决时运行该函数<blockquote>
<p>一个 Promise 不可能 then，catch 都执行</p>
</blockquote>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> pro = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  reject(<span class="number">1</span>);</span><br><span class="line">&#125;);</span><br><span class="line">pro.finally(<span class="function">() =&gt;</span> <span class="built_in">console</span>.log(<span class="string">&quot;finally1&quot;</span>));</span><br><span class="line">pro.finally(<span class="function">() =&gt;</span> <span class="built_in">console</span>.log(<span class="string">&quot;finally2&quot;</span>));</span><br><span class="line">pro.then(<span class="function">(<span class="params">resp</span>) =&gt;</span> <span class="built_in">console</span>.log(<span class="string">&quot;then1&quot;</span>, resp * <span class="number">1</span>));</span><br><span class="line">pro.then(<span class="function">(<span class="params">resp</span>) =&gt;</span> <span class="built_in">console</span>.log(<span class="string">&quot;then2&quot;</span>, resp * <span class="number">2</span>));</span><br><span class="line">pro.catch(<span class="function">(<span class="params">resp</span>) =&gt;</span> <span class="built_in">console</span>.log(<span class="string">&quot;catch1&quot;</span>, resp * <span class="number">1</span>));</span><br><span class="line">pro.catch(<span class="function">(<span class="params">resp</span>) =&gt;</span> <span class="built_in">console</span>.log(<span class="string">&quot;catch2&quot;</span>, resp * <span class="number">2</span>));</span><br></pre></td></tr></table></figure>

<h3 id="构造函数成员-（静态成员）"><a href="#构造函数成员-（静态成员）" class="headerlink" title="构造函数成员 （静态成员）"></a>构造函数成员 （静态成员）</h3><ul>
<li>resolve(数据)：该方法返回一个 resolved 状态的 Promise，传递的数据作为状态数据</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> pro = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  resolve(<span class="number">1</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 等效于：</span></span><br><span class="line"><span class="keyword">const</span> pro = <span class="built_in">Promise</span>.resolve(<span class="number">1</span>);</span><br></pre></td></tr></table></figure>

<p>特殊情况：如果传递的数据是 Promise，则直接返回传递的 Promise 对象</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> p = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  resolve(<span class="number">3</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// const pro = Promise.resolve(p);</span></span><br><span class="line"><span class="comment">//等效于</span></span><br><span class="line"><span class="keyword">const</span> pro = p;</span><br><span class="line"><span class="built_in">console</span>.log(pro === p); <span class="comment">//true</span></span><br></pre></td></tr></table></figure>

<ul>
<li>reject(数据)：该方法返回一个 rejected 状态的 Promise，传递的数据作为状态数据</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> pro = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  reject(<span class="number">1</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 等效于：</span></span><br><span class="line"><span class="keyword">const</span> pro = <span class="built_in">Promise</span>.reject(<span class="number">1</span>);</span><br></pre></td></tr></table></figure>

<ul>
<li>all(iterable)：这个方法返回一个新的 promise 对象，该 promise 对象在 iterable 参数对象里所有的 promise 对象都成功的时候才会触发成功，一旦有任何一个 iterable 里面的 promise 对象失败则立即触发该 promise 对象的失败。这个新的 promise 对象在触发成功状态以后，会把一个包含 iterable 里所有 promise 返回值的数组作为成功回调的返回值，顺序跟 iterable 的顺序保持一致；如果这个新的 promise 对象触发了失败状态，它会把 iterable 里第一个触发失败的 promise 对象的错误信息作为它的失败错误信息。Promise.all 方法常被用于处理多个 promise 对象的状态集合。</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getRandom</span>(<span class="params">min, max</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">Math</span>.floor(<span class="built_in">Math</span>.random() * (max - min)) + min;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> proms = [];</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">  proms.push(</span><br><span class="line">    <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">Math</span>.random() &lt; <span class="number">0.5</span>) &#123;</span><br><span class="line">          <span class="built_in">console</span>.log(i, <span class="string">&quot;完成&quot;</span>);</span><br><span class="line">          resolve(i);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="built_in">console</span>.log(i, <span class="string">&quot;失败&quot;</span>);</span><br><span class="line">          reject(i);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;, getRandom(<span class="number">1000</span>, <span class="number">5000</span>));</span><br><span class="line">    &#125;)</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//等到所有的promise变成resolved状态后输出: 全部完成</span></span><br><span class="line"><span class="keyword">const</span> pro = <span class="built_in">Promise</span>.all(proms); <span class="comment">// 把proms数组传进去，返回新的promise对象，必须等到所有promise都变成resolve后才变成resolve</span></span><br><span class="line">pro.then(<span class="function">(<span class="params">datas</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;全部完成&quot;</span>, datas);</span><br><span class="line">&#125;);</span><br><span class="line">pro.catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;有失败的&quot;</span>, err);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">console</span>.log(proms); <span class="comment">// 为什么这里直接输出promise数组？因为这是同步代码，同步创建的Promise,只是promise状态需要等待</span></span><br></pre></td></tr></table></figure>

<ul>
<li>race(iterable)：当 iterable 参数里的任意一个子 promise 被成功或失败后，父 promise 马上也会用子 promise 的成功返回值或失败详情作为参数调用父 promise 绑定的相应句柄，并返回该 promise 对象</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getRandom</span>(<span class="params">min, max</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">Math</span>.floor(<span class="built_in">Math</span>.random() * (max - min)) + min;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> proms = [];</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">  proms.push(</span><br><span class="line">    <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">Math</span>.random() &lt; <span class="number">0.5</span>) &#123;</span><br><span class="line">          <span class="built_in">console</span>.log(i, <span class="string">&quot;完成&quot;</span>);</span><br><span class="line">          resolve(i);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="built_in">console</span>.log(i, <span class="string">&quot;失败&quot;</span>);</span><br><span class="line">          reject(i);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;, getRandom(<span class="number">1000</span>, <span class="number">5000</span>));</span><br><span class="line">    &#125;)</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//等到所有的promise变成resolved状态后输出: 全部完成</span></span><br><span class="line"><span class="comment">// const pro = Promise.all(proms)</span></span><br><span class="line"><span class="comment">//  pro.then(data =&gt; &#123;</span></span><br><span class="line"><span class="comment">//    console.log(&quot;全部完成了&quot;, data);</span></span><br><span class="line"><span class="comment">//  &#125;)</span></span><br><span class="line"><span class="comment">//  pro.catch(err =&gt; &#123;</span></span><br><span class="line"><span class="comment">//    console.log(&quot;有人失败了&quot;, err);</span></span><br><span class="line"><span class="comment">//  &#125;)</span></span><br><span class="line"><span class="keyword">const</span> pro = <span class="built_in">Promise</span>.race(proms);</span><br><span class="line">pro.then(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;有人完成了&quot;</span>, data);</span><br><span class="line">&#125;);</span><br><span class="line">pro.catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;有人失败了&quot;</span>, err);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">console</span>.log(proms);</span><br></pre></td></tr></table></figure>

<p>应用</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">biaobai</span>(<span class="params">god</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`邓哥向女神【<span class="subst">$&#123;god&#125;</span>】发出了表白短信`</span>);</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="built_in">Math</span>.random() &lt; <span class="number">0.05</span>) &#123;</span><br><span class="line">        <span class="comment">//女神同意拉</span></span><br><span class="line">        <span class="built_in">console</span>.log(god, <span class="string">&quot;同意&quot;</span>);</span><br><span class="line">        resolve(<span class="literal">true</span>);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(god, <span class="string">&quot;拒绝&quot;</span>);</span><br><span class="line">        resolve(<span class="literal">false</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;, <span class="built_in">Math</span>.floor(<span class="built_in">Math</span>.random() * (<span class="number">3000</span> - <span class="number">1000</span>) + <span class="number">1000</span>));</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> proms = [];</span><br><span class="line"><span class="keyword">let</span> hasAgree = <span class="literal">false</span>; <span class="comment">//是否有女神同意</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">1</span>; i &lt;= <span class="number">20</span>; i++) &#123;</span><br><span class="line">  <span class="keyword">const</span> pro = biaobai(<span class="string">`女神<span class="subst">$&#123;i&#125;</span>`</span>).then(<span class="function">(<span class="params">resp</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (resp) &#123;</span><br><span class="line">      <span class="keyword">if</span> (hasAgree) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;发错了短信，邓哥很机智的拒绝了&quot;</span>);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        hasAgree = <span class="literal">true</span>;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;邓哥很开心，终于成功了！&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> resp;</span><br><span class="line">  &#125;);</span><br><span class="line">  proms.push(pro);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">Promise</span>.all(proms).then(<span class="function">(<span class="params">results</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;日志记录&quot;</span>, results);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="8-6-手写-Promise"><a href="#8-6-手写-Promise" class="headerlink" title="8-6 手写 Promise"></a>8-6 手写 Promise</h2><h2 id="8-7-async-和-await"><a href="#8-7-async-和-await" class="headerlink" title="8-7 async 和 await"></a>8-7 async 和 await</h2><p>async 和 await 是 ES2016 新增两个关键字，它们借鉴了 ES2015 中生成器在实际开发中的应用，目的是简化 Promise api 的使用，并非是替代 Promise。</p>
<h3 id="async"><a href="#async" class="headerlink" title="async"></a>async</h3><p>目的是简化在函数的返回值中对 Promise 的创建<br>async 用于修饰函数（无论是函数字面量还是函数表达式），放置在函数最开始的位置，被修饰函数的返回结果一定是 Promise 对象。<br>存在 setTimeout 就不能用了</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="number">1</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">2</span>; <span class="comment">// 完成时候的数据</span></span><br><span class="line">  <span class="comment">// throw 2;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//等效于</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="number">1</span>);</span><br><span class="line">    resolve(<span class="number">2</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果里面返回 Promise 就会返回这个 Promise 对象</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">    resolve(<span class="number">1</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="await"><a href="#await" class="headerlink" title="await"></a>await</h3><p><strong>await 关键字必须出现在 async 函数中！！！！</strong><br>await 用在某个表达式之前，如果表达式是一个 Promise，则得到的是 thenable 中的状态数据。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">test1</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="number">1</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">test2</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> result = <span class="keyword">await</span> test1();</span><br><span class="line">  <span class="built_in">console</span>.log(result);</span><br><span class="line">&#125;</span><br><span class="line">test2();</span><br></pre></td></tr></table></figure>

<p>等效于</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test1</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="number">1</span>);</span><br><span class="line">    resolve(<span class="number">2</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test2</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    test1().then(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> result = data;</span><br><span class="line">      <span class="built_in">console</span>.log(result);</span><br><span class="line">      resolve();</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line">test2();</span><br></pre></td></tr></table></figure>

<p>如果 await 的表达式不是 Promise，则会将其使用 Promise.resolve 包装后按照规则运行</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> result = <span class="keyword">await</span> <span class="number">1</span>; <span class="comment">//1不是promise</span></span><br><span class="line">  <span class="built_in">console</span>.log(result);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//等价于</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">Promise</span>.resolve(<span class="number">1</span>).then(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> result = data;</span><br><span class="line">      <span class="built_in">console</span>.log(result);</span><br><span class="line">      resolve();</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line">test();</span><br><span class="line"><span class="built_in">console</span>.log(<span class="number">123</span>);</span><br><span class="line"><span class="comment">// 先123 1 返回的是promise 不会阻塞</span></span><br></pre></td></tr></table></figure>

<p>演示 4</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">getPromise</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">Math</span>.random() &lt; <span class="number">0.5</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="number">2</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> result = <span class="keyword">await</span> getPromise();</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;正常状态&quot;</span>, result);</span><br><span class="line">  &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;错误状态&quot;</span>, err);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">test();</span><br></pre></td></tr></table></figure>

<p>改造计时器函数</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">delay</span>(<span class="params">duration</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      resolve();</span><br><span class="line">    &#125;, duration);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">biaobai</span>(<span class="params">god</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`邓哥向<span class="subst">$&#123;god&#125;</span>发出了表白短信`</span>);</span><br><span class="line">  <span class="keyword">await</span> delay(<span class="number">500</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">Math</span>.random() &lt; <span class="number">0.3</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="9-FetchApi"><a href="#9-FetchApi" class="headerlink" title="9.FetchApi"></a>9.FetchApi</h1><h2 id="9-1-Fetch-Api-概述"><a href="#9-1-Fetch-Api-概述" class="headerlink" title="9-1. Fetch Api 概述"></a>9-1. Fetch Api 概述</h2><p>XMLHttpRequest 的问题</p>
<ol>
<li>所有的功能全部集中在同一个对象上，容易书写出混乱不易维护的代码</li>
<li>采用传统的事件驱动模式，无法适配新的 Promise Api</li>
</ol>
<p>Fetch Api 的特点</p>
<ol>
<li>并非取代 AJAX，而是对 AJAX 传统 API 的改进</li>
<li>精细的功能分割：头部信息、请求信息、响应信息等均分布到不同的对象，更利于处理各种复杂的 AJAX 场景</li>
<li>使用 Promise Api，更利于异步代码的书写</li>
<li>Fetch Api 并非 ES6 的内容，属于 HTML5 新增的 Web Api</li>
<li>需要掌握网络通信的知识</li>
</ol>
<h2 id="9-2-基本使用"><a href="#9-2-基本使用" class="headerlink" title="9-2 基本使用"></a>9-2 基本使用</h2><p>请求测试地址：<a target="_blank" rel="noopener" href="http://101.132.72.36:5100/api/local">http://101.132.72.36:5100/api/local</a><br>使用 <code>fetch</code> 函数即可立即向服务器发送网络请求<br>参数<br>该函数有两个参数：</p>
<ol>
<li>必填，字符串，请求地址</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getProvince</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> url = <span class="string">&quot;http://101.132.72.36:5100/api/local&quot;</span>;</span><br><span class="line">  fetch(url);</span><br><span class="line">&#125;</span><br><span class="line">getProvince();</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>选填，对象，请求配置<br>请求配置对象</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">button</span>&gt;</span>得到所有的省份数据<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">  <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">getProvinces</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">const</span> url = <span class="string">&quot;http://101.132.72.36:5100/api/local&quot;</span>;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">const</span> resp = <span class="keyword">await</span> fetch(url);</span></span><br><span class="line"><span class="javascript">    <span class="keyword">const</span> result = <span class="keyword">await</span> resp.json();</span></span><br><span class="line"><span class="javascript">    <span class="built_in">console</span>.log(result);</span></span><br><span class="line"><span class="javascript">  &#125;</span></span><br><span class="line"><span class="javascript">  <span class="built_in">document</span>.querySelector(<span class="string">&quot;button&quot;</span>).onclick = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">    getProvinces();</span></span><br><span class="line"><span class="javascript">  &#125;;</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>• method：字符串，请求方法，默认值 GET<br>• headers：对象，请求头信息<br>• body: 请求体的内容，必须匹配请求头中的 Content-Type<br>• mode：字符串，请求模式<br>• cors：默认值，配置为该值，会在请求头中加入 origin 和 referer。默认允许跨域<br>• no-cors：配置为该值，不会在请求头中加入 origin 和 referer，跨域的时候可能会出现问题<br>• same-origin：指示请求必须在同一个域中发生，如果请求其他域，则会报错<br>• credentials: 如何携带凭据（cookie）<br>• omit：默认值，不携带 cookie<br>• same-origin：请求同源地址时携带 cookie<br>• include：请求任何地址都携带 cookie<br>• cache：配置缓存模式<br>• default: 表示 fetch 请求之前将检查下 http 的缓存.<br>• no-store: 表示 fetch 请求将完全忽略 http 缓存的存在. 这意味着请求之前将不再检查下 http 的缓存, 拿到响应后, 它也不会更新 http 缓存.<br>• no-cache: 如果存在缓存, 那么 fetch 将发送一个条件查询 request 和一个正常的 request, 拿到响应后, 它会更新 http 缓存.<br>• reload: 表示 fetch 请求之前将忽略 http 缓存的存在, 但是请求拿到响应后, 它将主动更新 http 缓存.<br>• force-cache: 表示 fetch 请求不顾一切的依赖缓存, 即使缓存过期了, 它依然从缓存中读取. 除非没有任何缓存, 那么它将发送一个正常的 request.<br>• only-if-cached: 表示 fetch 请求不顾一切的依赖缓存, 即使缓存过期了, 它依然从缓存中读取. 如果没有缓存, 它将抛出网络错误(该设置只在 mode 为”same-origin”时有效).<br>返回值<br>ajax 是靠回调函数；xhr 是靠 readStateChange<br>fetch 函数返回一个 Promise 对象<br>• 当收到服务器的返回结果后（只要是有结果就行，不管成功还是失败），Promise 进入 resolved 状态，状态数据为 Response 对象<br>• 当网络发生错误（或其他导致无法完成交互的错误）时，Promise 进入 rejected 状态，状态数据为错误信息<br>拿到所有省份数据</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">getPromises</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> url = <span class="string">&quot;http://101.132.72.36:5100/api/local&quot;</span>;</span><br><span class="line">  <span class="comment">//GET请求数据在地址栏里面，POST请求数据在请求体里面</span></span><br><span class="line">  <span class="keyword">const</span> config = &#123;</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&quot;GET&quot;</span>,</span><br><span class="line">    <span class="attr">headers</span>: &#123;</span><br><span class="line">     <span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/json&quot;</span><span class="comment">//这里写了json格式，body里面就要用json格式(HTTP协议规定)</span></span><br><span class="line">      <span class="attr">a</span>: <span class="number">1</span>，<span class="comment">//也可以自定义</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> resp = <span class="keyword">await</span> fetch(url, config)</span><br><span class="line">    <span class="comment">// console.log(resp)</span></span><br><span class="line">    <span class="keyword">const</span> result = <span class="keyword">await</span> resp.text()<span class="comment">// 解析成文本</span></span><br><span class="line">    <span class="built_in">console</span>.log(result)</span><br><span class="line">  &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(err)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">getPromises()</span><br></pre></td></tr></table></figure>

<p>简化一下</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">getPromises</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> url = <span class="string">&quot;http://101.132.72.36:5100/api/local&quot;</span>;</span><br><span class="line">  <span class="keyword">const</span> resp = <span class="keyword">await</span> fetch(url);</span><br><span class="line">  <span class="keyword">const</span> result = <span class="keyword">await</span> resp.text();</span><br><span class="line">  <span class="built_in">console</span>.log(result);</span><br><span class="line">&#125;</span><br><span class="line">getPromises();</span><br></pre></td></tr></table></figure>

<p>• ok：boolean，当响应消息码在 200~299 之间时为 true，其他为 false<br>• status：number，响应的状态码<br>• text()：用于处理文本格式的 Ajax 响应。它从响应中获取文本流，将其读完，然后返回一个被解决为 string 对象的 Promise。（异步的）<br>• blob()：用于处理二进制文件格式（比如图片或者电子表格）的 Ajax 响应。它读取文件的原始数据，一旦读取完整个文件，就返回一个被解决为 blob 对象的 Promise。<br>• json()：用于处理 JSON 格式的 Ajax 的响应。它将 JSON 数据流转换为一个被解决为 JavaScript 对象的 promise。<br>• redirect()：可以用于重定向到另一个 URL。它会创建一个新的 Promise，以解决来自重定向的 URL 的响应。</p>
<h2 id="9-3Request-对象"><a href="#9-3Request-对象" class="headerlink" title="9-3Request 对象"></a>9-3Request 对象</h2><p>除了使用基本的 fetch 方法，还可以通过创建一个 Request 对象来完成请求（实际上，fetch 的内部会帮你创建一个 Request 对象）</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> Request(url地址, 配置);</span><br></pre></td></tr></table></figure>

<p>注意点：尽量保证每次请求都是一个新的 Request 对象</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> req;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getRequestInfo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">//得到request对象</span></span><br><span class="line">  <span class="keyword">if</span> (!req) &#123;</span><br><span class="line">    <span class="comment">//没有的话，创建一个</span></span><br><span class="line">    <span class="keyword">const</span> url = <span class="string">&quot;http://101.132.72.36:5100/api/local&quot;</span>;</span><br><span class="line">    req = <span class="keyword">new</span> Request(url, &#123;&#125;);</span><br><span class="line">    <span class="built_in">console</span>.log(req);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 尽量保证每次请求都是一个新的Request对象</span></span><br><span class="line">  <span class="keyword">return</span> req.clone(); <span class="comment">//克隆一个全新的request对象，配置一致</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">getProvinces</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> resp = <span class="keyword">await</span> fetch(getRequestInfo());</span><br><span class="line">  <span class="keyword">const</span> result = <span class="keyword">await</span> resp.json();</span><br><span class="line">  <span class="built_in">console</span>.log(result);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="9-4-Response-对象"><a href="#9-4-Response-对象" class="headerlink" title="9-4 Response 对象"></a>9-4 Response 对象</h2><blockquote>
<p>模拟服务器相应结果</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> req;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getRequestInfo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!req) &#123;</span><br><span class="line">    <span class="keyword">const</span> url = <span class="string">&quot;http://101.132.72.36:5100/api/local&quot;</span>;</span><br><span class="line">    req = <span class="keyword">new</span> Request(url, &#123;&#125;);</span><br><span class="line">    <span class="built_in">console</span>.log(req);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> req.clone(); <span class="comment">//克隆一个全新的request对象，配置一致</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">getProvinces</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// const resp = await fetch(getRequestInfo()) 请求服务器</span></span><br><span class="line">  <span class="comment">// 模拟服务器相应结果：测试用的数据用Response构建</span></span><br><span class="line">  <span class="keyword">const</span> resp = <span class="keyword">new</span> Response(</span><br><span class="line">    <span class="string">`[</span></span><br><span class="line"><span class="string">&#123;&quot;id&quot;:1, &quot;name&quot;:&quot;北京&quot;&#125;,</span></span><br><span class="line"><span class="string">&#123;&quot;id&quot;:2, &quot;name&quot;:&quot;天津&quot;&#125;</span></span><br><span class="line"><span class="string">]`</span>,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="comment">// 配置</span></span><br><span class="line">      <span class="attr">ok</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">status</span>: <span class="number">200</span>,</span><br><span class="line">    &#125;</span><br><span class="line">  );</span><br><span class="line">  <span class="keyword">const</span> result = <span class="keyword">await</span> getJSON(resp);</span><br><span class="line">  <span class="built_in">console</span>.log(result);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">getJSON</span>(<span class="params">resp</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> json = <span class="keyword">await</span> resp.json();</span><br><span class="line">  <span class="keyword">return</span> json;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="9-5-Headers-对象"><a href="#9-5-Headers-对象" class="headerlink" title="9-5 Headers 对象"></a>9-5 Headers 对象</h2><p>在 Request 和 Response 对象内部，会将传递的请求头对象，转换为 Headers<br>Headers 对象中的方法：</p>
<ul>
<li>has(key)：检查请求头中是否存在指定的 key 值</li>
<li>get(key): 得到请求头中对应的 key 值</li>
<li>set(key, value)：修改对应的键值对。不存在就会新增</li>
<li>append(key, value)：添加对应的键值对。如果添加的一样，就会逗号分隔成两个值</li>
<li>keys(): 得到所有的请求头键的集合</li>
<li>values(): 得到所有的请求头中的值的集合</li>
<li>entries(): 得到所有请求头中的键值对的集合</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> req;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getCommonHeaders</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> Headers(&#123;</span><br><span class="line">    <span class="attr">a</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="attr">b</span>: <span class="number">2</span>,</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">printHeaders</span>(<span class="params">headers</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> datas = headers.entries();</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> pair <span class="keyword">of</span> datas) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`key: <span class="subst">$&#123;pair[<span class="number">0</span>]&#125;</span>，value: <span class="subst">$&#123;pair[<span class="number">1</span>]&#125;</span>`</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getRequestInfo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!req) &#123;</span><br><span class="line">    <span class="keyword">const</span> url = <span class="string">&quot;http://101.132.72.36:5100/api/local&quot;</span>;</span><br><span class="line">    <span class="keyword">const</span> headers = getCommonHeaders();</span><br><span class="line">    headers.set(<span class="string">&quot;a&quot;</span>, <span class="number">3</span>);</span><br><span class="line">    req = <span class="keyword">new</span> Request(url, &#123;</span><br><span class="line">      headers,</span><br><span class="line">    &#125;);</span><br><span class="line">    printHeaders(headers);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> req.clone();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">getProvinces</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> resp = <span class="keyword">await</span> fetch(getRequestInfo());</span><br><span class="line">  printHeaders(resp.headers);</span><br><span class="line">  <span class="keyword">const</span> result = <span class="keyword">await</span> getJSON(resp);</span><br><span class="line">  <span class="built_in">console</span>.log(result);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">getJSON</span>(<span class="params">resp</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> json = <span class="keyword">await</span> resp.json();</span><br><span class="line">  <span class="keyword">return</span> json;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="9-6-文件上传"><a href="#9-6-文件上传" class="headerlink" title="9-6 文件上传"></a>9-6 文件上传</h2><p>流程：</p>
<ol>
<li>客户端将文件数据发送给服务器</li>
<li>服务器保存上传的文件数据到服务器端</li>
<li>服务器响应给客户端一个文件访问地址</li>
</ol>
<p>测试地址：<a target="_blank" rel="noopener" href="http://101.132.72.36:5100/api/upload">http://101.132.72.36:5100/api/upload</a><br>键的名称（表单域名称）：imagefile<br>请求方法：POST<br>请求的表单格式：multipart/form-data<br>请求体中必须包含一个键值对，键的名称是服务器要求的名称，值是文件数据<br>HTML5 中，JS 仍然无法随意的获取文件数据，但是可以获取到 input 元素中，被用户选中的文件数据<br>自己创建请求体很麻烦，所以可以利用 HTML5 提供的 FormData 构造函数来创建请求体</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span> <span class="attr">id</span>=<span class="string">&quot;imgAvatar&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">id</span>=<span class="string">&quot;avatar&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span>&gt;</span>上传<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">  <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">upload</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">const</span> inp = <span class="built_in">document</span>.getElementById(<span class="string">&quot;avatar&quot;</span>);</span></span><br><span class="line"><span class="javascript">    <span class="keyword">if</span> (inp.files.length === <span class="number">0</span>) &#123;</span></span><br><span class="line"><span class="javascript">      alert(<span class="string">&quot;请选择要上传的文件&quot;</span>);</span></span><br><span class="line"><span class="javascript">      <span class="keyword">return</span>;</span></span><br><span class="line"><span class="javascript">    &#125;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">const</span> formData = <span class="keyword">new</span> FormData(); <span class="comment">//构建请求体</span></span></span><br><span class="line"><span class="javascript">    formData.append(<span class="string">&quot;imagefile&quot;</span>, inp.files[<span class="number">0</span>]);</span></span><br><span class="line"><span class="javascript">    <span class="keyword">const</span> url = <span class="string">&quot;http://101.132.72.36:5100/api/upload&quot;</span>;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">const</span> resp = <span class="keyword">await</span> fetch(url, &#123;</span></span><br><span class="line"><span class="javascript">      <span class="attr">method</span>: <span class="string">&quot;POST&quot;</span>,</span></span><br><span class="line"><span class="javascript">      <span class="attr">body</span>: formData, <span class="comment">//自动修改请求头，自动完成了headers:&#123;&quot;Content-Type&quot;:&quot;multipart/form-data&quot;&#125;</span></span></span><br><span class="line"><span class="javascript">    &#125;);</span></span><br><span class="line"><span class="javascript">    <span class="keyword">const</span> result = <span class="keyword">await</span> resp.json();</span></span><br><span class="line"><span class="javascript">    <span class="keyword">return</span> result;</span></span><br><span class="line"><span class="javascript">  &#125;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">  <span class="built_in">document</span>.querySelector(<span class="string">&quot;button&quot;</span>).onclick = <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">const</span> result = <span class="keyword">await</span> upload();</span></span><br><span class="line"><span class="javascript">    <span class="built_in">console</span>.log(result);</span></span><br><span class="line"><span class="javascript">    <span class="keyword">const</span> img = <span class="built_in">document</span>.getElementById(<span class="string">&quot;imgAvatar&quot;</span>);</span></span><br><span class="line"><span class="javascript">    img.src = result.path;</span></span><br><span class="line"><span class="javascript">  &#125;;</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="10-迭代器和生成器"><a href="#10-迭代器和生成器" class="headerlink" title="10.迭代器和生成器"></a>10.迭代器和生成器</h1><h2 id="10-1-迭代器"><a href="#10-1-迭代器" class="headerlink" title="10-1 迭代器"></a>10-1 迭代器</h2><h3 id="背景知识"><a href="#背景知识" class="headerlink" title="背景知识"></a>背景知识</h3><ol>
<li>什么是迭代？</li>
</ol>
<p>从一个数据集合中按照一定的顺序，不断取出数据的过程</p>
<ol start="2">
<li>迭代和遍历的区别？</li>
</ol>
<p>迭代强调的是依次取数据，并不保证取多少，也不保证把所有的数据取完<br>遍历强调的是要把整个数据依次全部取出</p>
<ol start="3">
<li>迭代器</li>
</ol>
<p>对迭代过程的封装，在不同的语言中有不同的表现形式，通常为对象</p>
<ol start="4">
<li>迭代模式</li>
</ol>
<p>一种设计模式，用于统一迭代过程，并规范了迭代器规格：</p>
<ul>
<li>迭代器应该具有得到下一个数据的能力</li>
<li>迭代器应该具有判断是否还有后续数据的能力</li>
</ul>
<h3 id="JS-中的迭代器"><a href="#JS-中的迭代器" class="headerlink" title="JS 中的迭代器"></a>JS 中的迭代器</h3><p>JS 规定，如果一个对象具有 next 方法，并且该方法返回一个对象，该对象的格式如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">value</span>: 值, <span class="attr">done</span>: 是否迭代完成&#125;</span><br></pre></td></tr></table></figure>

<p>模板</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">  <span class="function"><span class="title">next</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">value</span>: xxx,</span><br><span class="line">      <span class="attr">done</span>: xx,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>则认为该对象 obj 是一个迭代器<br>含义：</p>
<ul>
<li>next 方法：用于得到下一个数据</li>
<li>返回的对象<ul>
<li>value：下一个数据的值</li>
<li>done：boolean，是否迭代完成</li>
</ul>
</li>
</ul>
<p>演示 demo</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>];</span><br><span class="line"><span class="comment">//迭代数组arr</span></span><br><span class="line"><span class="keyword">const</span> iterator = &#123;</span><br><span class="line">  <span class="attr">i</span>: <span class="number">0</span>, <span class="comment">//当前的数组下标</span></span><br><span class="line">  <span class="function"><span class="title">next</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> result = &#123;</span><br><span class="line">      <span class="attr">value</span>: arr[<span class="built_in">this</span>.i],</span><br><span class="line">      <span class="attr">done</span>: <span class="built_in">this</span>.i &gt;= arr.length, <span class="comment">//下标越界了</span></span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="built_in">this</span>.i++;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//让迭代器不断的取出下一个数据，直到没有数据为止</span></span><br><span class="line"><span class="keyword">let</span> data = iterator.next();</span><br><span class="line"><span class="keyword">while</span> (!data.done) &#123;</span><br><span class="line">  <span class="comment">//只要没有迭代完成，则取出数据</span></span><br><span class="line">  <span class="built_in">console</span>.log(data.value);</span><br><span class="line">  <span class="comment">//进行下一次迭代</span></span><br><span class="line">  data = iterator.next();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;迭代完成&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>演示 2</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> arr1 = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>];</span><br><span class="line"><span class="keyword">const</span> arr2 = [<span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>];</span><br><span class="line"><span class="comment">// 迭代器创建函数  iterator creator</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createIterator</span>(<span class="params">arr</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> i = <span class="number">0</span>; <span class="comment">//当前的数组下标</span></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="function"><span class="title">next</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">      <span class="keyword">var</span> result = &#123;</span><br><span class="line">        <span class="attr">value</span>: arr[i],</span><br><span class="line">        <span class="attr">done</span>: i &gt;= arr.length,</span><br><span class="line">      &#125;;</span><br><span class="line">      i++;</span><br><span class="line">      <span class="keyword">return</span> result;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> iter1 = createIterator(arr1);</span><br><span class="line">iter1.next();</span><br><span class="line"><span class="keyword">const</span> iter2 = createIterator(arr2);</span><br><span class="line">iter2.next();</span><br></pre></td></tr></table></figure>

<p>演示 3:无限延伸功能</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 依次得到斐波拉契数列前面n位的值</span></span><br><span class="line"><span class="comment">// 1 1 2 3 5 8 13 .....</span></span><br><span class="line"><span class="comment">//创建一个斐波拉契数列的迭代器</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createFeiboIterator</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> prev1 = <span class="number">1</span>,</span><br><span class="line">    prev2 = <span class="number">1</span>, <span class="comment">//当前位置的前1位和前2位</span></span><br><span class="line">    n = <span class="number">1</span>; <span class="comment">//当前是第几位</span></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="function"><span class="title">next</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">      <span class="keyword">let</span> value;</span><br><span class="line">      <span class="keyword">if</span> (n &lt;= <span class="number">2</span>) &#123;</span><br><span class="line">        value = <span class="number">1</span>;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        value = prev1 + prev2;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">const</span> result = &#123;</span><br><span class="line">        value,</span><br><span class="line">        <span class="attr">done</span>: <span class="literal">false</span>, <span class="comment">//这个数列无限延伸</span></span><br><span class="line">      &#125;;</span><br><span class="line">      prev2 = prev1;</span><br><span class="line">      prev1 = result.value;</span><br><span class="line">      n++;</span><br><span class="line">      <span class="keyword">return</span> result;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> iterator = createFeiboIterator();</span><br><span class="line">iterator.next();</span><br></pre></td></tr></table></figure>

<h2 id="10-2-可迭代协议与-for-of-循环"><a href="#10-2-可迭代协议与-for-of-循环" class="headerlink" title="10-2. 可迭代协议与 for-of 循环"></a>10-2. 可迭代协议与 for-of 循环</h2><h3 id="可迭代协议"><a href="#可迭代协议" class="headerlink" title="可迭代协议"></a>可迭代协议</h3><p><strong>概念回顾</strong></p>
<ul>
<li>迭代器(iterator)：一个具有 next 方法的对象，next 方法返回下一个数据并且能指示是否迭代完成</li>
<li>迭代器创建函数（iterator creator）：一个返回迭代器的函数</li>
</ul>
<p><strong>可迭代协议</strong><br>ES6 规定，如果一个对象具有知名符号属性<code>Symbol.iterator</code>，并且属性值是一个迭代器创建函数，则该对象是可迭代的（iterable）<br>数组就是个可迭代对象</p>
<blockquote>
<p>思考：如何知晓一个对象是否是可迭代的？数组、类数组、自己写的对象都可以做成可迭代对象<br>思考：如何遍历一个可迭代对象？for-of 循环</p>
</blockquote>
<h3 id="for-of-循环"><a href="#for-of-循环" class="headerlink" title="for-of 循环"></a>for-of 循环</h3><p>for-of 循环用于遍历可迭代对象，格式如下</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//迭代完成后循环结束</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> item <span class="keyword">in</span> iterable) &#123;</span><br><span class="line">  <span class="comment">//iterable：可迭代对象</span></span><br><span class="line">  <span class="comment">//item：每次迭代得到的数据</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>演示：数组就是个可迭代对象</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> arr = [<span class="number">5</span>, <span class="number">7</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">6</span>];</span><br><span class="line"><span class="comment">// const iterator = arr[Symbol.iterator]();</span></span><br><span class="line"><span class="comment">// let result = iterator.next();</span></span><br><span class="line"><span class="comment">// while (!result.done) &#123;</span></span><br><span class="line"><span class="comment">//     const item = result.value; //取出数据</span></span><br><span class="line"><span class="comment">//     console.log(item);</span></span><br><span class="line"><span class="comment">//     //下一次迭代</span></span><br><span class="line"><span class="comment">//     result = iterator.next();</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">// 等价于</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> item <span class="keyword">of</span> arr) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(item);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>演示 3</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span>1<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span>2<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span>3<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">  <span class="keyword">const</span> divs = <span class="built_in">document</span>.querySelectorAll(<span class="string">&quot;div&quot;</span>);</span></span><br><span class="line"><span class="javascript">  <span class="comment">// const iterator = divs[Symbol.iterator]()</span></span></span><br><span class="line"><span class="javascript">  <span class="comment">// let result = iterator.next();</span></span></span><br><span class="line"><span class="javascript">  <span class="comment">// while (!result.done) &#123;</span></span></span><br><span class="line"><span class="javascript">  <span class="comment">//     const item = result.value; //取出数据</span></span></span><br><span class="line"><span class="javascript">  <span class="comment">//     console.log(item);</span></span></span><br><span class="line"><span class="javascript">  <span class="comment">//     //下一次迭代</span></span></span><br><span class="line"><span class="javascript">  <span class="comment">//     result = iterator.next();</span></span></span><br><span class="line"><span class="javascript">  <span class="comment">// &#125;</span></span></span><br><span class="line"><span class="javascript">  <span class="comment">// 等价于</span></span></span><br><span class="line"><span class="javascript">  <span class="keyword">for</span> (<span class="keyword">const</span> item <span class="keyword">of</span> divs) &#123;</span></span><br><span class="line"><span class="javascript">    <span class="built_in">console</span>.log(item);</span></span><br><span class="line"><span class="javascript">  &#125;</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>演示：自定义可迭代对象</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//可迭代对象</span></span><br><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">  <span class="attr">a</span>: <span class="number">1</span>,</span><br><span class="line">  <span class="attr">b</span>: <span class="number">2</span>,</span><br><span class="line">  [<span class="built_in">Symbol</span>.iterator]() &#123;</span><br><span class="line">    <span class="keyword">const</span> keys = <span class="built_in">Object</span>.keys(<span class="built_in">this</span>); <span class="comment">//得到对象this里面所有属性名的一个数组</span></span><br><span class="line">    <span class="comment">// console.log(keys)</span></span><br><span class="line">    <span class="keyword">let</span> i = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">next</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> propName = keys[i];</span><br><span class="line">        <span class="keyword">const</span> propValue = <span class="built_in">this</span>[propName];</span><br><span class="line">        <span class="keyword">const</span> result = &#123;</span><br><span class="line">          <span class="attr">value</span>: &#123;</span><br><span class="line">            propName,</span><br><span class="line">            propValue,</span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="attr">done</span>: i &gt;= keys.length,</span><br><span class="line">        &#125;;</span><br><span class="line">        i++;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> item <span class="keyword">of</span> obj) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(item); <span class="comment">// &#123;propName:&quot;a&quot;, propValue:1&#125;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="展开运算符与可迭代对象"><a href="#展开运算符与可迭代对象" class="headerlink" title="展开运算符与可迭代对象"></a>展开运算符与可迭代对象</h3><p>展开运算符可以作用于可迭代对象，这样，就可以轻松的将可迭代对象转换为数组。<br>演示</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">  <span class="attr">a</span>: <span class="number">1</span>,</span><br><span class="line">  <span class="attr">b</span>: <span class="number">2</span>,</span><br><span class="line">  [<span class="built_in">Symbol</span>.iterator]() &#123;</span><br><span class="line">    <span class="keyword">const</span> keys = <span class="built_in">Object</span>.keys(<span class="built_in">this</span>);</span><br><span class="line">    <span class="keyword">let</span> i = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">next</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> propName = keys[i];</span><br><span class="line">        <span class="keyword">const</span> propValue = <span class="built_in">this</span>[propName];</span><br><span class="line">        <span class="keyword">const</span> result = &#123;</span><br><span class="line">          <span class="attr">value</span>: &#123;</span><br><span class="line">            propName,</span><br><span class="line">            propValue,</span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="attr">done</span>: i &gt;= keys.length,</span><br><span class="line">        &#125;;</span><br><span class="line">        i++;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> arr = [...obj];</span><br><span class="line"><span class="built_in">console</span>.log(arr);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(a, b);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">test(...obj);</span><br></pre></td></tr></table></figure>

<h2 id="10-3-生成器"><a href="#10-3-生成器" class="headerlink" title="10-3 生成器"></a>10-3 生成器</h2><h3 id="生成器-Generator"><a href="#生成器-Generator" class="headerlink" title="生成器 (Generator)"></a>生成器 (Generator)</h3><ol>
<li>什么是生成器？</li>
</ol>
<p>生成器是一个通过构造函数 Generator 创建的对象，生成器既是一个迭代器（有 next 方法），同时又是一个可迭代对象（有知名符号），可以用于 for of 循环</p>
<ol start="2">
<li>如何创建生成器</li>
</ol>
<p>生成器的创建，必须使用生成器函数（Generator Function）</p>
<ol start="3">
<li>如何书写一个生成器函数呢？</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//这是一个生成器函数，该函数一定返回一个生成器</span></span><br><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">method</span>(<span class="params"></span>) </span>&#123;&#125;</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>生成器函数内部是如何执行的？</li>
</ol>
<p>第一次调用只是生成了生成器，并没有调用里面<br>生成器函数内部是为了给生成器的每次迭代提供的数据<br>每次调用生成器的 next 方法，将导致生成器函数运行到下一个 yield 关键字位置<br>yield 是一个关键字，该关键字只能在生成器函数内部使用，表达“产生”一个迭代数据。</p>
<ol start="5">
<li>有哪些需要注意的细节？</li>
</ol>
<p>1). 生成器函数可以有返回值，返回值出现在第一次 done 为 true 时的 value 属性中<br>2). 调用生成器的 next 方法时，可以传递参数，传递的参数会交给 yield 表达式的返回值<br>3). 第一次调用 next 方法时，传参没有任何意义<br>4). 在生成器函数内部，可以调用其他生成器函数，但是要注意加上*号</p>
<ol start="6">
<li>生成器的其他 API</li>
</ol>
<ul>
<li>return 方法：调用该方法，可以提前结束生成器函数，从而提前让整个迭代过程结束</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">generator.return(); <span class="comment">//结束了，done为true</span></span><br><span class="line">generator.return(<span class="number">3</span>); <span class="comment">//value=3</span></span><br></pre></td></tr></table></figure>

<ul>
<li>throw 方法：调用该方法，可以在生成器中产生一个错误</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">generator.throw(<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&quot;sdbjjas&quot;</span>));</span><br></pre></td></tr></table></figure>

<p>演示</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">test</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;第1次运行&quot;</span>);</span><br><span class="line">  <span class="keyword">yield</span> <span class="number">1</span>;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;第2次运行&quot;</span>);</span><br><span class="line">  <span class="keyword">yield</span> <span class="number">2</span>;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;第3次运行&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> generator = test();</span><br></pre></td></tr></table></figure>

<p>优化演示：数组的迭代</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> arr1 = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>];</span><br><span class="line"><span class="keyword">const</span> arr2 = [<span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 迭代器创建函数  iterator creator</span></span><br><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">createIterator</span>(<span class="params">arr</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> item <span class="keyword">of</span> arr) &#123;</span><br><span class="line">    <span class="keyword">yield</span> item;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> iter1 = createIterator(arr1);</span><br><span class="line"><span class="keyword">const</span> iter2 = createIterator(arr2);</span><br></pre></td></tr></table></figure>

<p>创建一个斐波拉契数列的迭代器</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">createFeiboIterator</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> prev1 = <span class="number">1</span>,</span><br><span class="line">    prev2 = <span class="number">1</span>, <span class="comment">//当前位置的前1位和前2位</span></span><br><span class="line">    n = <span class="number">1</span>; <span class="comment">//当前是第几位</span></span><br><span class="line">  <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (n &lt;= <span class="number">2</span>) &#123;</span><br><span class="line">      <span class="keyword">yield</span> <span class="number">1</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> newValue = prev1 + prev2;</span><br><span class="line">      <span class="keyword">yield</span> newValue;</span><br><span class="line">      prev2 = prev1;</span><br><span class="line">      prev1 = newValue;</span><br><span class="line">    &#125;</span><br><span class="line">    n++;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> iterator = createFeiboIterator();</span><br></pre></td></tr></table></figure>

<p>演示：生成器函数可以有返回值，返回值出现在第一次 done 为 true 时的 value 属性中</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">test</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;第1次运行&quot;</span>);</span><br><span class="line">  <span class="keyword">yield</span> <span class="number">1</span>;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;第2次运行&quot;</span>);</span><br><span class="line">  <span class="keyword">yield</span> <span class="number">2</span>;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;第3次运行&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">10</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> generator = test();</span><br></pre></td></tr></table></figure>

<p>演示：调用生成器的 next 方法时，可以传递参数，传递的参数会交给 yield 表达式的返回值</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">test</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;函数开始&quot;</span>)</span><br><span class="line">  <span class="keyword">let</span> info = <span class="keyword">yield</span> <span class="number">1</span>;<span class="comment">//这里info不是1，这里根据参数动态变化</span></span><br><span class="line">  <span class="built_in">console</span>.log(info)</span><br><span class="line">  info = <span class="keyword">yield</span> <span class="number">2</span> + info;</span><br><span class="line">  <span class="built_in">console</span>.log(info)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> generator = test();</span><br><span class="line">控制台</span><br><span class="line">generator.next()</span><br><span class="line">demo.js:<span class="number">2</span> 函数开始</span><br><span class="line">&#123;<span class="attr">value</span>: <span class="number">1</span>, <span class="attr">done</span>: <span class="literal">false</span>&#125;</span><br><span class="line">generator.next(<span class="number">5</span>)</span><br><span class="line">&#123;<span class="attr">value</span>: <span class="number">7</span>, <span class="attr">done</span>: <span class="literal">false</span>&#125;</span><br></pre></td></tr></table></figure>

<p>演示:在生成器函数内部，可以调用其他生成器函数，但是要注意加上*号</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">t1</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">yield</span> <span class="string">&quot;a&quot;</span></span><br><span class="line">  <span class="keyword">yield</span> <span class="string">&quot;b&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">test</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  两种错误的调用方式：</span><br><span class="line">  <span class="number">1.</span> t1()<span class="comment">// 调用生成器函数不会导致里面的代码执行</span></span><br><span class="line">  <span class="number">2.</span> <span class="keyword">yield</span> t1();<span class="comment">// 将生成器对象给了yield执行</span></span><br><span class="line">  <span class="keyword">yield</span>* t1();<span class="comment">//相当于把t1里面代码直接copy过来了</span></span><br><span class="line">  <span class="keyword">yield</span> <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">yield</span> <span class="number">2</span>;</span><br><span class="line">  <span class="keyword">yield</span> <span class="number">3</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> generator = test();</span><br></pre></td></tr></table></figure>

<p>生成器<br>​</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// generator.next === generator[Symbol.iterator]().next()</span></span><br><span class="line"><span class="comment">//下面的函数是一个生成器函数，用于创建生成器</span></span><br><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">createGenerator</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;生成器函数的函数体 - 开始&quot;</span>);</span><br><span class="line">  <span class="keyword">yield</span> <span class="number">1</span>; <span class="comment">// &#123;value:1, done:false&#125;</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;生成器函数的函数体 - 运行1&quot;</span>);</span><br><span class="line">  <span class="keyword">yield</span> <span class="number">2</span>;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;生成器函数的函数体 - 运行2&quot;</span>);</span><br><span class="line">  <span class="keyword">yield</span> <span class="number">3</span>;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;生成器函数的函数体 - 运行3&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&quot;结束&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> generator = createGenerator(); <span class="comment">//调用后，一定得到一个生成器</span></span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">createArrayIterator</span>(<span class="params">arr</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; arr.length; i++) &#123;</span><br><span class="line">    <span class="keyword">const</span> item = arr[i];</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`第<span class="subst">$&#123;i&#125;</span>次迭代`</span>);</span><br><span class="line">    <span class="keyword">yield</span> item;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;函数结束&quot;</span>); <span class="comment">//迭代完成后运行</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> generator = createArrayIterator([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>]);</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//下面的函数是一个生成器函数，用于创建生成器</span></span><br><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">createGenerator</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;生成器函数的函数体 - 开始&quot;</span>);</span><br><span class="line">  <span class="keyword">yield</span> <span class="number">1</span>; <span class="comment">// &#123;value:1, done:false&#125;</span></span><br><span class="line">  <span class="keyword">return</span>; <span class="comment">// 后面不会运行了</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;生成器函数的函数体 - 运行1&quot;</span>);</span><br><span class="line">  <span class="keyword">yield</span> <span class="number">2</span>;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;生成器函数的函数体 - 运行2&quot;</span>);</span><br><span class="line">  <span class="keyword">yield</span> <span class="number">3</span>;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;生成器函数的函数体 - 运行3&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&quot;结束&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> generator = createGenerator(); <span class="comment">//调用后，一定得到一个生成器</span></span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">asyncGetData</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      resolve(<span class="string">&quot;成哥&quot;</span>);</span><br><span class="line">    &#125;, <span class="number">2000</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">task</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;开始获取数据....&quot;</span>);</span><br><span class="line">  <span class="keyword">const</span> data = <span class="keyword">yield</span> asyncGetData();</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;获取到数据：&quot;</span>, data);</span><br><span class="line">  <span class="keyword">const</span> data2 = <span class="keyword">yield</span> asyncGetData();</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;又获取到了数据：&quot;</span>, data2);</span><br><span class="line">  <span class="keyword">const</span> data3 = <span class="keyword">yield</span> <span class="number">1</span>;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;又获取到了数据：&quot;</span>, data3);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 通用函数：运行一个生成器任务</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">run</span>(<span class="params">generatorFunction</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> generator = generatorFunction(); <span class="comment">//得到一个生成器</span></span><br><span class="line">  next();</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 封装了generator的next方法，进行下一次迭代</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">next</span>(<span class="params">nextValue</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> result = generator.next(nextValue);</span><br><span class="line">    <span class="keyword">if</span> (result.done) &#123;</span><br><span class="line">      <span class="comment">//迭代结束了</span></span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> value = result.value; <span class="comment">//拿到迭代的数据</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> value.then === <span class="string">&quot;function&quot;</span>) &#123;</span><br><span class="line">      <span class="comment">//迭代的数据是一个Promise</span></span><br><span class="line">      value.then(<span class="function">(<span class="params">data</span>) =&gt;</span> next(data));</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      next(result.value);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">run(task);</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//下面的函数是一个生成器函数，用于创建生成器</span></span><br><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">createGenerator</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;生成器函数的函数体 - 开始&quot;</span>);</span><br><span class="line">  <span class="keyword">let</span> result = <span class="keyword">yield</span> <span class="number">1</span>; <span class="comment">//将1作为第一次的迭代的值,还没有完成赋值 绝不是把1赋值给result,result是外部给他的</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;生成器函数的函数体 - 运行1&quot;</span>, result);</span><br><span class="line">  result = <span class="keyword">yield</span> <span class="number">2</span>; <span class="comment">//将2作为第二次迭代的值</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;生成器函数的函数体 - 运行2&quot;</span>, result);</span><br><span class="line">  result = <span class="keyword">yield</span> <span class="number">3</span>;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;生成器函数的函数体 - 运行3&quot;</span>, result);</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&quot;结束&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> generator = createGenerator(); <span class="comment">//调用后，一定得到一个生成器</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> result = generator.next(); <span class="comment">//&#123;value:1, done:false&#125;</span></span><br><span class="line"><span class="keyword">while</span> (!result.done) &#123;</span><br><span class="line">  <span class="comment">//有迭代的值</span></span><br><span class="line">  result = generator.next(result.value); <span class="comment">//如果想把yield返回的值交给result</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//下面的函数是一个生成器函数，用于创建生成器</span></span><br><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">createGenerator</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;生成器函数的函数体 - 开始&quot;</span>);</span><br><span class="line">    <span class="keyword">let</span> result = <span class="keyword">yield</span> <span class="number">1</span>; <span class="comment">//将1作为第一次的迭代的值.</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;生成器函数的函数体 - 运行1&quot;</span>, result);</span><br><span class="line">    result = <span class="keyword">yield</span> <span class="number">2</span>; <span class="comment">//将2作为第二次迭代的值</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;生成器函数的函数体 - 运行2&quot;</span>, result);</span><br><span class="line">    result = <span class="keyword">yield</span> <span class="number">3</span>;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;生成器函数的函数体 - 运行3&quot;</span>, result);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;结束&quot;</span>;</span><br><span class="line">  &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;报错了&quot;</span>);</span><br><span class="line">    <span class="keyword">yield</span> <span class="string">&quot;Abc&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> generator = createGenerator(); <span class="comment">//调用后，一定得到一个生成器</span></span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//下面的函数是一个生成器函数，用于创建生成器</span></span><br><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">createGenerator</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;生成器函数的函数体 - 开始&quot;</span>);</span><br><span class="line">  <span class="keyword">let</span> result = <span class="keyword">yield</span> <span class="number">1</span>; <span class="comment">//将1作为第一次的迭代的值</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;生成器函数的函数体 - 运行1&quot;</span>, result);</span><br><span class="line">  result = <span class="keyword">yield</span> <span class="number">2</span>; <span class="comment">//将2作为第二次迭代的值</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;生成器函数的函数体 - 运行2&quot;</span>, result);</span><br><span class="line">  result = <span class="keyword">yield</span> <span class="number">3</span>;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;生成器函数的函数体 - 运行3&quot;</span>, result);</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&quot;结束&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> generator = createGenerator(); <span class="comment">//调用后，一定得到一个生成器</span></span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">g2</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;g2-开始&quot;</span>);</span><br><span class="line">  <span class="keyword">let</span> result = <span class="keyword">yield</span> <span class="string">&quot;g1&quot;</span>;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;g2-运行1&quot;</span>);</span><br><span class="line">  result = <span class="keyword">yield</span> <span class="string">&quot;g2&quot;</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">123</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//下面的函数是一个生成器函数，用于创建生成器</span></span><br><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">createGenerator</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;生成器函数的函数体 - 开始&quot;</span>);</span><br><span class="line">  <span class="keyword">let</span> result = <span class="keyword">yield</span> <span class="number">1</span>; <span class="comment">//将1作为第一次的迭代的值</span></span><br><span class="line">  result = <span class="keyword">yield</span>* g2(); <span class="comment">//result为g2函数的返回值</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;生成器函数的函数体 - 运行1&quot;</span>, result);</span><br><span class="line">  result = <span class="keyword">yield</span> <span class="number">2</span>; <span class="comment">//将2作为第二次迭代的值</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;生成器函数的函数体 - 运行2&quot;</span>, result);</span><br><span class="line">  result = <span class="keyword">yield</span> <span class="number">3</span>;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;生成器函数的函数体 - 运行3&quot;</span>, result);</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&quot;结束&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> generator = createGenerator(); <span class="comment">//调用后，一定得到一个生成器</span></span><br></pre></td></tr></table></figure>

<h2 id="10-4-生成器应用-异步任务控制"><a href="#10-4-生成器应用-异步任务控制" class="headerlink" title="10-4. 生成器应用-异步任务控制"></a>10-4. 生成器应用-异步任务控制</h2><p>高仿 await</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">task</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> d = <span class="keyword">yield</span> <span class="number">1</span>;</span><br><span class="line">  <span class="built_in">console</span>.log(d);</span><br><span class="line">  <span class="comment">// //d : 1</span></span><br><span class="line">  <span class="keyword">const</span> resp = <span class="keyword">yield</span> fetch(<span class="string">&quot;http://101.132.72.36:5100/api/local&quot;</span>);</span><br><span class="line">  <span class="keyword">const</span> result = <span class="keyword">yield</span> resp.json();</span><br><span class="line">  <span class="built_in">console</span>.log(result);</span><br><span class="line">&#125;</span><br><span class="line">run(task);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">run</span>(<span class="params">generatorFunc</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> generator = generatorFunc();</span><br><span class="line">  <span class="keyword">let</span> result = generator.next(); <span class="comment">//启动任务（开始迭代）, 得到迭代数据</span></span><br><span class="line">  handleResult();</span><br><span class="line">  <span class="comment">//对result进行处理</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">handleResult</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (result.done) &#123;</span><br><span class="line">      <span class="keyword">return</span>; <span class="comment">//迭代完成，不处理</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//迭代没有完成，分为两种情况</span></span><br><span class="line">    <span class="comment">//1. 迭代的数据是一个Promise</span></span><br><span class="line">    <span class="comment">//2. 迭代的数据是其他数据</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> result.value.then === <span class="string">&quot;function&quot;</span>) &#123;</span><br><span class="line">      <span class="comment">//promise里面有个then方法</span></span><br><span class="line">      <span class="comment">//1. 迭代的数据是一个Promise</span></span><br><span class="line">      <span class="comment">//等待Promise完成后，再进行下一次迭代</span></span><br><span class="line">      result.value.then(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">        result = generator.next(data);</span><br><span class="line">        handleResult();</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">//2. 迭代的数据是其他数据，直接进行下一次迭代</span></span><br><span class="line">      result = generator.next(result.value);</span><br><span class="line">      handleResult();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="React-复习迭代器生成器"><a href="#React-复习迭代器生成器" class="headerlink" title="React 复习迭代器生成器"></a>React 复习迭代器生成器</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//   iterator是一个迭代器;</span></span><br><span class="line"><span class="keyword">var</span> iterator = &#123;</span><br><span class="line">  <span class="attr">total</span>: <span class="number">3</span>, <span class="comment">//可迭代3次</span></span><br><span class="line">  <span class="attr">i</span>: <span class="number">1</span>, <span class="comment">//当前的迭代次数</span></span><br><span class="line">  <span class="function"><span class="title">next</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> obj = &#123;</span><br><span class="line">      <span class="comment">//当前这一次迭代到的数据</span></span><br><span class="line">      <span class="attr">value</span>: <span class="built_in">this</span>.i &gt; <span class="built_in">this</span>.total ? <span class="literal">undefined</span> : <span class="built_in">Math</span>.random(),</span><br><span class="line">      <span class="attr">done</span>: <span class="built_in">this</span>.i &gt; <span class="built_in">this</span>.total,</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="built_in">this</span>.i++;</span><br><span class="line">    <span class="keyword">return</span> obj;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//可无限迭代的随机数</span></span><br><span class="line"><span class="keyword">var</span> iterator = &#123;</span><br><span class="line">  <span class="function"><span class="title">next</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="comment">//当前这一次迭代到的数据</span></span><br><span class="line">      <span class="attr">value</span>: <span class="built_in">Math</span>.random(),</span><br><span class="line">      <span class="attr">done</span>: <span class="literal">false</span>,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//要输出斐波拉契数列的前N位</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//一个无限的斐波拉契数列 1 1 2 3 5 8 13 21</span></span><br><span class="line"><span class="keyword">var</span> iterator = &#123;</span><br><span class="line">  <span class="attr">a</span>: <span class="number">1</span>,</span><br><span class="line">  <span class="attr">b</span>: <span class="number">1</span>,</span><br><span class="line">  <span class="attr">curIndex</span>: <span class="number">1</span>, <span class="comment">//当前取到斐波拉契的第几位了，从1开始</span></span><br><span class="line">  <span class="function"><span class="title">next</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.curIndex === <span class="number">1</span> || <span class="built_in">this</span>.curIndex === <span class="number">2</span>) &#123;</span><br><span class="line">      <span class="built_in">this</span>.curIndex++;</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="attr">value</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="attr">done</span>: <span class="literal">false</span>,</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> c = <span class="built_in">this</span>.a + <span class="built_in">this</span>.b;</span><br><span class="line">    <span class="built_in">this</span>.curIndex++;</span><br><span class="line">    <span class="built_in">this</span>.a = <span class="built_in">this</span>.b;</span><br><span class="line">    <span class="built_in">this</span>.b = c;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">value</span>: c,</span><br><span class="line">      <span class="attr">done</span>: <span class="literal">false</span>,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">100</span>; i++) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(iterator.next().value);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//iterator是一个迭代器</span></span><br><span class="line"><span class="keyword">var</span> iterator = &#123;</span><br><span class="line">  <span class="attr">total</span>: <span class="number">3</span>, <span class="comment">//可迭代3次</span></span><br><span class="line">  <span class="attr">i</span>: <span class="number">1</span>, <span class="comment">//当前的迭代次数</span></span><br><span class="line">  <span class="function"><span class="title">next</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> obj = &#123;</span><br><span class="line">      <span class="comment">//当前这一次迭代到的数据</span></span><br><span class="line">      <span class="attr">value</span>: <span class="built_in">this</span>.i &gt; <span class="built_in">this</span>.total ? <span class="literal">undefined</span> : <span class="built_in">Math</span>.random(),</span><br><span class="line">      <span class="attr">done</span>: <span class="built_in">this</span>.i &gt; <span class="built_in">this</span>.total,</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="built_in">this</span>.i++;</span><br><span class="line">    <span class="keyword">return</span> obj;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//一个一个迭代，直到不能迭代为止</span></span><br><span class="line"><span class="keyword">var</span> next = iterator.next();</span><br><span class="line"><span class="keyword">while</span> (!next.done) &#123;</span><br><span class="line">  <span class="comment">//若当前迭代的数据不是迭代器的结束</span></span><br><span class="line">  <span class="comment">//如果当前还有数据</span></span><br><span class="line">  <span class="built_in">console</span>.log(next.value);</span><br><span class="line">  next = iterator.next();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//创建一个用户迭代数组的迭代器</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createArrayIterator</span>(<span class="params">arr</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> i = <span class="number">0</span>; <span class="comment">//下标 从0开始迭代</span></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="function"><span class="title">next</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="attr">value</span>: arr[i++],</span><br><span class="line">        <span class="attr">done</span>: i &gt; arr.length,</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> iterator = createArrayIterator([<span class="number">3</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">3</span>]);</span><br></pre></td></tr></table></figure>

<p>迭代器创建函数</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createIterator</span>(<span class="params">total</span>) </span>&#123;</span><br><span class="line">  i = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="function"><span class="title">next</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">      <span class="keyword">var</span> obj = &#123;</span><br><span class="line">        <span class="comment">//当前这一次迭代到的数据</span></span><br><span class="line">        <span class="attr">value</span>: i &gt; total ? <span class="literal">undefined</span> : <span class="built_in">Math</span>.random(),</span><br><span class="line">        <span class="attr">done</span>: i &gt; total,</span><br><span class="line">      &#125;;</span><br><span class="line">      i++;</span><br><span class="line">      <span class="keyword">return</span> obj;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> iterator = createIterator(<span class="number">5</span>);</span><br><span class="line"><span class="keyword">var</span> next = iterator.next();</span><br><span class="line"><span class="keyword">while</span> (!next.done) &#123;</span><br><span class="line">  <span class="comment">//若当前迭代的数据不是迭代器的结束</span></span><br><span class="line">  <span class="comment">//如果当前还有数据</span></span><br><span class="line">  <span class="built_in">console</span>.log(next.value);</span><br><span class="line">  next = iterator.next();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可迭代协议</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//obj满足可迭代协议</span></span><br><span class="line"><span class="comment">//obj可被迭代</span></span><br><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">  [<span class="built_in">Symbol</span>.iterator]: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> total = <span class="number">3</span>;</span><br><span class="line">    i = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="function"><span class="title">next</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">var</span> obj = &#123;</span><br><span class="line">          <span class="comment">//当前这一次迭代到的数据</span></span><br><span class="line">          <span class="attr">value</span>: i &gt; total ? <span class="literal">undefined</span> : <span class="built_in">Math</span>.random(),</span><br><span class="line">          <span class="attr">done</span>: i &gt; total,</span><br><span class="line">        &#125;;</span><br><span class="line">        i++;</span><br><span class="line">        <span class="keyword">return</span> obj;</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//模拟for-of循环</span></span><br><span class="line"><span class="keyword">var</span> iterator = obj[<span class="built_in">Symbol</span>.iterator]();</span><br><span class="line"><span class="keyword">var</span> result = iterator.next();</span><br><span class="line"><span class="keyword">while</span> (!result.done) &#123;</span><br><span class="line">  <span class="comment">//有数据</span></span><br><span class="line">  <span class="keyword">const</span> item = result.value;</span><br><span class="line">  <span class="built_in">console</span>.log(item); <span class="comment">//执行循环体</span></span><br><span class="line">  result = iterator.next();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> item <span class="keyword">of</span> obj) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(item);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="11-更多的集合类型"><a href="#11-更多的集合类型" class="headerlink" title="11.更多的集合类型"></a>11.更多的集合类型</h1><h2 id="11-1-set-集合"><a href="#11-1-set-集合" class="headerlink" title="11-1. set 集合"></a>11-1. set 集合</h2><blockquote>
<p>一直以来，JS 只能使用数组和对象来保存多个数据，缺乏像其他语言那样拥有丰富的集合类型。因此，ES6 新增了两种集合类型（set 和 map），用于在不同的场景中发挥作用。</p>
</blockquote>
<p><strong>set 用于存放不重复的数据</strong></p>
<ol>
<li>如何创建 set 集合</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="built_in">Set</span>(); <span class="comment">//创建一个没有任何内容的set集合</span></span><br><span class="line"><span class="keyword">new</span> <span class="built_in">Set</span>(iterable); <span class="comment">//创建一个具有初始内容的set集合，内容来自于可迭代对象每一次迭代的结果</span></span><br></pre></td></tr></table></figure>

<p>演示</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> set1 = <span class="keyword">new</span> <span class="built_in">Set</span>();</span><br><span class="line"><span class="built_in">console</span>.log(set1);</span><br><span class="line"><span class="keyword">const</span> set2 = <span class="keyword">new</span> <span class="built_in">Set</span>([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>]); <span class="comment">//简单的数组去重</span></span><br><span class="line"><span class="built_in">console</span>.log(set2);</span><br><span class="line"><span class="keyword">const</span> s2 = <span class="keyword">new</span> <span class="built_in">Set</span>(<span class="string">&quot;asdfasfasf&quot;</span>); <span class="comment">//会把字符串转成string对象，string对象可迭代</span></span><br><span class="line"><span class="built_in">console</span>.log(s2);</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>如何对 set 集合进行后续操作</li>
</ol>
<ul>
<li>add(数据): 添加一个数据到 set 集合末尾，如果数据已存在，则不进行任何操作<ul>
<li>set 使用 Object.is 的方式判断两个数据是否相同，但是，针对+0 和-0，set 认为是相等</li>
<li>Object.is(+0,-0)—-false</li>
</ul>
</li>
<li>has(数据): 判断 set 中是否存在对应的数据</li>
<li>delete(数据)：删除匹配的数据，返回是否删除成功</li>
<li>clear()：清空整个 set 集合</li>
<li>size: 获取 set 集合中的元素数量，只读属性，无法重新赋值</li>
</ul>
<ol start="3">
<li>如何与数组进行相互转换</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> s = <span class="keyword">new</span> <span class="built_in">Set</span>([x, x, x, x, x]);</span><br><span class="line"><span class="comment">// set本身也是一个可迭代对象，每次迭代的结果就是每一项的值</span></span><br><span class="line"><span class="keyword">const</span> arr = [...s];</span><br></pre></td></tr></table></figure>

<p>数组去重、字符串去重</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> arr = [<span class="number">45</span>, <span class="number">7</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">34</span>, <span class="number">46</span>, <span class="number">6</span>, <span class="number">57</span>, <span class="number">8</span>, <span class="number">55</span>, <span class="number">6</span>, <span class="number">46</span>];</span><br><span class="line"><span class="keyword">const</span> result = [...new <span class="built_in">Set</span>(arr)];</span><br><span class="line"><span class="built_in">console</span>.log(result);</span><br><span class="line"><span class="keyword">const</span> str = <span class="string">&quot;asf23sdfgsdgfsafasdfasfasfasfsafsagfdsfg&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> s = [...new <span class="built_in">Set</span>(str)].join(<span class="string">&quot;&quot;</span>); <span class="comment">// 转成数组后转成字符串</span></span><br><span class="line"><span class="built_in">console</span>.log(s);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>现有字符串”aaabbbcccdddeefggaa”，转换成连续不重复的字符串例如：abcdefga。（用正则写满分，其他方法酌情给分）（10 分）</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> reg = <span class="regexp">/(\w)\1*/g</span>;</span><br><span class="line"><span class="keyword">var</span> str = <span class="string">&quot;aaabbbcccdddeefggaa&quot;</span>;</span><br><span class="line"><span class="built_in">console</span>.log(str.replace(reg, <span class="string">&quot;$1&quot;</span>));</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>如何遍历</li>
</ol>
<p>1). 使用 for-of 循环</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> s1 = <span class="keyword">new</span> <span class="built_in">Set</span>();</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> item <span class="keyword">of</span> s1) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(item);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>2). 使用 set 中的实例方法 forEach</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">s1.forEach(<span class="function">(<span class="params">item, index, s</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(item, index, s);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">console</span>.log(s1);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;总数为：&quot;</span>, s1.size);</span><br></pre></td></tr></table></figure>

<p>注意：set 集合中不存在下标，因此 forEach 中的回调的第二个参数和第一个参数是一致的，均表示 set 中的每一项</p>
<h2 id="11-2-set-应用"><a href="#11-2-set-应用" class="headerlink" title="11-2. set 应用"></a>11-2. set 应用</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 两个数组的并集、交集、差集 （不能出现重复项），得到的结果是一个新数组</span></span><br><span class="line"><span class="keyword">const</span> arr1 = [<span class="number">33</span>, <span class="number">22</span>, <span class="number">55</span>, <span class="number">33</span>, <span class="number">11</span>, <span class="number">33</span>, <span class="number">5</span>];</span><br><span class="line"><span class="keyword">const</span> arr2 = [<span class="number">22</span>, <span class="number">55</span>, <span class="number">77</span>, <span class="number">88</span>, <span class="number">88</span>, <span class="number">99</span>, <span class="number">99</span>];</span><br></pre></td></tr></table></figure>

<p>并集<br>         去掉各自里面重复的和他们合起来重复的</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 写法1</span></span><br><span class="line"><span class="keyword">const</span> s = <span class="keyword">new</span> <span class="built_in">Set</span>(arr1.concat(arr2)); <span class="comment">// 连起来在去重</span></span><br><span class="line"><span class="keyword">const</span> result = [...s];</span><br><span class="line"><span class="built_in">console</span>.log(result);</span><br><span class="line"><span class="comment">// 写法2</span></span><br><span class="line"><span class="keyword">const</span> result = [...new <span class="built_in">Set</span>(arr1.concat(arr2))];</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;并集&quot;</span>, result);</span><br><span class="line"><span class="comment">// 写法3</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;并集&quot;</span>, [...new <span class="built_in">Set</span>([...arr1, ...arr2])]);</span><br></pre></td></tr></table></figure>

<p>交集</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> s1 = <span class="keyword">new</span> <span class="built_in">Set</span>(arr1);</span><br><span class="line"><span class="keyword">const</span> s2 = <span class="keyword">new</span> <span class="built_in">Set</span>(arr2);</span><br><span class="line"><span class="comment">// 方法1</span></span><br><span class="line"><span class="comment">// [...s1].filter(item =&gt; &#123;</span></span><br><span class="line"><span class="comment">//     return s2.has(item);</span></span><br><span class="line"><span class="comment">// &#125;)</span></span><br><span class="line"><span class="comment">// 方法2</span></span><br><span class="line"><span class="comment">// [...s1].filter(item =&gt; &#123;</span></span><br><span class="line"><span class="comment">//     return arr2.indexOf(item) &gt;= 0</span></span><br><span class="line"><span class="comment">// &#125;)</span></span><br><span class="line"><span class="comment">// 方法3</span></span><br><span class="line"><span class="comment">// const cross = [...new Set(arr1)].filter(item =&gt; arr2.indexOf(item) &gt;= 0);</span></span><br><span class="line"><span class="comment">// console.log(&quot;交集&quot;, cross)</span></span><br></pre></td></tr></table></figure>

<p>差集</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// console.log(&quot;差集&quot;, [...new Set([...arr1, ...arr2])].filter(item =&gt; arr1.indexOf(item) &gt;= 0 &amp;&amp; arr2.indexOf(item) &lt; 0 || arr2.indexOf(item) &gt;= 0 &amp;&amp; arr1.indexOf(item) &lt; 0))</span></span><br><span class="line"><span class="built_in">console</span>.log(</span><br><span class="line">  <span class="string">&quot;差集&quot;</span>,</span><br><span class="line">  [...new <span class="built_in">Set</span>([...arr1, ...arr2])].filter(<span class="function">(<span class="params">item</span>) =&gt;</span> cross.indexOf(item) &lt; <span class="number">0</span>)</span><br><span class="line">); <span class="comment">//交集里面没有的</span></span><br></pre></td></tr></table></figure>

<h2 id="11-3-扩展-手写-set"><a href="#11-3-扩展-手写-set" class="headerlink" title="11-3. [扩展]手写 set"></a>11-3. [扩展]手写 set</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MySet</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">iterator = []</span>)</span> &#123;</span><br><span class="line">    <span class="comment">//不传默认空数组</span></span><br><span class="line">    <span class="comment">//验证是否是可迭代的对象</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> iterator[<span class="built_in">Symbol</span>.iterator] !== <span class="string">&quot;function&quot;</span>) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">TypeError</span>(<span class="string">`你提供的<span class="subst">$&#123;iterator&#125;</span>不是一个可迭代的对象`</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">this</span>._datas = [];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> item <span class="keyword">of</span> iterator) &#123;</span><br><span class="line">      <span class="built_in">this</span>.add(item);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">get</span> <span class="title">size</span>() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>._datas.length;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">add</span>(<span class="params">data</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="built_in">this</span>.has(data)) &#123;</span><br><span class="line">      <span class="comment">// 不包含data,才加入</span></span><br><span class="line">      <span class="built_in">this</span>._datas.push(data);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">has</span>(<span class="params">data</span>)</span> &#123;</span><br><span class="line">    <span class="comment">// 是否有data</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> item <span class="keyword">of</span> <span class="built_in">this</span>._datas) &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="built_in">this</span>.isEqual(data, item)) &#123;</span><br><span class="line">        <span class="comment">// isEqual判断两个数据是否相等</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="title">delete</span>(<span class="params">data</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="built_in">this</span>._datas.length; i++) &#123;</span><br><span class="line">      <span class="keyword">const</span> element = <span class="built_in">this</span>._datas[i];</span><br><span class="line">      <span class="keyword">if</span> (<span class="built_in">this</span>.isEqual(element, data)) &#123;</span><br><span class="line">        <span class="comment">//删除</span></span><br><span class="line">        <span class="built_in">this</span>._datas.splice(i, <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">clear</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>._datas.length = <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  *[<span class="built_in">Symbol</span>.iterator]() &#123;</span><br><span class="line">    <span class="comment">// 遍历效果</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> item <span class="keyword">of</span> <span class="built_in">this</span>._datas) &#123;</span><br><span class="line">      <span class="keyword">yield</span> item;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="title">forEach</span>(<span class="params">callback</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> item <span class="keyword">of</span> <span class="built_in">this</span>._datas) &#123;</span><br><span class="line">      callback(item, item, <span class="built_in">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 判断两个数据是否相等</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;*&#125;</span> <span class="variable">data1</span></span></span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;*&#125;</span> <span class="variable">data2</span></span></span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="title">isEqual</span>(<span class="params">data1, data2</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (data1 === <span class="number">0</span> &amp;&amp; data2 === <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Object</span>.is(data1, data2);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">  <span class="keyword">const</span> s = <span class="keyword">new</span> MySet([<span class="number">35</span>, <span class="number">6</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">7</span>, <span class="number">35</span>]);</span></span><br><span class="line"><span class="javascript">  s.add(<span class="number">66</span>);</span></span><br><span class="line"><span class="javascript">  s.add(<span class="number">7</span>);</span></span><br><span class="line"><span class="javascript">  s.delete(<span class="number">6</span>);</span></span><br><span class="line"><span class="javascript">  <span class="comment">// for (const item of s) &#123;</span></span></span><br><span class="line"><span class="javascript">  <span class="comment">//     console.log(item)</span></span></span><br><span class="line"><span class="javascript">  <span class="comment">// &#125;</span></span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">  s.forEach(<span class="function">(<span class="params">a1, a2, a3</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">    <span class="built_in">console</span>.log(a1, a2, a3);</span></span><br><span class="line"><span class="javascript">  &#125;);</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="11-4-map-集合"><a href="#11-4-map-集合" class="headerlink" title="11-4. map 集合"></a>11-4. map 集合</h2><p>键值对（key value pair）数据集合的特点：键不可重复<br>map 集合专门用于存储多个键值对数据。<br>在 map 出现之前，我们使用的是对象的方式来存储键值对，键是属性名，值是属性值。<br>使用对象存储有以下问题：</p>
<ol>
<li>键名只能是字符串（或符号）</li>
<li>获取数据的数量不方便</li>
<li>键名容易跟原型上的名称冲突</li>
<li>如何创建 map</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="built_in">Map</span>(); <span class="comment">//创建一个空的map</span></span><br><span class="line"><span class="keyword">new</span> <span class="built_in">Map</span>(iterable); <span class="comment">//创建一个具有初始内容的map，初始内容来自于可迭代对象每一次迭代的结果，但是，它要求每一次迭代的结果必须是一个长度为2的数组，数组第一项表示键，数组的第二项表示值</span></span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> mp1 = <span class="keyword">new</span> <span class="built_in">Map</span>([</span><br><span class="line">  [<span class="string">&quot;a&quot;</span>, <span class="number">3</span>],</span><br><span class="line">  [<span class="string">&quot;b&quot;</span>, <span class="number">4</span>],</span><br><span class="line">  [<span class="string">&quot;c&quot;</span>, <span class="number">5</span>],</span><br><span class="line">]);</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>如何进行后续操作</li>
</ol>
<ul>
<li>size：只读属性，获取当前 map 中键的数量</li>
<li>set(键, 值)：设置一个键值对，键和值可以是任何类型<ul>
<li>如果键不存在，则添加一项</li>
<li>如果键已存在，则修改它的值,覆盖</li>
<li>比较键的方式和 set 相同</li>
</ul>
</li>
<li>get(键): 根据一个键得到对应的值</li>
<li>has(键)：判断某个键是否存在</li>
<li>delete(键)：删除指定的键</li>
<li>clear(): 清空 map</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> mp1 = <span class="keyword">new</span> <span class="built_in">Map</span>([</span><br><span class="line">  [<span class="string">&quot;a&quot;</span>, <span class="number">3</span>],</span><br><span class="line">  [<span class="string">&quot;b&quot;</span>, <span class="number">4</span>],</span><br><span class="line">  [<span class="string">&quot;c&quot;</span>, <span class="number">5</span>],</span><br><span class="line">]);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;总数：&quot;</span>, mp1.size);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;get(&#x27;a&#x27;)&quot;</span>, mp1.get(<span class="string">&quot;a&quot;</span>));</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;has(&#x27;a&#x27;)&quot;</span>, mp1.has(<span class="string">&quot;a&quot;</span>));</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">这是两个，因为对象-地址</span><br><span class="line">mp1.set(&#123;&#125;, <span class="number">232</span>);</span><br><span class="line">mp1.set(&#123;&#125;, <span class="number">111</span>);</span><br><span class="line">要想是一个</span><br><span class="line"><span class="keyword">var</span> obj = &#123;&#125;</span><br><span class="line">mp1.set(obj, <span class="number">6456</span>);</span><br><span class="line">mp1.set(obj, <span class="number">111</span>);</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>和数组互相转换</li>
</ol>
<p>和 set 一样</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> mp = <span class="keyword">new</span> <span class="built_in">Map</span>([</span><br><span class="line">  [<span class="string">&quot;a&quot;</span>, <span class="number">3</span>],</span><br><span class="line">  [<span class="string">&quot;c&quot;</span>, <span class="number">10</span>],</span><br><span class="line">  [<span class="string">&quot;b&quot;</span>, <span class="number">4</span>],</span><br><span class="line">  [<span class="string">&quot;c&quot;</span>, <span class="number">5</span>],</span><br><span class="line">]);</span><br><span class="line"><span class="keyword">const</span> result = [...mp];</span><br><span class="line"><span class="built_in">console</span>.log(result);</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>遍历</li>
</ol>
<ul>
<li>for-of，每次迭代得到的是一个长度为 2 的数组</li>
<li>forEach，通过回调函数遍历<ul>
<li>参数 1：每一项的值</li>
<li>参数 2：每一项的键</li>
<li>参数 3：map 本身</li>
</ul>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// for (const [key, value] of mp) &#123;</span></span><br><span class="line"><span class="comment">//     console.log(key, value)</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line">mp.forEach(<span class="function">(<span class="params">value, key, mp</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(value, key, mp);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="11-5-扩展-手写-map"><a href="#11-5-扩展-手写-map" class="headerlink" title="11-5. [扩展]手写 map"></a>11-5. [扩展]手写 map</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyMap</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">iterable = []</span>)</span> &#123;</span><br><span class="line">    <span class="comment">//验证是否是可迭代的对象</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> iterable[<span class="built_in">Symbol</span>.iterator] !== <span class="string">&quot;function&quot;</span>) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">TypeError</span>(<span class="string">`你提供的<span class="subst">$&#123;iterable&#125;</span>不是一个可迭代的对象`</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">this</span>._datas = [];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> item <span class="keyword">of</span> iterable) &#123;</span><br><span class="line">      <span class="comment">// item 也得是一个可迭代对象</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">typeof</span> item[<span class="built_in">Symbol</span>.iterator] !== <span class="string">&quot;function&quot;</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">TypeError</span>(<span class="string">`你提供的<span class="subst">$&#123;item&#125;</span>不是一个可迭代的对象`</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">const</span> iterator = item[<span class="built_in">Symbol</span>.iterator]();</span><br><span class="line">      <span class="comment">//不一定是数组，所以用这种方式</span></span><br><span class="line">      <span class="keyword">const</span> key = iterator.next().value;</span><br><span class="line">      <span class="keyword">const</span> value = iterator.next().value;</span><br><span class="line">      <span class="built_in">this</span>.set(key, value);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">set</span>(<span class="params">key, value</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> obj = <span class="built_in">this</span>._getObj(key);</span><br><span class="line">    <span class="keyword">if</span> (obj) &#123;</span><br><span class="line">      <span class="comment">//已经有了就是要修改</span></span><br><span class="line">      <span class="comment">//修改</span></span><br><span class="line">      obj.value = value;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">//没有的话添加</span></span><br><span class="line">      <span class="built_in">this</span>._datas.push(&#123;</span><br><span class="line">        key,</span><br><span class="line">        value,</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">get</span>(<span class="params">key</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> item = <span class="built_in">this</span>._getObj(key);</span><br><span class="line">    <span class="keyword">if</span> (item) &#123;</span><br><span class="line">      <span class="keyword">return</span> item.value;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">undefined</span>; <span class="comment">// 找不到</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">get</span> <span class="title">size</span>() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>._datas.length;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">delete</span>(<span class="params">key</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="built_in">this</span>._datas.length; i++) &#123;</span><br><span class="line">      <span class="keyword">const</span> element = <span class="built_in">this</span>._datas[i];</span><br><span class="line">      <span class="keyword">if</span> (<span class="built_in">this</span>.isEqual(element.key, key)) &#123;</span><br><span class="line">        <span class="built_in">this</span>._datas.splice(i, <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">clear</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>._datas.length = <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 根据key值从内部数组中，找到对应的数组项</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;*&#125;</span> <span class="variable">key</span></span></span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="title">_getObj</span>(<span class="params">key</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> item <span class="keyword">of</span> <span class="built_in">this</span>._datas) &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="built_in">this</span>.isEqual(item.key, key)) &#123;</span><br><span class="line">        <span class="keyword">return</span> item;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">has</span>(<span class="params">key</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>._getObj(key) !== <span class="literal">undefined</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 判断两个数据是否相等</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;*&#125;</span> <span class="variable">data1</span></span></span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;*&#125;</span> <span class="variable">data2</span></span></span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="title">isEqual</span>(<span class="params">data1, data2</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (data1 === <span class="number">0</span> &amp;&amp; data2 === <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Object</span>.is(data1, data2);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  *[<span class="built_in">Symbol</span>.iterator]() &#123;</span><br><span class="line">    <span class="comment">//迭代器创建函数本身就是生成器函数  *</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> item <span class="keyword">of</span> <span class="built_in">this</span>._datas) &#123;</span><br><span class="line">      <span class="keyword">yield</span> [item.key, item.value];</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">forEach</span>(<span class="params">callback</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> item <span class="keyword">of</span> <span class="built_in">this</span>._datas) &#123;</span><br><span class="line">      callback(item.value, item.key, <span class="built_in">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">  <span class="keyword">const</span> mp1 = <span class="keyword">new</span> MyMap([</span></span><br><span class="line"><span class="javascript">    [<span class="string">&quot;a&quot;</span>, <span class="number">3</span>],</span></span><br><span class="line"><span class="javascript">    [<span class="string">&quot;b&quot;</span>, <span class="number">4</span>],</span></span><br><span class="line"><span class="javascript">    [<span class="string">&quot;c&quot;</span>, <span class="number">5</span>],</span></span><br><span class="line"><span class="javascript">  ]);</span></span><br><span class="line"><span class="javascript">  <span class="keyword">const</span> obj = &#123;&#125;;</span></span><br><span class="line"><span class="javascript">  mp1.set(obj, <span class="number">6456</span>);</span></span><br><span class="line"><span class="javascript">  mp1.set(<span class="string">&quot;a&quot;</span>, <span class="string">&quot;abc&quot;</span>);</span></span><br><span class="line"><span class="javascript">  mp1.set(obj, <span class="number">111</span>);</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">  <span class="comment">// for (const item of mp1) &#123;</span></span></span><br><span class="line"><span class="javascript">  <span class="comment">//     console.log(item)</span></span></span><br><span class="line"><span class="javascript">  <span class="comment">// &#125;</span></span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">  <span class="comment">// const result = [...mp1];</span></span></span><br><span class="line"><span class="javascript">  <span class="comment">// console.log(result)</span></span></span><br><span class="line"><span class="javascript">  mp1.forEach(<span class="function">(<span class="params">a1, a2, a3</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">    <span class="built_in">console</span>.log(a1, a2, a3);</span></span><br><span class="line"><span class="javascript">  &#125;);</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="11-6-扩展-WeakSet-和-WeakMap"><a href="#11-6-扩展-WeakSet-和-WeakMap" class="headerlink" title="11-6. [扩展]WeakSet 和 WeakMap"></a>11-6. [扩展]WeakSet 和 WeakMap</h2><h3 id="WeakSet"><a href="#WeakSet" class="headerlink" title="WeakSet"></a>WeakSet</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> obj = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;yj&quot;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="number">18</span>,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> set = <span class="keyword">new</span> <span class="built_in">Set</span>();</span><br><span class="line">set.add(obj);</span><br><span class="line">obj = <span class="literal">null</span>; <span class="comment">//请问此时set里面的对象还在吗？？在。</span></span><br><span class="line"><span class="built_in">console</span>.log(obj);</span><br></pre></td></tr></table></figure>

<p>JS 垃圾回收</p>
<p>使用该集合，可以实现和 set 一样的功能，不同的是：</p>
<ol>
<li><strong>它内部存储的对象地址不会影响垃圾回收</strong></li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> obj = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;yj&quot;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="number">18</span>,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> set = <span class="keyword">new</span> <span class="built_in">WeakSet</span>();</span><br><span class="line">set.add(obj);</span><br><span class="line">obj = <span class="literal">null</span>;</span><br><span class="line"><span class="built_in">console</span>.log(set);</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>只能添加对象</li>
<li>不能遍历（不是可迭代的对象）、没有 size 属性、没有 forEach 方法</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> obj = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;yj&quot;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="number">18</span>,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">let</span> obj2 = obj;</span><br><span class="line"><span class="keyword">const</span> set = <span class="keyword">new</span> <span class="built_in">WeakSet</span>();</span><br><span class="line">set.add(obj);</span><br><span class="line"></span><br><span class="line">obj = <span class="literal">null</span>;</span><br><span class="line"><span class="comment">//obj2 = null;</span></span><br><span class="line"><span class="built_in">console</span>.log(set);</span><br></pre></td></tr></table></figure>

<h3 id="WeakMap"><a href="#WeakMap" class="headerlink" title="WeakMap"></a>WeakMap</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- &#123; id:&quot;1&quot;, name:&quot;姓名1&quot; &#125; --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span>1<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- &#123; id:&quot;2&quot;, name:&quot;姓名2&quot; &#125; --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span>2<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- &#123; id:&quot;3&quot;, name:&quot;姓名3&quot; &#125; --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span>3<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">  <span class="keyword">const</span> wmap = <span class="keyword">new</span> <span class="built_in">WeakMap</span>();</span></span><br><span class="line"><span class="javascript">  <span class="keyword">let</span> lis = <span class="built_in">document</span>.querySelectorAll(<span class="string">&quot;li&quot;</span>);</span></span><br><span class="line"><span class="javascript">  <span class="keyword">for</span> (<span class="keyword">const</span> li <span class="keyword">of</span> lis) &#123;</span></span><br><span class="line"><span class="javascript">    wmap.set(li, &#123;</span></span><br><span class="line"><span class="javascript">      <span class="attr">id</span>: li.innerHTML,</span></span><br><span class="line"><span class="javascript">      <span class="attr">name</span>: <span class="string">`姓名<span class="subst">$&#123;li.innerHTML&#125;</span>`</span>,</span></span><br><span class="line"><span class="javascript">    &#125;);</span></span><br><span class="line"><span class="javascript">  &#125;</span></span><br><span class="line"><span class="javascript">  lis[<span class="number">0</span>].remove();</span></span><br><span class="line"><span class="javascript">  lis = <span class="literal">null</span>;</span></span><br><span class="line"><span class="javascript">  <span class="built_in">console</span>.log(wmap);</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>类似于 map 的集合，不同的是：</p>
<ol>
<li><strong>它的键存储的地址不会影响垃圾回收</strong></li>
<li>它的键只能是对象</li>
<li>不能遍历（不是可迭代的对象）、没有 size 属性、没有 forEach 方法</li>
</ol>
<h1 id="12-代理与反射"><a href="#12-代理与反射" class="headerlink" title="12. 代理与反射"></a>12. 代理与反射</h1><h2 id="12-1-回顾-属性描述符"><a href="#12-1-回顾-属性描述符" class="headerlink" title="12-1. [回顾]属性描述符"></a>12-1. [回顾]属性描述符</h2><h3 id="属性描述符"><a href="#属性描述符" class="headerlink" title="属性描述符"></a>属性描述符</h3><p>Property Descriptor 属性描述符 是一个普通对象，用于描述一个属性的相关信息<br>通过<code>Object.getOwnPropertyDescriptor(对象, 属性名)</code>可以得到一个对象的某个属性的属性描述符</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> desc = <span class="built_in">Object</span>.getOwnPropertyDescriptor(obj, <span class="string">&quot;a&quot;</span>);</span><br><span class="line"><span class="built_in">console</span>.log(desc);</span><br></pre></td></tr></table></figure>

<ul>
<li>value：属性值</li>
<li>configurable：该属性的描述符是否可以修改</li>
<li>enumerable：该属性是否可以被枚举</li>
<li>writable：该属性是否可以被重新赋值<blockquote>
<p><code>Object.getOwnPropertyDescriptors(对象)</code>可以得到某个对象的所有属性描述符</p>
</blockquote>
</li>
</ul>
<p>如果需要为某个对象添加属性时 或 修改属性时， 配置其属性描述符，可以使用下面的代码:<br>Object.defineProperty(对象, 属性名, 描述符);</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">  <span class="attr">a</span>: <span class="number">1</span>,</span><br><span class="line">  <span class="attr">b</span>: <span class="number">2</span>,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">Object</span>.defineProperty(obj, <span class="string">&quot;a&quot;</span>, &#123;</span><br><span class="line">  <span class="attr">value</span>: <span class="number">3</span>,</span><br><span class="line">  <span class="attr">configurable</span>: <span class="literal">false</span>, <span class="comment">//描述符不可以修改</span></span><br><span class="line">  <span class="attr">enumerable</span>: <span class="literal">false</span>, <span class="comment">//不可枚举</span></span><br><span class="line">  <span class="attr">writable</span>: <span class="literal">false</span>, <span class="comment">//不可写</span></span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">console</span>.log(obj);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> prop <span class="keyword">in</span> obj) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(prop); <span class="comment">//只有b,没有a了</span></span><br><span class="line">&#125;</span><br><span class="line">obj.a = <span class="number">10</span>; <span class="comment">//不可写</span></span><br><span class="line"><span class="built_in">console</span>.log(obj);</span><br><span class="line"><span class="keyword">const</span> props = <span class="built_in">Object</span>.keys(obj); <span class="comment">//得到对象的所有属性</span></span><br><span class="line"><span class="built_in">console</span>.log(props);</span><br><span class="line"><span class="keyword">const</span> values = <span class="built_in">Object</span>.values(obj); <span class="comment">//得到对象的所有值</span></span><br><span class="line"><span class="built_in">console</span>.log(values);</span><br></pre></td></tr></table></figure>

<p>Object.defineProperties(对象, 多个属性的描述符)</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Object</span>.defineProperties(obj, &#123;</span><br><span class="line">  <span class="attr">a</span>: &#123;</span><br><span class="line">    <span class="attr">value</span>: <span class="number">3</span>,</span><br><span class="line">    <span class="attr">configurable</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">enumerable</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">writable</span>: <span class="literal">false</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="存取器属性"><a href="#存取器属性" class="headerlink" title="存取器属性"></a>存取器属性</h3><p>属性描述符中，如果配置了 get 和 set 中的任何一个，则该属性，不再是一个普通属性，而变成了存取器属性。<br>get 和 set 配置均为函数，如果一个属性是存取器属性，则读取该属性时，会运行 get 方法，将 get 方法得到的返回值作为属性值；如果给该属性赋值，则会运行 set 方法。<br>属性已经不再内存里面了，而是 get 和 set</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">  <span class="attr">b</span>: <span class="number">2</span>,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">Object</span>.defineProperty(obj, <span class="string">&quot;a&quot;</span>, &#123;</span><br><span class="line">  <span class="function"><span class="title">get</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;运行了属性a的get函数&quot;</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function"><span class="title">set</span>(<span class="params">val</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;运行了属性a的set函数&quot;</span>, val);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// obj.a的时候运行get函数</span></span><br><span class="line"><span class="comment">// obj.a赋值的时候运行set函数</span></span><br><span class="line"><span class="comment">// 所以console.log(obj.a)//undefined,因为get函数没有返回结果</span></span><br><span class="line">obj.a = <span class="number">1</span>; <span class="comment">//相当于set(20)</span></span><br><span class="line"><span class="built_in">console</span>.log(obj.a); <span class="comment">// 相当于console.log(get())</span></span><br><span class="line">运行set;</span><br><span class="line">运行get;</span><br><span class="line"><span class="literal">undefined</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 演示1</span></span><br><span class="line"><span class="comment">// obj.a = 20 + 10; // set(20 + 10) 相当于运行set()</span></span><br><span class="line"><span class="comment">// console.log(obj.a); // console.log(get()) 读取属性a，相当于运行get()</span></span><br><span class="line"><span class="comment">// 演示2</span></span><br><span class="line"><span class="comment">// obj.a = obj.a + 1; // set(obj.a + 1) 相当于读取 set(get() + 1)  undefined+1=NaN</span></span><br><span class="line"><span class="comment">// console.log(obj.a);//读取属性一定运行get  undefined</span></span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">  <span class="attr">b</span>: <span class="number">2</span>,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">Object</span>.defineProperty(obj, <span class="string">&quot;a&quot;</span>, &#123;</span><br><span class="line">  <span class="function"><span class="title">get</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;运行了属性a的get函数&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> obj._a;</span><br><span class="line">    <span class="comment">// 错误的思路：return obj.a</span></span><br><span class="line">    <span class="comment">// 这里就成了无限递归，无限读取，导致浏览器卡死，同理set</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function"><span class="title">set</span>(<span class="params">val</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;运行了属性a的set函数&quot;</span>, val);</span><br><span class="line">    obj._a = val;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br><span class="line">obj.a = <span class="number">10</span>;</span><br><span class="line"><span class="built_in">console</span>.log(obj.a);</span><br></pre></td></tr></table></figure>

<p>存取器属性最大的意义，在于可以控制属性的读取和赋值</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">obj = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;adsf&quot;</span>,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">Object</span>.defineProperty(obj, <span class="string">&quot;age&quot;</span>, &#123;</span><br><span class="line">  <span class="function"><span class="title">get</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> obj._age;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function"><span class="title">set</span>(<span class="params">val</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> val !== <span class="string">&quot;number&quot;</span>) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">TypeError</span>(<span class="string">&quot;年龄必须是一个数字&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (val &lt; <span class="number">0</span>) &#123;</span><br><span class="line">      val = <span class="number">0</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (val &gt; <span class="number">200</span>) &#123;</span><br><span class="line">      val = <span class="number">200</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    obj._age = val;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br><span class="line">obj.age = <span class="string">&quot;Asdfasasdf&quot;</span>;</span><br><span class="line"><span class="built_in">console</span>.log(obj.age);</span><br></pre></td></tr></table></figure>

<p>应用：将对象的属性和元素关联</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;ie=edge&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">span</span>&gt;</span>姓名：<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">span</span> <span class="attr">id</span>=<span class="string">&quot;name&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">span</span>&gt;</span>年龄：<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">span</span> <span class="attr">id</span>=<span class="string">&quot;age&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">      <span class="keyword">const</span> spanName = <span class="built_in">document</span>.getElementById(<span class="string">&quot;name&quot;</span>);</span></span><br><span class="line"><span class="javascript">      <span class="keyword">const</span> spanAge = <span class="built_in">document</span>.getElementById(<span class="string">&quot;age&quot;</span>);</span></span><br><span class="line"><span class="javascript">      <span class="keyword">const</span> user = &#123;&#125;;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">Object</span>.defineProperties(user, &#123;</span></span><br><span class="line"><span class="javascript">        <span class="attr">name</span>: &#123;</span></span><br><span class="line"><span class="javascript">          <span class="function"><span class="title">get</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">return</span> spanName.innerText;</span></span><br><span class="line"><span class="javascript">            <span class="comment">//获取页面窗口中对应的元素内容</span></span></span><br><span class="line"><span class="javascript">          &#125;,</span></span><br><span class="line"><span class="javascript">          <span class="function"><span class="title">set</span>(<span class="params">val</span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">            spanName.innerText = val;</span></span><br><span class="line"><span class="javascript">          &#125;,</span></span><br><span class="line"><span class="javascript">        &#125;,</span></span><br><span class="line"><span class="javascript">        <span class="attr">age</span>: &#123;</span></span><br><span class="line"><span class="javascript">          <span class="function"><span class="title">get</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">return</span> +spanAge.innerText;</span></span><br><span class="line"><span class="javascript">          &#125;,</span></span><br><span class="line"><span class="javascript">          <span class="function"><span class="title">set</span>(<span class="params">val</span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">if</span> (<span class="keyword">typeof</span> val !== <span class="string">&quot;number&quot;</span>) &#123;</span></span><br><span class="line"><span class="javascript">              <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">TypeError</span>(<span class="string">&quot;年龄必须是一个数字&quot;</span>);</span></span><br><span class="line"><span class="javascript">            &#125;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">if</span> (val &lt; <span class="number">0</span>) &#123;</span></span><br><span class="line"><span class="javascript">              val = <span class="number">0</span>;</span></span><br><span class="line"><span class="javascript">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (val &gt; <span class="number">200</span>) &#123;</span></span><br><span class="line"><span class="javascript">              val = <span class="number">200</span>;</span></span><br><span class="line"><span class="javascript">            &#125;</span></span><br><span class="line"><span class="javascript">            spanAge.innerText = val;</span></span><br><span class="line"><span class="javascript">          &#125;,</span></span><br><span class="line"><span class="javascript">        &#125;,</span></span><br><span class="line"><span class="javascript">      &#125;);</span></span><br><span class="line"><span class="javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="12-2-Reflect"><a href="#12-2-Reflect" class="headerlink" title="12-2. Reflect"></a>12-2. Reflect</h2><ol>
<li>Reflect 是什么？</li>
</ol>
<p>Reflect 是一个内置的 JS 对象，它提供了一系列方法，可以让开发者通过调用这些方法，访问一些 JS 底层功能<br>由于它类似于其他语言的<strong>反射</strong>，因此取名为 Reflect</p>
<ol start="2">
<li>它可以做什么？</li>
</ol>
<p>使用 Reflect 可以实现诸如 属性的赋值与取值、调用普通函数、调用构造函数、判断属性是否存在与对象中   等等功能</p>
<ol start="3">
<li>这些功能不是已经存在了吗？为什么还需要用 Reflect 实现一次？</li>
</ol>
<p>有一个重要的理念，在 ES5 就被提出：减少魔法、让代码更加纯粹<br>这种理念很大程度上是受到函数式编程的影响<br>ES6 进一步贯彻了这种理念，它认为，对属性内存的控制、原型链的修改、函数的调用等等，这些都属于底层实现，属于一种魔法，因此，需要将它们提取出来，形成一个正常的 API，并高度聚合到某个对象中，于是，就造就了 Reflect 对象<br>因此，你可以看到 Reflect 对象中有很多的 API 都可以使用过去的某种语法或其他 API 实现。</p>
<ol start="4">
<li>它里面到底提供了哪些 API 呢？</li>
</ol>
<ul>
<li>Reflect.set(target, propertyKey, value): 设置对象 target 的属性 propertyKey 的值为 value，等同于给对象的属性赋值</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">  <span class="attr">a</span>: <span class="number">1</span>,</span><br><span class="line">  <span class="attr">b</span>: <span class="number">2</span>,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// obj.a = 10;</span></span><br><span class="line"><span class="built_in">Reflect</span>.set(obj, <span class="string">&quot;a&quot;</span>, <span class="number">10</span>); <span class="comment">//给obj的a赋值为10</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Reflect</span>.get(obj, <span class="string">&quot;a&quot;</span>));</span><br></pre></td></tr></table></figure>

<ul>
<li>Reflect.get(target, propertyKey): 读取对象 target 的属性 propertyKey，等同于读取对象的属性值</li>
<li>Reflect.apply(target, thisArgument, argumentsList)：调用一个指定的函数，并绑定 this 和参数列表。等同于函数调用</li>
<li>Reflect.deleteProperty(target, propertyKey)：删除一个对象的属性</li>
<li>Reflect.defineProperty(target, propertyKey, attributes)：类似于 Object.defineProperty，不同的是如果配置出现问题，返回 false 而不是报错</li>
<li>Reflect.construct(target, argumentsList)：用构造函数的方式创建一个对象</li>
<li>Reflect.has(target, propertyKey): 判断一个对象是否拥有一个属性</li>
<li>其他 API：<a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Reflect">https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Reflect</a></li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// function method(a, b)&#123;</span></span><br><span class="line"><span class="comment">//     console.log(&quot;method&quot;, a, b);</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">// // method(3, 4);</span></span><br><span class="line"><span class="comment">// Reflect.apply(method, null, [3, 4])</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// const obj = &#123;</span></span><br><span class="line"><span class="comment">//     a: 1,</span></span><br><span class="line"><span class="comment">//     b: 2</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">// // delete obj.a;</span></span><br><span class="line"><span class="comment">// Reflect.deleteProperty(obj, &quot;a&quot;);</span></span><br><span class="line"><span class="comment">// console.log(obj);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// function Test(a, b) &#123;</span></span><br><span class="line"><span class="comment">//     this.a = a;</span></span><br><span class="line"><span class="comment">//     this.b = b;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// // const t = new Test(1, 3);</span></span><br><span class="line"><span class="comment">// const t = Reflect.construct(Test, [1, 3]);</span></span><br><span class="line"><span class="comment">// console.log(t)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">  <span class="attr">a</span>: <span class="number">1</span>,</span><br><span class="line">  <span class="attr">b</span>: <span class="number">2</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// console.log(&quot;a&quot; in obj);</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Reflect</span>.has(obj, <span class="string">&quot;a&quot;</span>));</span><br></pre></td></tr></table></figure>

<h2 id="12-3-Proxy"><a href="#12-3-Proxy" class="headerlink" title="12-3. Proxy"></a>12-3. Proxy</h2><h3 id="Proxy-代理"><a href="#Proxy-代理" class="headerlink" title="Proxy 代理"></a>Proxy 代理</h3><p>代理：提供了修改底层实现的方式</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//代理一个目标对象</span></span><br><span class="line"><span class="comment">//target：目标对象</span></span><br><span class="line"><span class="comment">//handler：是一个普通对象，其中可以重写底层实现(可以重写反射里面所有的api)</span></span><br><span class="line"><span class="comment">//返回一个代理对象</span></span><br><span class="line"><span class="keyword">new</span> <span class="built_in">Proxy</span>(target, handler);</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">  <span class="attr">a</span>: <span class="number">1</span>,</span><br><span class="line">  <span class="attr">b</span>: <span class="number">2</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> proxy = <span class="keyword">new</span> <span class="built_in">Proxy</span>(obj, &#123;</span><br><span class="line">  <span class="function"><span class="title">set</span>(<span class="params">target, propertyKey, value</span>)</span> &#123;</span><br><span class="line">    <span class="comment">// console.log(target, propertyKey, value);</span></span><br><span class="line">    <span class="comment">// target[propertyKey] = value;修改属性的值。重写了底层实现</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 等价于</span></span><br><span class="line">    <span class="built_in">Reflect</span>.set(target, propertyKey, value);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function"><span class="title">get</span>(<span class="params">target, propertyKey</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">Reflect</span>.has(target, propertyKey)) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">Reflect</span>.get(target, propertyKey);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function"><span class="title">has</span>(<span class="params">target, propertyKey</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>; <span class="comment">//代理说没有就没有</span></span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// console.log(proxy);</span></span><br><span class="line"><span class="comment">// proxy.a = 10;</span></span><br><span class="line"><span class="comment">// console.log(proxy.a);</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(proxy.d); <span class="comment">//运行get</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;a&quot;</span> <span class="keyword">in</span> proxy);</span><br></pre></td></tr></table></figure>

<h2 id="12-4-应用-观察者模式"><a href="#12-4-应用-观察者模式" class="headerlink" title="12-4. 应用-观察者模式"></a>12-4. 应用-观察者模式</h2><p>有一个对象，是观察者，它用于观察另外一个对象的属性值变化，当属性值变化后会收到一个通知，可能会做一些事。<br>​</p>
<blockquote>
<p>vue2</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;container&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">  <span class="comment">//创建一个观察者</span></span></span><br><span class="line"><span class="javascript">  <span class="function"><span class="keyword">function</span> <span class="title">observer</span>(<span class="params">target</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">    <span class="comment">//通过观察目标元素的变化，把这些属性渲染到页面上</span></span></span><br><span class="line"><span class="javascript">    <span class="keyword">const</span> div = <span class="built_in">document</span>.getElementById(<span class="string">&quot;container&quot;</span>);</span></span><br><span class="line"><span class="javascript">    <span class="keyword">const</span> ob = &#123;&#125;;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">const</span> props = <span class="built_in">Object</span>.keys(target); <span class="comment">// 拿到所有属性名</span></span></span><br><span class="line"><span class="javascript">    <span class="keyword">for</span> (<span class="keyword">const</span> prop <span class="keyword">of</span> props) &#123;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">Object</span>.defineProperty(ob, prop, &#123;</span></span><br><span class="line"><span class="javascript">        <span class="function"><span class="title">get</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">          <span class="comment">// 获取的时候</span></span></span><br><span class="line"><span class="javascript">          <span class="keyword">return</span> target[prop];</span></span><br><span class="line"><span class="javascript">        &#125;,</span></span><br><span class="line"><span class="javascript">        <span class="function"><span class="title">set</span>(<span class="params">val</span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">          <span class="comment">// 设置的时候</span></span></span><br><span class="line"><span class="javascript">          target[prop] = val;</span></span><br><span class="line"><span class="javascript">          render();</span></span><br><span class="line"><span class="javascript">        &#125;,</span></span><br><span class="line"><span class="javascript">        <span class="attr">enumerable</span>: <span class="literal">true</span>, <span class="comment">//这两个属性默认不能被枚举</span></span></span><br><span class="line"><span class="javascript">      &#125;);</span></span><br><span class="line"><span class="javascript">    &#125;</span></span><br><span class="line"><span class="javascript">    render();</span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">render</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">let</span> html = <span class="string">&quot;&quot;</span>;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">for</span> (<span class="keyword">const</span> prop <span class="keyword">of</span> <span class="built_in">Object</span>.keys(ob)) &#123;</span></span><br><span class="line"><span class="javascript">        <span class="comment">//拼接属性名属性值</span></span></span><br><span class="line"><span class="javascript">        html += <span class="string">`</span></span></span><br><span class="line"><span class="string"><span class="javascript">&lt;p&gt;&lt;span&gt;<span class="subst">$&#123;prop&#125;</span>：&lt;/span&gt;&lt;span&gt;<span class="subst">$&#123;ob[prop]&#125;</span>&lt;/span&gt;&lt;/p&gt;</span></span></span><br><span class="line"><span class="string"><span class="javascript">`</span>;</span></span><br><span class="line"><span class="javascript">      &#125;</span></span><br><span class="line"><span class="javascript">      div.innerHTML = html;</span></span><br><span class="line"><span class="javascript">    &#125;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">return</span> ob;</span></span><br><span class="line"><span class="javascript">  &#125;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">const</span> target = &#123;</span></span><br><span class="line"><span class="javascript">    <span class="attr">a</span>: <span class="number">1</span>,</span></span><br><span class="line"><span class="javascript">    <span class="attr">b</span>: <span class="number">2</span>,</span></span><br><span class="line"><span class="javascript">  &#125;;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">const</span> obj = observer(target);</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>缺陷：搞出来了两个对象，占用了内存，代理不占用内存</p>
<blockquote>
<p>vue3</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;container&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">  <span class="comment">//创建一个观察者</span></span></span><br><span class="line"><span class="javascript">  <span class="function"><span class="keyword">function</span> <span class="title">observer</span>(<span class="params">target</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">const</span> div = <span class="built_in">document</span>.getElementById(<span class="string">&quot;container&quot;</span>);</span></span><br><span class="line"><span class="javascript">    <span class="keyword">const</span> proxy = <span class="keyword">new</span> <span class="built_in">Proxy</span>(target, &#123;</span></span><br><span class="line"><span class="javascript">      <span class="function"><span class="title">set</span>(<span class="params">target, prop, value</span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="comment">// 重写底层实现</span></span></span><br><span class="line"><span class="javascript">        <span class="built_in">Reflect</span>.set(target, prop, value);</span></span><br><span class="line"><span class="javascript">        render();</span></span><br><span class="line"><span class="javascript">      &#125;,</span></span><br><span class="line"><span class="javascript">      <span class="function"><span class="title">get</span>(<span class="params">target, prop</span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">return</span> <span class="built_in">Reflect</span>.get(target, prop);</span></span><br><span class="line"><span class="javascript">      &#125;,</span></span><br><span class="line"><span class="javascript">    &#125;);</span></span><br><span class="line"><span class="javascript">    render();</span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">render</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">let</span> html = <span class="string">&quot;&quot;</span>;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">for</span> (<span class="keyword">const</span> prop <span class="keyword">of</span> <span class="built_in">Object</span>.keys(target)) &#123;</span></span><br><span class="line"><span class="javascript">        html += <span class="string">`</span></span></span><br><span class="line"><span class="string"><span class="javascript">&lt;p&gt;&lt;span&gt;<span class="subst">$&#123;prop&#125;</span>：&lt;/span&gt;&lt;span&gt;<span class="subst">$&#123;target[prop]&#125;</span>&lt;/span&gt;&lt;/p&gt;</span></span></span><br><span class="line"><span class="string"><span class="javascript">`</span>;</span></span><br><span class="line"><span class="javascript">      &#125;</span></span><br><span class="line"><span class="javascript">      div.innerHTML = html;</span></span><br><span class="line"><span class="javascript">    &#125;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">return</span> proxy;</span></span><br><span class="line"><span class="javascript">  &#125;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">const</span> target = &#123;</span></span><br><span class="line"><span class="javascript">    <span class="attr">a</span>: <span class="number">1</span>,</span></span><br><span class="line"><span class="javascript">    <span class="attr">b</span>: <span class="number">2</span>,</span></span><br><span class="line"><span class="javascript">  &#125;;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">const</span> obj = observer(target);</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="12-5-应用-偷懒的构造函数"><a href="#12-5-应用-偷懒的构造函数" class="headerlink" title="12-5. 应用-偷懒的构造函数"></a>12-5. 应用-偷懒的构造函数</h2><p>恶心的类创建</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span>()</span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">firstName, lastName, age</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.firstName = firstName;</span><br><span class="line">    <span class="built_in">this</span>.lastName = lastName;</span><br><span class="line">    <span class="built_in">this</span>.age = age;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>自动赋值</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ConstructorProxy</span>(<span class="params">Class, ...propNames</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Proxy</span>(Class, &#123;</span><br><span class="line">    <span class="function"><span class="title">construct</span>(<span class="params">target, argumentsList</span>)</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> obj = <span class="built_in">Reflect</span>.construct(target, argumentsList);</span><br><span class="line">      propNames.forEach(<span class="function">(<span class="params">name, i</span>) =&gt;</span> &#123;</span><br><span class="line">        obj[name] = argumentsList[i];</span><br><span class="line">      &#125;);</span><br><span class="line">      <span class="keyword">return</span> obj;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> UserProxy = ConstructorProxy(User, <span class="string">&quot;firstName&quot;</span>, <span class="string">&quot;lastName&quot;</span>, <span class="string">&quot;age&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> obj = <span class="keyword">new</span> UserProxy(<span class="string">&quot;袁&quot;</span>, <span class="string">&quot;进&quot;</span>, <span class="number">18</span>);</span><br><span class="line"><span class="built_in">console</span>.log(obj);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Monster</span> </span>&#123;&#125;</span><br><span class="line"><span class="keyword">const</span> MonsterProxy = ConstructorProxy(</span><br><span class="line">  Monster,</span><br><span class="line">  <span class="string">&quot;attack&quot;</span>,</span><br><span class="line">  <span class="string">&quot;defence&quot;</span>,</span><br><span class="line">  <span class="string">&quot;hp&quot;</span>,</span><br><span class="line">  <span class="string">&quot;rate&quot;</span>,</span><br><span class="line">  <span class="string">&quot;name&quot;</span></span><br><span class="line">);</span><br><span class="line"><span class="keyword">const</span> m = <span class="keyword">new</span> MonsterProxy(<span class="number">10</span>, <span class="number">20</span>, <span class="number">100</span>, <span class="number">30</span>, <span class="string">&quot;怪物&quot;</span>);</span><br><span class="line"><span class="built_in">console</span>.log(m);</span><br></pre></td></tr></table></figure>

<h2 id="12-6-应用-可验证的函数参数"><a href="#12-6-应用-可验证的函数参数" class="headerlink" title="12-6. 应用-可验证的函数参数"></a>12-6. 应用-可验证的函数参数</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sum</span>(<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> a + b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">validatorFunction</span>(<span class="params">func, ...types</span>) </span>&#123;</span><br><span class="line">  <span class="comment">//并不占据内存空间，只是个代理</span></span><br><span class="line">  <span class="keyword">const</span> proxy = <span class="keyword">new</span> <span class="built_in">Proxy</span>(func, &#123;</span><br><span class="line">    <span class="function"><span class="title">apply</span>(<span class="params">target, thisArgument, argumentsList</span>)</span> &#123;</span><br><span class="line">      types.forEach(<span class="function">(<span class="params">t, i</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// 进行验证</span></span><br><span class="line">        <span class="keyword">const</span> arg = argumentsList[i];</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> arg !== t) &#123;</span><br><span class="line">          <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">TypeError</span>(</span><br><span class="line">            <span class="string">`第<span class="subst">$&#123;i + <span class="number">1</span>&#125;</span>个参数<span class="subst">$&#123;argumentsList[i]&#125;</span>不满足类型<span class="subst">$&#123;t&#125;</span>`</span></span><br><span class="line">          );</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">Reflect</span>.apply(target, thisArgument, argumentsList);</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">return</span> proxy;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> sumProxy = validatorFunction(sum, <span class="string">&quot;number&quot;</span>, <span class="string">&quot;number&quot;</span>);</span><br><span class="line"><span class="built_in">console</span>.log(sumProxy(<span class="number">1</span>, <span class="number">2</span>));</span><br></pre></td></tr></table></figure>

<p>以前</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sum</span>(<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> a + b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">validatorFunction</span>(<span class="params">func, ...types</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">...argumentsList</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 新的函数占用内存</span></span><br><span class="line">    types.forEach(<span class="function">(<span class="params">t, i</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> arg = argumentsList[i];</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">typeof</span> arg !== t) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">TypeError</span>(</span><br><span class="line">          <span class="string">`第<span class="subst">$&#123;i + <span class="number">1</span>&#125;</span>个参数<span class="subst">$&#123;argumentsList[i]&#125;</span>不满足类型<span class="subst">$&#123;t&#125;</span>`</span></span><br><span class="line">        );</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> func(...argumentsList); <span class="comment">//运行这个函数</span></span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">return</span> proxy;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> sumProxy = validatorFunction(sum, <span class="string">&quot;number&quot;</span>, <span class="string">&quot;number&quot;</span>);</span><br><span class="line"><span class="built_in">console</span>.log(sumProxy(<span class="number">1</span>, <span class="number">2</span>));</span><br></pre></td></tr></table></figure>

<h1 id="13-增强的数组功能"><a href="#13-增强的数组功能" class="headerlink" title="13. 增强的数组功能"></a>13. 增强的数组功能</h1><h2 id="13-1-新增的数组-API"><a href="#13-1-新增的数组-API" class="headerlink" title="13-1. 新增的数组 API"></a>13-1. 新增的数组 API</h2><h3 id="静态方法"><a href="#静态方法" class="headerlink" title="静态方法"></a>静态方法</h3><ul>
<li>Array.of(…args): 使用指定的数组项创建一个新数组</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> arr = <span class="built_in">Array</span>.of(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>);</span><br><span class="line"><span class="keyword">const</span> arr = <span class="keyword">new</span> <span class="built_in">Array</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>);</span><br><span class="line"><span class="comment">// 作用一样为什么要出新的API呢？主要为了解决只有一个参数的时候</span></span><br></pre></td></tr></table></figure>

<ul>
<li>Array.from(arg): 通过给定的类数组 或 可迭代对象 创建一个新的数组。</li>
</ul>
<p>之前类数组转换成数组：Array.prototype.slice.call(divs, 0)</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">  <span class="keyword">const</span> divs = <span class="built_in">document</span>.querySelectorAll(<span class="string">&quot;div&quot;</span>); <span class="comment">// 类数组，原形不是Array，不是Array构造出来的</span></span></span><br><span class="line"><span class="javascript">  <span class="keyword">const</span> result = <span class="built_in">Array</span>.from(divs);</span></span><br><span class="line"><span class="javascript">  <span class="built_in">console</span>.log(result);</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="实例方法"><a href="#实例方法" class="headerlink" title="实例方法"></a>实例方法</h3><ul>
<li>find(callback): 用于查找满足条件的第一个元素</li>
<li>findIndex(callback)：用于查找满足条件的第一个元素的下标</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> arr = [</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;a&quot;</span>,</span><br><span class="line">    <span class="attr">id</span>: <span class="number">1</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;b&quot;</span>,</span><br><span class="line">    <span class="attr">id</span>: <span class="number">2</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;c&quot;</span>,</span><br><span class="line">    <span class="attr">id</span>: <span class="number">3</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;d&quot;</span>,</span><br><span class="line">    <span class="attr">id</span>: <span class="number">4</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;e&quot;</span>,</span><br><span class="line">    <span class="attr">id</span>: <span class="number">5</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;f&quot;</span>,</span><br><span class="line">    <span class="attr">id</span>: <span class="number">6</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;g&quot;</span>,</span><br><span class="line">    <span class="attr">id</span>: <span class="number">7</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="comment">//找到id为5的对象</span></span><br><span class="line"><span class="keyword">const</span> result = arr.find(<span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (item.id === <span class="number">5</span>) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;);</span><br><span class="line">简写;</span><br><span class="line"><span class="keyword">const</span> result = arr.find(<span class="function">(<span class="params">item</span>) =&gt;</span> item.id === <span class="number">5</span>);</span><br><span class="line"><span class="keyword">const</span> resultIndex = arr.findIndex(<span class="function">(<span class="params">item</span>) =&gt;</span> item.id === <span class="number">5</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(result, resultIndex);</span><br></pre></td></tr></table></figure>

<ul>
<li>fill(data)：用指定的数据填充满数组所有的内容</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建了一个长度为100的数组，数组的每一项是&quot;abc&quot;</span></span><br><span class="line"><span class="keyword">const</span> arr = <span class="keyword">new</span> <span class="built_in">Array</span>(<span class="number">100</span>);</span><br><span class="line">arr.fill(<span class="string">&quot;abc&quot;</span>);</span><br></pre></td></tr></table></figure>

<ul>
<li>copyWithin(target, start?, end?): 在数组内部完成复制</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>];</span><br><span class="line"><span class="comment">//从下标2开始，改变数组的数据，数据来自于下标0位置开始</span></span><br><span class="line"><span class="comment">// arr.copyWithin(2); // [1, 2, 1, 2, 3, 4]</span></span><br><span class="line"><span class="comment">// arr.copyWithin(2, 1); // [1, 2, 2, 3, 4, 5]第二个参数：从哪个位置复制数据</span></span><br><span class="line"><span class="comment">// arr.copyWithin(2, 1, 3); // [1, 2, 2, 3, 5, 6]第三个参数在哪个位置复制停止</span></span><br><span class="line"><span class="built_in">console</span>.log(arr);</span><br></pre></td></tr></table></figure>

<ul>
<li>includes(data)：判断数组中是否包含某个值，使用 Object.is 匹配</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> arr = [<span class="number">45</span>, <span class="number">21</span>, <span class="number">356</span>, <span class="number">66</span>, <span class="number">6</span>, <span class="literal">NaN</span>, <span class="number">723</span>, <span class="number">54</span>];</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(arr.indexOf(<span class="number">66</span>) &gt;= <span class="number">0</span>);</span><br><span class="line"><span class="built_in">console</span>.log(arr.includes(<span class="literal">NaN</span>));</span><br></pre></td></tr></table></figure>

<h2 id="13-2-扩展-类型化数组"><a href="#13-2-扩展-类型化数组" class="headerlink" title="13-2. [扩展]类型化数组"></a>13-2. [扩展]类型化数组</h2><h3 id="数字存储的前置知识"><a href="#数字存储的前置知识" class="headerlink" title="数字存储的前置知识"></a>数字存储的前置知识</h3><ol>
<li>计算机必须使用固定的位数来存储数字，无论存储的数字是大是小，在内存中占用的空间是固定的。</li>
<li>n 位的无符号整数能表示的数字是 2^n 个，取值范围是：0 ~ 2^n - 1</li>
<li>n 位的有符号整数能表示的数字是 2n 个，取值范围是：-2(n-1) ~ 2^(n-1) - 1</li>
<li>浮点数表示法可以用于表示整数和小数，目前分为两种标准：<ol>
<li>32 位浮点数：又称为单精度浮点数，它用 1 位表示符号，8 位表示阶码，23 位表示尾数</li>
<li>64 位浮点数：又称为双精度浮点数，它用 1 位表示符号，11 位表示阶码，52 位表示尾数</li>
</ol>
</li>
<li>JS 中的所有数字，均使用双精度浮点数保存</li>
</ol>
<h3 id="类型化数组"><a href="#类型化数组" class="headerlink" title="类型化数组"></a>类型化数组</h3><p>类型化数组：用于优化多个数字的存储<br>具体分为：</p>
<ul>
<li>Int8Array： 8 位有符号整数（-128 ~ 127）</li>
<li>Uint8Array： 8 位无符号整数（0 ~ 255）</li>
<li>Int16Array: …</li>
<li>Uint16Array: …</li>
<li>Int32Array: …</li>
<li>Uint32Array: …</li>
<li>Float32Array:</li>
<li>Float64Array</li>
</ul>
<ol>
<li>如何创建数组</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> 数组构造函数(长度)</span><br><span class="line"></span><br><span class="line">数组构造函数.of(元素...)</span><br><span class="line"></span><br><span class="line">数组构造函数.from(可迭代对象)</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> 数组构造函数(其他类型化数组)</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>得到长度</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">数组.length; <span class="comment">//得到元素数量</span></span><br><span class="line">数组.byteLength; <span class="comment">//得到占用的字节数</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li>其他的用法跟普通数组一致，但是：</li>
</ol>
<ul>
<li>不能增加和删除数据，类型化数组的长度固定</li>
<li>一些返回数组的方法，返回的数组是同类型化的新数组</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// const arr = new Int32Array(10);</span></span><br><span class="line"><span class="keyword">const</span> arr = <span class="built_in">Uint8Array</span>.of(<span class="number">12</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>);</span><br><span class="line"><span class="built_in">console</span>.log(arr);</span><br><span class="line"><span class="comment">// console.log(arr.length);</span></span><br><span class="line"><span class="comment">// console.log(arr.byteLength);</span></span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> arr1 = <span class="built_in">Int32Array</span>.of(<span class="number">35111</span>, <span class="number">7</span>, <span class="number">3</span>, <span class="number">11</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> arr2 = <span class="keyword">new</span> <span class="built_in">Int8Array</span>(arr1);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(arr1 === arr2);</span><br><span class="line"><span class="built_in">console</span>.log(arr1, arr2);</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> arr = <span class="built_in">Int8Array</span>.of(<span class="number">125</span>, <span class="number">7</span>, <span class="number">3</span>, <span class="number">11</span>);</span><br><span class="line"><span class="keyword">const</span> arr2 = arr.map(<span class="function">(<span class="params">item</span>) =&gt;</span> item * <span class="number">2</span>);</span><br><span class="line"><span class="built_in">console</span>.log(arr2);</span><br><span class="line"></span><br><span class="line"><span class="comment">// arr[1] = 100;</span></span><br><span class="line"><span class="comment">// console.log(arr);</span></span><br><span class="line"><span class="comment">// console.log(arr[1])</span></span><br><span class="line"><span class="comment">// for (const item of arr) &#123;</span></span><br><span class="line"><span class="comment">//     console.log(item)</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// arr[4] = 1000; //增加无效</span></span><br><span class="line"><span class="comment">// delete arr[0]; //删除无效</span></span><br><span class="line"><span class="comment">// console.log(arr)</span></span><br></pre></td></tr></table></figure>

<h2 id="13-3-扩展-ArrayBuffer"><a href="#13-3-扩展-ArrayBuffer" class="headerlink" title="13-3. [扩展]ArrayBuffer"></a>13-3. [扩展]ArrayBuffer</h2><h3 id="ArrayBuffer"><a href="#ArrayBuffer" class="headerlink" title="ArrayBuffer"></a>ArrayBuffer</h3><p>ArrayBuffer：一个对象，用于存储一块固定内存大小的数据。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="built_in">ArrayBuffer</span>(字节数);</span><br></pre></td></tr></table></figure>

<p>可以通过属性<code>byteLength</code>得到字节数，可以通过方法<code>slice</code>得到新的 ArrayBuffer</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//创建了一个用于存储10个字节的内存空间</span></span><br><span class="line"><span class="keyword">const</span> bf = <span class="keyword">new</span> <span class="built_in">ArrayBuffer</span>(<span class="number">10</span>);</span><br><span class="line"><span class="keyword">const</span> bf2 = bf.slice(<span class="number">3</span>, <span class="number">5</span>); <span class="comment">//起始的字节数，结束的字节数，不填默认赋值旧数组</span></span><br><span class="line"><span class="built_in">console</span>.log(bf, bf2);</span><br></pre></td></tr></table></figure>

<h3 id="读写-ArrayBuffer"><a href="#读写-ArrayBuffer" class="headerlink" title="读写 ArrayBuffer"></a>读写 ArrayBuffer</h3><ol>
<li>使用 DataView</li>
</ol>
<p>通常会在需要混用多种存储格式时使用 DataView</p>
<ol start="2">
<li>使用类型化数组</li>
</ol>
<p>实际上，每一个类型化数组都对应一个 ArrayBuffer，如果没有手动指定 ArrayBuffer，类型化数组创建时，会新建一个 ArrayBuffer</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//创建了一个用于存储10个字节的内存空间</span></span><br><span class="line"><span class="keyword">const</span> bf = <span class="keyword">new</span> <span class="built_in">ArrayBuffer</span>(<span class="number">10</span>);</span><br><span class="line"><span class="keyword">const</span> view = <span class="keyword">new</span> <span class="built_in">DataView</span>(bf, <span class="number">3</span>, <span class="number">4</span>); <span class="comment">// 偏移量3，操作4</span></span><br><span class="line"><span class="comment">// console.log(view);</span></span><br><span class="line">view.setInt16(<span class="number">1</span>, <span class="number">3</span>); <span class="comment">// 设置</span></span><br><span class="line"><span class="built_in">console</span>.log(view);</span><br><span class="line"><span class="built_in">console</span>.log(view.getInt16(<span class="number">1</span>)); <span class="comment">// 读取数据</span></span><br></pre></td></tr></table></figure>

<p>类型化数组</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> bf = <span class="keyword">new</span> <span class="built_in">ArrayBuffer</span>(<span class="number">10</span>); <span class="comment">//10个字节的内存</span></span><br><span class="line"><span class="keyword">const</span> arr1 = <span class="keyword">new</span> <span class="built_in">Int8Array</span>(bf);</span><br><span class="line"><span class="keyword">const</span> arr2 = <span class="keyword">new</span> <span class="built_in">Int16Array</span>(bf);</span><br><span class="line"><span class="built_in">console</span>.log(arr1 === arr2); <span class="comment">// 类型化数组不一样</span></span><br><span class="line"><span class="built_in">console</span>.log(arr1.buffer === arr2.buffer); <span class="comment">// 操作的内存空间一样</span></span><br><span class="line"><span class="comment">// 操作</span></span><br><span class="line">arr1[<span class="number">0</span>] = <span class="number">10</span>;</span><br><span class="line"><span class="built_in">console</span>.log(arr1);</span><br><span class="line"><span class="built_in">console</span>.log(arr2);</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> bf = <span class="keyword">new</span> <span class="built_in">ArrayBuffer</span>(<span class="number">10</span>); <span class="comment">//10个字节的内存</span></span><br><span class="line"><span class="keyword">const</span> arr = <span class="keyword">new</span> <span class="built_in">Int16Array</span>(bf);</span><br><span class="line">arr[<span class="number">0</span>] = <span class="number">2344</span>; <span class="comment">//操作了两个字节</span></span><br><span class="line"><span class="built_in">console</span>.log(arr);</span><br></pre></td></tr></table></figure>

<h2 id="13-4-扩展-制作黑白图片"><a href="#13-4-扩展-制作黑白图片" class="headerlink" title="13-4. [扩展]制作黑白图片"></a>13-4. [扩展]制作黑白图片</h2>
                
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        Author:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="/about" rel="external nofollow noreferrer">John Doe</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        Link:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="http://example.com/2020/04/01/ES6/">http://example.com/2020/04/01/ES6/</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        Reprint policy:
                    </i>
                </span>
                <span class="reprint-info">
                    All articles in this blog are used except for special statements
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    reprint policy. If reproduced, please indicate source
                    <a href="/about" target="_blank">John Doe</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>Copied successfully, please follow the reprint policy of this article</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">more</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/Front-end-article/">
                                    <span class="chip bg-color">Front end article</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
                <style>
    #reward {
        margin: 40px 0;
        text-align: center;
    }

    #reward .reward-link {
        font-size: 1.4rem;
        line-height: 38px;
    }

    #reward .btn-floating:hover {
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2), 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    #rewardModal {
        width: 320px;
        height: 350px;
    }

    #rewardModal .reward-title {
        margin: 15px auto;
        padding-bottom: 5px;
    }

    #rewardModal .modal-content {
        padding: 10px;
    }

    #rewardModal .close {
        position: absolute;
        right: 15px;
        top: 15px;
        color: rgba(0, 0, 0, 0.5);
        font-size: 1.3rem;
        line-height: 20px;
        cursor: pointer;
    }

    #rewardModal .close:hover {
        color: #ef5350;
        transform: scale(1.3);
        -moz-transform:scale(1.3);
        -webkit-transform:scale(1.3);
        -o-transform:scale(1.3);
    }

    #rewardModal .reward-tabs {
        margin: 0 auto;
        width: 210px;
    }

    .reward-tabs .tabs {
        height: 38px;
        margin: 10px auto;
        padding-left: 0;
    }

    .reward-content ul {
        padding-left: 0 !important;
    }

    .reward-tabs .tabs .tab {
        height: 38px;
        line-height: 38px;
    }

    .reward-tabs .tab a {
        color: #fff;
        background-color: #ccc;
    }

    .reward-tabs .tab a:hover {
        background-color: #ccc;
        color: #fff;
    }

    .reward-tabs .wechat-tab .active {
        color: #fff !important;
        background-color: #22AB38 !important;
    }

    .reward-tabs .alipay-tab .active {
        color: #fff !important;
        background-color: #019FE8 !important;
    }

    .reward-tabs .reward-img {
        width: 210px;
        height: 210px;
    }
</style>

<div id="reward">
    <a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">赏</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close modal-close"><i class="fas fa-times"></i></a>
            <h4 class="reward-title">你的赏识是我前进的动力</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs row">
                        <li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li>
                        <li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li>
                    </ul>
                    <div id="alipay">
                        <img src="/medias/reward/alipay.jpg" class="reward-img" alt="支付宝打赏二维码">
                    </div>
                    <div id="wechat">
                        <img src="/medias/reward/wechat.png" class="reward-img" alt="微信打赏二维码">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('.tabs').tabs();
    });
</script>

            
        </div>
    </div>

    

    

    

    

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;Previous</div>
            <div class="card">
                <a href="/2020/04/20/%E4%BA%8B%E4%BB%B6%E5%BE%AA%E7%8E%AF%E4%B8%8E%E5%BC%82%E6%AD%A5/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/9.jpg" class="responsive-img" alt="事件循环与异步">
                        
                        <span class="card-title">事件循环与异步</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2020-04-20
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-user fa-fw"></i>
                            John Doe
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/Front-end-article/">
                        <span class="chip bg-color">Front end article</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                Next&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2020/03/20/HTML5/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/2.jpg" class="responsive-img" alt="HTML5">
                        
                        <span class="card-title">HTML5</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2020-03-20
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-user fa-fw"></i>
                            John Doe
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/Front-end-article/">
                        <span class="chip bg-color">Front end article</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>



<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>

<!-- 代码语言 -->

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>


    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget card" style="background-color: white;">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;TOC</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('0'),
            headingSelector: 'h2, h3, h4'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h2, h3, h4').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>




    <footer class="page-footer bg-color">
    
        <link rel="stylesheet" href="/libs/aplayer/APlayer.min.css">
<style>
    .aplayer .aplayer-lrc p {
        
        display: none;
        
        font-size: 12px;
        font-weight: 700;
        line-height: 16px !important;
    }

    .aplayer .aplayer-lrc p.aplayer-lrc-current {
        
        display: none;
        
        font-size: 15px;
        color: #42b983;
    }

    
    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body {
        left: -66px !important;
    }

    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body:hover {
        left: 0px !important;
    }

    
</style>
<div class="">
    
    <div class="row">
        <meting-js class="col l8 offset-l2 m10 offset-m1 s12"
                   server="netease"
                   type="playlist"
                   id="503838841"
                   fixed='true'
                   autoplay='false'
                   theme='#42b983'
                   loop='all'
                   order='random'
                   preload='auto'
                   volume='0.7'
                   list-folded='true'
        >
        </meting-js>
    </div>
</div>

<script src="/libs/aplayer/APlayer.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js"></script>

    

    <div class="container row center-align"
         style="margin-bottom: 0px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            
                <span id="year">2019-2021</span>
            
            <a href="/about" target="_blank">John Doe</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            <br>
            
            
            
                
            
            
                <span id="busuanzi_container_site_pv">
                &nbsp;|&nbsp;<i class="far fa-eye"></i>&nbsp;Total visits:&nbsp;
                    <span id="busuanzi_value_site_pv" class="white-color"></span>
            </span>
            
            
                <span id="busuanzi_container_site_uv">
                &nbsp;|&nbsp;<i class="fas fa-users"></i>&nbsp;Total visitors:&nbsp;
                    <span id="busuanzi_value_site_uv" class="white-color"></span>
            </span>
            
            <br>

            <!-- 运行天数提醒. -->
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/blinkfox" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:1181062873@qq.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>







    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=1181062873" class="tooltipped" target="_blank" data-tooltip="QQ联系我: 1181062873" data-position="top" data-delay="50">
        <i class="fab fa-qq"></i>
    </a>







    <a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50">
        <i class="fas fa-rss"></i>
    </a>

</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;Search</span>
            <input type="search" id="searchInput" name="s" placeholder="Please enter a search keyword"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script type="text/javascript">
$(function () {
    var searchFunc = function (path, search_id, content_id) {
        'use strict';
        $.ajax({
            url: path,
            dataType: "xml",
            success: function (xmlResponse) {
                // get the contents from search data
                var datas = $("entry", xmlResponse).map(function () {
                    return {
                        title: $("title", this).text(),
                        content: $("content", this).text(),
                        url: $("url", this).text()
                    };
                }).get();
                var $input = document.getElementById(search_id);
                var $resultContent = document.getElementById(content_id);
                $input.addEventListener('input', function () {
                    var str = '<ul class=\"search-result-list\">';
                    var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                    $resultContent.innerHTML = "";
                    if (this.value.trim().length <= 0) {
                        return;
                    }
                    // perform local searching
                    datas.forEach(function (data) {
                        var isMatch = true;
                        var data_title = data.title.trim().toLowerCase();
                        var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                        var data_url = data.url;
                        data_url = data_url.indexOf('/') === 0 ? data.url : '/' + data_url;
                        var index_title = -1;
                        var index_content = -1;
                        var first_occur = -1;
                        // only match artiles with not empty titles and contents
                        if (data_title !== '' && data_content !== '') {
                            keywords.forEach(function (keyword, i) {
                                index_title = data_title.indexOf(keyword);
                                index_content = data_content.indexOf(keyword);
                                if (index_title < 0 && index_content < 0) {
                                    isMatch = false;
                                } else {
                                    if (index_content < 0) {
                                        index_content = 0;
                                    }
                                    if (i === 0) {
                                        first_occur = index_content;
                                    }
                                }
                            });
                        }
                        // show search results
                        if (isMatch) {
                            str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                            var content = data.content.trim().replace(/<[^>]+>/g, "");
                            if (first_occur >= 0) {
                                // cut out 100 characters
                                var start = first_occur - 20;
                                var end = first_occur + 80;
                                if (start < 0) {
                                    start = 0;
                                }
                                if (start === 0) {
                                    end = 100;
                                }
                                if (end > content.length) {
                                    end = content.length;
                                }
                                var match_content = content.substr(start, end);
                                // highlight all keywords
                                keywords.forEach(function (keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    match_content = match_content.replace(regS, "<em class=\"search-keyword\">" + keyword + "</em>");
                                });

                                str += "<p class=\"search-result\">" + match_content + "...</p>"
                            }
                            str += "</li>";
                        }
                    });
                    str += "</ul>";
                    $resultContent.innerHTML = str;
                });
            }
        });
    };

    searchFunc('/search.xml', 'searchInput', 'searchResult');
});
</script>

    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    

    <!-- 雪花特效 -->
    

    <!-- 鼠标星星特效 -->
    

    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    <script src="/libs/others/clicklove.js" async="async"></script>
    
    
    <script async src="/libs/others/busuanzi.pure.mini.js"></script>
    

    

    

    <!--腾讯兔小巢-->
    
    

    

    

    
    <script src="/libs/instantpage/instantpage.js" type="module"></script>
    

</body>

</html>
